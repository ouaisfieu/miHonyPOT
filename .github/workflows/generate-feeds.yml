# .github/workflows/generate-feeds.yml
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# üì° G√âN√âRATEUR AUTOMATIQUE DE FLUX RSS POUR GITHUB PAGES
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
# Ce workflow scanne automatiquement votre repo et g√©n√®re des flux RSS/Atom/JSON
# √† chaque push ou selon un planning d√©fini.
#
# Installation :
# 1. Cr√©ez le dossier .github/workflows/ dans votre repo
# 2. Copiez ce fichier dedans
# 3. Commitez et pushez ‚Äî le workflow se d√©clenchera automatiquement
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

name: üì° Generate RSS Feeds

on:
  # D√©clench√© √† chaque push sur main
  push:
    branches: [ main, master ]
  
  # D√©clench√© quotidiennement √† minuit UTC
  schedule:
    - cron: '0 0 * * *'
  
  # Permet le d√©clenchement manuel depuis l'interface GitHub
  workflow_dispatch:

# Permissions n√©cessaires pour committer les fichiers g√©n√©r√©s
permissions:
  contents: write

jobs:
  generate-feeds:
    runs-on: ubuntu-latest
    
    steps:
      # 1. Checkout du repository
      - name: üì• Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # Historique complet pour les dates
      
      # 2. Setup Node.js
      - name: ‚öôÔ∏è Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      # 3. G√©n√©rer les flux RSS
      - name: üîß Generate RSS/Atom/JSON feeds
        run: |
          cat > generate-feeds.mjs << 'SCRIPT_EOF'
          import fs from 'fs';
          import path from 'path';
          import { execSync } from 'child_process';
          
          // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          // CONFIGURATION ‚Äî Adaptez ces valeurs √† votre projet
          // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          const CONFIG = {
            siteUrl: 'https://ouaisfieu.github.io/miHonyPOT',
            title: 'miHonyPOT ‚Äî Veille Citoyenne & Intelligence Civile',
            description: 'Flux de veille citoyenne, documentation OSINT, et outils d\'√©ducation permanente',
            language: 'fr-BE',
            author: 'Collectif miHonyPOT',
            copyright: 'CC BY-NC-SA 4.0',
            // Dossiers √† exclure
            excludeDirs: ['.git', '.github', 'node_modules', '.vscode', 'img', 'pdfs', 'test'],
            // Extensions de fichiers √† inclure
            includeExtensions: ['.html', '.md', '.htm'],
            // Nombre max d'items dans le flux
            maxItems: 100
          };
          
          // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          // FONCTIONS UTILITAIRES
          // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          
          function escapeXml(str) {
            return String(str)
              .replace(/&/g, '&amp;')
              .replace(/</g, '&lt;')
              .replace(/>/g, '&gt;')
              .replace(/"/g, '&quot;')
              .replace(/'/g, '&apos;');
          }
          
          function getGitDate(filePath) {
            try {
              const date = execSync(`git log -1 --format=%cI -- "${filePath}"`, { encoding: 'utf-8' }).trim();
              return date || new Date().toISOString();
            } catch {
              return new Date().toISOString();
            }
          }
          
          function extractTitle(content, filename) {
            // Essayer d'extraire le titre HTML
            const htmlTitle = content.match(/<title[^>]*>([^<]+)<\/title>/i);
            if (htmlTitle) return htmlTitle[1].trim();
            
            // Essayer d'extraire le titre Markdown (# Titre)
            const mdTitle = content.match(/^#\s+(.+)$/m);
            if (mdTitle) return mdTitle[1].trim();
            
            // Essayer d'extraire le titre du front matter YAML
            const yamlTitle = content.match(/^---[\s\S]*?title:\s*["']?([^"'\n]+)["']?[\s\S]*?---/m);
            if (yamlTitle) return yamlTitle[1].trim();
            
            // Fallback sur le nom de fichier
            return filename.replace(/\.(html|md|htm)$/i, '').replace(/[-_]/g, ' ');
          }
          
          function extractDescription(content) {
            // Meta description
            const metaDesc = content.match(/<meta[^>]+name=["']description["'][^>]+content=["']([^"']+)["']/i);
            if (metaDesc) return metaDesc[1].trim();
            
            // Premier paragraphe
            const firstP = content.match(/<p[^>]*>([^<]+)<\/p>/i);
            if (firstP) return firstP[1].trim().substring(0, 200);
            
            // Markdown: premier paragraphe apr√®s le titre
            const mdPara = content.match(/^(?!#)(?!\s*$)(.+)$/m);
            if (mdPara) return mdPara[1].trim().substring(0, 200);
            
            return '';
          }
          
          // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          // SCANNER LES FICHIERS
          // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          
          function scanDirectory(dir, baseDir = '') {
            const items = [];
            
            try {
              const entries = fs.readdirSync(dir, { withFileTypes: true });
              
              for (const entry of entries) {
                const fullPath = path.join(dir, entry.name);
                const relativePath = path.join(baseDir, entry.name);
                
                if (entry.isDirectory()) {
                  // Ignorer les dossiers exclus
                  if (CONFIG.excludeDirs.includes(entry.name) || entry.name.startsWith('.')) {
                    continue;
                  }
                  // Scanner r√©cursivement
                  items.push(...scanDirectory(fullPath, relativePath));
                } else if (entry.isFile()) {
                  const ext = path.extname(entry.name).toLowerCase();
                  if (CONFIG.includeExtensions.includes(ext)) {
                    try {
                      const content = fs.readFileSync(fullPath, 'utf-8');
                      const gitDate = getGitDate(fullPath);
                      const folder = baseDir.split(path.sep)[0] || 'root';
                      
                      items.push({
                        title: extractTitle(content, entry.name),
                        description: extractDescription(content),
                        link: `${CONFIG.siteUrl}/${relativePath.replace(/\\/g, '/').replace(/\.md$/, '.html')}`,
                        pubDate: gitDate,
                        guid: `${CONFIG.siteUrl}/${relativePath.replace(/\\/g, '/')}`,
                        category: folder,
                        filePath: relativePath
                      });
                    } catch (e) {
                      console.error(`Erreur lecture ${fullPath}:`, e.message);
                    }
                  }
                }
              }
            } catch (e) {
              console.error(`Erreur scan ${dir}:`, e.message);
            }
            
            return items;
          }
          
          // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          // G√âN√âRER RSS 2.0
          // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          
          function generateRSS(items) {
            const now = new Date().toUTCString();
            
            const rssItems = items.slice(0, CONFIG.maxItems).map(item => `
    <item>
      <title>${escapeXml(item.title)}</title>
      <link>${escapeXml(item.link)}</link>
      <description>${escapeXml(item.description)}</description>
      <pubDate>${new Date(item.pubDate).toUTCString()}</pubDate>
      <guid isPermaLink="true">${escapeXml(item.guid)}</guid>
      <category>${escapeXml(item.category)}</category>
      <dc:creator>${escapeXml(CONFIG.author)}</dc:creator>
    </item>`).join('\n');
            
            return `<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" 
     xmlns:atom="http://www.w3.org/2005/Atom"
     xmlns:dc="http://purl.org/dc/elements/1.1/"
     xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>${escapeXml(CONFIG.title)}</title>
    <link>${CONFIG.siteUrl}</link>
    <description>${escapeXml(CONFIG.description)}</description>
    <language>${CONFIG.language}</language>
    <lastBuildDate>${now}</lastBuildDate>
    <atom:link href="${CONFIG.siteUrl}/feed.xml" rel="self" type="application/rss+xml"/>
    <generator>miHonyPOT RSS Generator via GitHub Actions</generator>
    <copyright>${escapeXml(CONFIG.copyright)}</copyright>
${rssItems}
  </channel>
</rss>`;
          }
          
          // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          // G√âN√âRER ATOM
          // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          
          function generateAtom(items) {
            const now = new Date().toISOString();
            
            const atomEntries = items.slice(0, CONFIG.maxItems).map(item => `
  <entry>
    <title>${escapeXml(item.title)}</title>
    <link href="${escapeXml(item.link)}" rel="alternate" type="text/html"/>
    <id>${escapeXml(item.guid)}</id>
    <updated>${new Date(item.pubDate).toISOString()}</updated>
    <summary>${escapeXml(item.description)}</summary>
    <category term="${escapeXml(item.category)}"/>
    <author><name>${escapeXml(CONFIG.author)}</name></author>
  </entry>`).join('\n');
            
            return `<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom" xml:lang="${CONFIG.language}">
  <title>${escapeXml(CONFIG.title)}</title>
  <subtitle>${escapeXml(CONFIG.description)}</subtitle>
  <link href="${CONFIG.siteUrl}/atom.xml" rel="self" type="application/atom+xml"/>
  <link href="${CONFIG.siteUrl}" rel="alternate" type="text/html"/>
  <id>${CONFIG.siteUrl}/</id>
  <updated>${now}</updated>
  <rights>${escapeXml(CONFIG.copyright)}</rights>
  <generator uri="https://github.com/ouaisfieu/miHonyPOT">miHonyPOT RSS Generator</generator>
${atomEntries}
</feed>`;
          }
          
          // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          // G√âN√âRER JSON FEED 1.1
          // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          
          function generateJSONFeed(items) {
            return {
              version: "https://jsonfeed.org/version/1.1",
              title: CONFIG.title,
              home_page_url: CONFIG.siteUrl,
              feed_url: `${CONFIG.siteUrl}/feed.json`,
              description: CONFIG.description,
              language: CONFIG.language,
              authors: [{ name: CONFIG.author }],
              items: items.slice(0, CONFIG.maxItems).map(item => ({
                id: item.guid,
                url: item.link,
                title: item.title,
                content_text: item.description,
                date_published: new Date(item.pubDate).toISOString(),
                tags: [item.category]
              }))
            };
          }
          
          // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          // G√âN√âRER OPML (liste des sous-flux)
          // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          
          function generateOPML(folders) {
            const outlines = folders.map(folder => 
              `      <outline type="rss" text="${folder}" title="${folder}" xmlUrl="${CONFIG.siteUrl}/${folder}/feed.xml" htmlUrl="${CONFIG.siteUrl}/${folder}/"/>`
            ).join('\n');
            
            return `<?xml version="1.0" encoding="UTF-8"?>
<opml version="2.0">
  <head>
    <title>${escapeXml(CONFIG.title)} ‚Äî Liste des flux</title>
    <dateCreated>${new Date().toUTCString()}</dateCreated>
  </head>
  <body>
    <outline text="${escapeXml(CONFIG.title)}" title="${escapeXml(CONFIG.title)}">
      <outline type="rss" text="Flux principal" title="Flux principal" xmlUrl="${CONFIG.siteUrl}/feed.xml" htmlUrl="${CONFIG.siteUrl}"/>
${outlines}
    </outline>
  </body>
</opml>`;
          }
          
          // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          // EX√âCUTION PRINCIPALE
          // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
          
          console.log('üì° G√©n√©ration des flux RSS pour miHonyPOT...\n');
          
          // Scanner tous les fichiers
          const allItems = scanDirectory('.');
          
          // Trier par date d√©croissante
          allItems.sort((a, b) => new Date(b.pubDate) - new Date(a.pubDate));
          
          console.log(`üìä ${allItems.length} fichiers trouv√©s\n`);
          
          // Identifier les dossiers uniques
          const folders = [...new Set(allItems.map(i => i.category).filter(c => c !== 'root'))];
          console.log(`üìÅ Dossiers: ${folders.join(', ')}\n`);
          
          // G√©n√©rer le flux principal
          fs.writeFileSync('feed.xml', generateRSS(allItems));
          console.log('‚úÖ feed.xml g√©n√©r√©');
          
          fs.writeFileSync('atom.xml', generateAtom(allItems));
          console.log('‚úÖ atom.xml g√©n√©r√©');
          
          fs.writeFileSync('feed.json', JSON.stringify(generateJSONFeed(allItems), null, 2));
          console.log('‚úÖ feed.json g√©n√©r√©');
          
          fs.writeFileSync('feeds.opml', generateOPML(folders));
          console.log('‚úÖ feeds.opml g√©n√©r√©');
          
          // G√©n√©rer un flux par dossier
          for (const folder of folders) {
            const folderItems = allItems.filter(i => i.category === folder);
            if (folderItems.length > 0) {
              const folderPath = folder;
              if (fs.existsSync(folderPath)) {
                const folderConfig = { ...CONFIG, title: `${folder} ‚Äî ${CONFIG.title}` };
                fs.writeFileSync(path.join(folderPath, 'feed.xml'), generateRSS(folderItems));
                console.log(`‚úÖ ${folder}/feed.xml g√©n√©r√© (${folderItems.length} items)`);
              }
            }
          }
          
          console.log('\nüéâ G√©n√©ration termin√©e !');
          SCRIPT_EOF
          
          node generate-feeds.mjs
      
      # 4. Ajouter les balises link dans index.html (optionnel)
      - name: üîó Add feed discovery links
        run: |
          if [ -f "index.html" ]; then
            # V√©rifier si les liens existent d√©j√†
            if ! grep -q 'rel="alternate".*application/rss+xml' index.html; then
              # Ajouter les liens dans le <head>
              sed -i 's|</head>|  <link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/miHonyPOT/feed.xml"/>\n  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/miHonyPOT/atom.xml"/>\n  <link rel="alternate" type="application/feed+json" title="JSON Feed" href="/miHonyPOT/feed.json"/>\n</head>|' index.html
              echo "‚úÖ Feed discovery links ajout√©s √† index.html"
            else
              echo "‚ÑπÔ∏è Feed discovery links d√©j√† pr√©sents"
            fi
          fi
      
      # 5. Commit et push des fichiers g√©n√©r√©s
      - name: üì§ Commit and push feeds
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          
          # Ajouter les fichiers g√©n√©r√©s
          git add feed.xml atom.xml feed.json feeds.opml
          git add */feed.xml 2>/dev/null || true
          git add index.html 2>/dev/null || true
          
          # Commit si des changements existent
          if git diff --staged --quiet; then
            echo "‚ÑπÔ∏è Aucun changement √† committer"
          else
            git commit -m "üì° Auto-update RSS feeds [skip ci]"
            git push
            echo "‚úÖ Flux RSS mis √† jour et push√©s"
          fi
