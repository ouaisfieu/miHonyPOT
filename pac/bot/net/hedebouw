<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Poste de Travail Plaidoyer Citoyen - 15 outils pour le changement social">
    <title>Plaidoyer Citoyen ‚Äî Poste de Travail</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
:root {
    --blue-900: #1a365d; --blue-800: #2c5282; --blue-700: #2b6cb0; --blue-600: #3182ce; --blue-500: #4299e1; --blue-100: #ebf8ff;
    --gold-600: #c6923a; --gold-500: #d69e2e; --gold-400: #ecc94b; --gold-100: #fefcbf;
    --voir: #319795; --voir-bg: #e6fffa; --juger: #805ad5; --juger-bg: #faf5ff; --agir: #dd6b20; --agir-bg: #fffaf0;
    --gray-900: #1a202c; --gray-800: #2d3748; --gray-700: #4a5568; --gray-600: #718096; --gray-500: #a0aec0; --gray-400: #cbd5e0; --gray-300: #e2e8f0; --gray-200: #edf2f7; --gray-100: #f7fafc; --white: #ffffff;
    --success: #38a169; --error: #e53e3e; --info: #3182ce;
    --font-display: 'Crimson Pro', Georgia, serif; --font-body: 'DM Sans', sans-serif;
    --sidebar-w: 280px; --header-h: 60px;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; }
body { font-family: var(--font-body); font-size: 16px; line-height: 1.6; color: var(--gray-800); background: var(--gray-100); min-height: 100vh; }
h1, h2, h3, h4 { font-family: var(--font-display); font-weight: 600; color: var(--gray-900); line-height: 1.3; }
h1 { font-size: 2rem; } h2 { font-size: 1.5rem; } h3 { font-size: 1.25rem; }
a { color: var(--blue-600); text-decoration: none; }
a:hover { color: var(--blue-800); }
button { font-family: inherit; cursor: pointer; border: none; background: none; }
input, textarea, select { font-family: inherit; font-size: inherit; }

/* Layout */
.app { display: grid; grid-template-columns: var(--sidebar-w) 1fr; grid-template-rows: var(--header-h) 1fr; min-height: 100vh; }
@media (max-width: 900px) {
    .app { grid-template-columns: 1fr; }
    .sidebar { position: fixed; left: -100%; top: 0; bottom: 0; width: var(--sidebar-w); z-index: 1000; transition: left 0.3s; }
    .sidebar.open { left: 0; }
    .overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 999; }
    .overlay.active { display: block; }
}

/* Sidebar */
.sidebar { background: linear-gradient(180deg, var(--blue-900), var(--blue-800)); color: white; display: flex; flex-direction: column; overflow-y: auto; }
.sidebar-header { padding: 1.5rem; border-bottom: 1px solid rgba(255,255,255,0.1); }
.logo { display: flex; align-items: center; gap: 0.75rem; }
.logo-icon { width: 42px; height: 42px; background: linear-gradient(135deg, var(--gold-500), var(--gold-600)); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.4rem; }
.logo-text { font-family: var(--font-display); font-size: 1.1rem; font-weight: 700; }
.logo-text small { display: block; font-size: 0.7rem; opacity: 0.7; font-family: var(--font-body); font-weight: 400; }
.sidebar-nav { flex: 1; padding: 1rem 0; }
.nav-section { margin-bottom: 1rem; }
.nav-title { padding: 0.5rem 1.5rem; font-size: 0.65rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.1em; color: rgba(255,255,255,0.5); }
.nav-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.6rem 1.5rem; color: rgba(255,255,255,0.8); font-size: 0.85rem; font-weight: 500; border-left: 3px solid transparent; cursor: pointer; transition: all 0.15s; }
.nav-item:hover { background: rgba(255,255,255,0.1); color: white; }
.nav-item.active { background: rgba(255,255,255,0.15); color: white; border-left-color: var(--gold-500); }
.nav-item .num { width: 22px; text-align: center; font-size: 0.75rem; }
.nav-item.voir:hover, .nav-item.voir.active { border-left-color: var(--voir); }
.nav-item.juger:hover, .nav-item.juger.active { border-left-color: var(--juger); }
.nav-item.agir:hover, .nav-item.agir.active { border-left-color: var(--agir); }
.sidebar-footer { padding: 1rem 1.5rem; border-top: 1px solid rgba(255,255,255,0.1); font-size: 0.8rem; color: rgba(255,255,255,0.6); }
.sidebar-footer strong { display: block; color: white; }
.progress-bar { height: 4px; background: rgba(255,255,255,0.2); border-radius: 2px; margin-top: 0.5rem; overflow: hidden; }
.progress-fill { height: 100%; background: linear-gradient(90deg, var(--voir), var(--juger), var(--agir)); transition: width 0.5s; }

/* Header */
.header { background: var(--white); border-bottom: 1px solid var(--gray-200); display: flex; align-items: center; justify-content: space-between; padding: 0 1.5rem; position: sticky; top: 0; z-index: 100; }
.header-left { display: flex; align-items: center; gap: 1rem; }
.menu-btn { display: none; width: 40px; height: 40px; border-radius: 8px; background: var(--gray-100); font-size: 1.2rem; align-items: center; justify-content: center; }
@media (max-width: 900px) { .menu-btn { display: flex; } }
.breadcrumb { font-size: 0.9rem; color: var(--gray-600); }
.breadcrumb strong { color: var(--gray-900); }
.header-actions { display: flex; gap: 0.5rem; }

/* Buttons */
.btn { display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 0.5rem 1rem; font-weight: 600; font-size: 0.85rem; border-radius: 8px; transition: all 0.15s; }
.btn-primary { background: var(--blue-600); color: white; }
.btn-primary:hover { background: var(--blue-700); transform: translateY(-1px); }
.btn-secondary { background: var(--gray-100); color: var(--gray-700); border: 1px solid var(--gray-300); }
.btn-secondary:hover { background: var(--gray-200); }
.btn-ghost { color: var(--gray-600); padding: 0.5rem; }
.btn-ghost:hover { background: var(--gray-100); }
.btn-gold { background: linear-gradient(135deg, var(--gold-500), var(--gold-600)); color: var(--gray-900); font-weight: 700; }
.btn-gold:hover { box-shadow: 0 4px 12px rgba(214,158,46,0.4); }
.btn-sm { padding: 0.35rem 0.75rem; font-size: 0.8rem; }
.btn-lg { padding: 0.75rem 1.5rem; font-size: 1rem; }

/* Main */
.main { padding: 1.5rem; overflow-y: auto; }
.content { max-width: 1000px; margin: 0 auto; }
.section { display: none; }
.section.active { display: block; animation: fadeIn 0.3s; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

/* Cards */
.card { background: var(--white); border-radius: 12px; border: 1px solid var(--gray-200); margin-bottom: 1rem; overflow: hidden; }
.card-header { padding: 1rem 1.25rem; border-bottom: 1px solid var(--gray-200); display: flex; align-items: center; gap: 1rem; }
.card-body { padding: 1.25rem; }
.card-num { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.85rem; flex-shrink: 0; }
.card-num.voir { background: var(--voir-bg); color: var(--voir); }
.card-num.juger { background: var(--juger-bg); color: var(--juger); }
.card-num.agir { background: var(--agir-bg); color: var(--agir); }
.card-title { flex: 1; font-size: 1rem; }
.tip { background: var(--gray-100); padding: 1rem; border-radius: 8px; border-left: 3px solid var(--blue-500); margin-bottom: 1.5rem; font-size: 0.9rem; color: var(--gray-600); }
.tip strong { color: var(--gray-800); }

/* Forms */
.form-group { margin-bottom: 1.25rem; }
.form-label { display: block; font-weight: 600; font-size: 0.9rem; color: var(--gray-700); margin-bottom: 0.5rem; }
.form-label .req { color: var(--error); }
.form-hint { font-size: 0.8rem; color: var(--gray-500); margin-top: 0.25rem; }
.form-input, .form-textarea, .form-select { width: 100%; padding: 0.75rem 1rem; border: 1px solid var(--gray-300); border-radius: 8px; font-size: 0.95rem; background: var(--white); transition: all 0.15s; }
.form-input:focus, .form-textarea:focus, .form-select:focus { outline: none; border-color: var(--blue-500); box-shadow: 0 0 0 3px rgba(66,153,225,0.15); }
.form-textarea { min-height: 100px; resize: vertical; line-height: 1.6; }
.form-textarea.lg { min-height: 160px; }
.form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; }

/* Hero */
.hero { background: linear-gradient(135deg, var(--blue-800), var(--blue-900)); border-radius: 16px; padding: 3rem 2rem; color: white; text-align: center; margin-bottom: 2rem; position: relative; overflow: hidden; }
.hero::before { content: ''; position: absolute; top: -50%; right: -20%; width: 60%; height: 200%; background: radial-gradient(circle, rgba(214,158,46,0.15), transparent 70%); }
.hero-content { position: relative; z-index: 1; }
.hero h1 { color: white; font-size: 2.25rem; margin-bottom: 1rem; }
.hero h1 span { color: var(--gold-400); }
.hero-sub { font-size: 1.1rem; opacity: 0.9; max-width: 550px; margin: 0 auto 2rem; }
.hero-stats { display: flex; justify-content: center; gap: 3rem; margin-bottom: 2rem; flex-wrap: wrap; }
.hero-stat-val { font-size: 2.5rem; font-weight: 700; font-family: var(--font-display); color: var(--gold-400); }
.hero-stat-label { font-size: 0.85rem; opacity: 0.8; }
.hero-actions { display: flex; justify-content: center; gap: 1rem; flex-wrap: wrap; }

/* Phase cards */
.phase-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; margin-bottom: 2rem; }
@media (max-width: 800px) { .phase-grid { grid-template-columns: 1fr; } }
.phase-card { background: var(--white); border-radius: 12px; padding: 1.5rem; border: 2px solid var(--gray-200); cursor: pointer; transition: all 0.2s; position: relative; }
.phase-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; border-radius: 12px 12px 0 0; }
.phase-card.voir::before { background: var(--voir); }
.phase-card.juger::before { background: var(--juger); }
.phase-card.agir::before { background: var(--agir); }
.phase-card:hover { transform: translateY(-4px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
.phase-card.voir:hover { border-color: var(--voir); }
.phase-card.juger:hover { border-color: var(--juger); }
.phase-card.agir:hover { border-color: var(--agir); }
.phase-icon { font-size: 2rem; margin-bottom: 1rem; }
.phase-name { font-family: var(--font-display); font-size: 1.25rem; font-weight: 700; margin-bottom: 0.5rem; }
.phase-card.voir .phase-name { color: var(--voir); }
.phase-card.juger .phase-name { color: var(--juger); }
.phase-card.agir .phase-name { color: var(--agir); }
.phase-desc { color: var(--gray-600); font-size: 0.9rem; margin-bottom: 1rem; }
.phase-tools { font-size: 0.8rem; color: var(--gray-500); }
.phase-progress { margin-top: 1rem; height: 6px; background: var(--gray-200); border-radius: 3px; overflow: hidden; }
.phase-progress-fill { height: 100%; border-radius: 3px; transition: width 0.5s; }
.phase-card.voir .phase-progress-fill { background: var(--voir); }
.phase-card.juger .phase-progress-fill { background: var(--juger); }
.phase-card.agir .phase-progress-fill { background: var(--agir); }

/* Dashboard */
.dash-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
@media (max-width: 900px) { .dash-grid { grid-template-columns: repeat(2, 1fr); } }
@media (max-width: 500px) { .dash-grid { grid-template-columns: 1fr; } }
.stat-card { background: var(--white); border-radius: 12px; padding: 1.25rem; border: 1px solid var(--gray-200); }
.stat-icon { width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 1.1rem; margin-bottom: 0.75rem; }
.stat-card.voir .stat-icon { background: var(--voir-bg); }
.stat-card.juger .stat-icon { background: var(--juger-bg); }
.stat-card.agir .stat-icon { background: var(--agir-bg); }
.stat-card.progress .stat-icon { background: var(--gold-100); }
.stat-val { font-family: var(--font-display); font-size: 1.75rem; font-weight: 700; color: var(--gray-900); }
.stat-label { font-size: 0.8rem; color: var(--gray-500); margin-top: 0.25rem; }

/* Actors */
.actors-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 1rem; margin-top: 1rem; }
.actor-card { background: var(--white); border: 1px solid var(--gray-200); border-radius: 10px; padding: 1rem; position: relative; }
.actor-card::before { content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%; border-radius: 10px 0 0 10px; }
.actor-card.ally::before { background: var(--success); }
.actor-card.opponent::before { background: var(--error); }
.actor-card.neutral::before { background: var(--gray-400); }
.actor-card.target::before { background: var(--gold-500); }
.actor-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.5rem; }
.actor-name { font-weight: 600; color: var(--gray-900); }
.actor-type { font-size: 0.7rem; padding: 2px 8px; border-radius: 999px; font-weight: 600; }
.actor-type.ally { background: #c6f6d5; color: #22543d; }
.actor-type.opponent { background: #fed7d7; color: #742a2a; }
.actor-type.neutral { background: var(--gray-200); color: var(--gray-700); }
.actor-type.target { background: var(--gold-100); color: #744210; }
.actor-org { font-size: 0.8rem; color: var(--gray-500); margin-bottom: 0.5rem; }
.power-row { display: flex; align-items: center; gap: 0.5rem; margin-top: 0.75rem; }
.power-label { font-size: 0.7rem; color: var(--gray-500); }
.power-bar { flex: 1; height: 6px; background: var(--gray-200); border-radius: 3px; overflow: hidden; }
.power-fill { height: 100%; background: var(--blue-500); border-radius: 3px; }
.power-val { font-size: 0.75rem; font-weight: 600; }
.actor-actions { display: flex; gap: 0.5rem; margin-top: 0.75rem; }

/* SWOT */
.matrix-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem; }
@media (max-width: 600px) { .matrix-grid { grid-template-columns: 1fr; } }
.matrix-cell { background: var(--white); border-radius: 10px; padding: 1rem; border: 1px solid var(--gray-200); }
.matrix-title { font-weight: 700; font-size: 0.85rem; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem; }
.matrix-cell.s .matrix-title { color: var(--success); }
.matrix-cell.w .matrix-title { color: var(--error); }
.matrix-cell.o .matrix-title { color: var(--blue-600); }
.matrix-cell.t .matrix-title { color: var(--agir); }

/* ToC Grid */
.toc-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem; background: var(--gray-100); padding: 1.5rem; border-radius: 12px; }
@media (max-width: 600px) { .toc-grid { grid-template-columns: 1fr; } }
.toc-quad { background: var(--white); border-radius: 10px; padding: 1rem; border: 1px solid var(--gray-200); }
.toc-quad-title { font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem; }
.toc-quad.q1 .toc-quad-title { color: var(--voir); }
.toc-quad.q2 .toc-quad-title { color: var(--juger); }
.toc-quad.q3 .toc-quad-title { color: var(--agir); }
.toc-quad.q4 .toc-quad-title { color: var(--blue-600); }

/* Tree */
.tree-container { background: var(--gray-100); border-radius: 12px; padding: 1.5rem; margin-top: 1rem; }
.tree-level { margin-bottom: 1.5rem; }
.tree-level:last-child { margin-bottom: 0; }
.tree-level-title { font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; color: var(--gray-500); margin-bottom: 0.75rem; }
.tree-add { display: flex; gap: 0.5rem; margin-bottom: 0.75rem; }
.tree-items { display: flex; flex-wrap: wrap; gap: 0.5rem; min-height: 36px; }
.tree-item { background: var(--white); border: 1px solid var(--gray-200); border-radius: 8px; padding: 0.4rem 0.75rem; font-size: 0.85rem; display: flex; align-items: center; gap: 0.5rem; }
.tree-item.cause { border-left: 3px solid var(--error); }
.tree-item.problem { border-left: 3px solid var(--gold-500); background: var(--gold-100); }
.tree-item.effect { border-left: 3px solid var(--juger); }
.tree-remove { color: var(--gray-400); cursor: pointer; font-size: 1rem; line-height: 1; }
.tree-remove:hover { color: var(--error); }

/* Choices */
.choice-group { display: flex; flex-direction: column; gap: 0.75rem; }
.choice-item { display: flex; align-items: flex-start; gap: 0.75rem; padding: 0.75rem 1rem; border: 1px solid var(--gray-300); border-radius: 10px; cursor: pointer; transition: all 0.15s; }
.choice-item:hover { border-color: var(--blue-400); background: var(--blue-100); }
.choice-item input { margin-top: 3px; }
.choice-title { font-weight: 600; color: var(--gray-800); }
.choice-desc { font-size: 0.85rem; color: var(--gray-600); margin-top: 0.25rem; }

/* Checklist */
.checklist { display: flex; flex-direction: column; gap: 0.5rem; }
.check-item { display: flex; align-items: flex-start; gap: 0.75rem; padding: 0.75rem 1rem; background: var(--white); border: 1px solid var(--gray-200); border-radius: 10px; cursor: pointer; transition: all 0.15s; }
.check-item:hover { border-color: var(--gray-300); }
.check-item.done { background: #f0fff4; border-color: var(--success); }
.check-box { width: 20px; height: 20px; border: 2px solid var(--gray-300); border-radius: 4px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 0.8rem; transition: all 0.15s; }
.check-item.done .check-box { background: var(--success); border-color: var(--success); color: white; }
.check-text { flex: 1; font-size: 0.9rem; }
.check-item.done .check-text { text-decoration: line-through; color: var(--gray-500); }

/* Journal */
.journal-entries { display: flex; flex-direction: column; gap: 1rem; margin-top: 1rem; }
.journal-entry { background: var(--white); border: 1px solid var(--gray-200); border-radius: 10px; padding: 1rem; position: relative; }
.journal-entry::before { content: ''; position: absolute; left: 0; top: 1rem; bottom: 1rem; width: 3px; background: var(--blue-500); border-radius: 2px; }
.journal-date { font-size: 0.75rem; color: var(--gray-500); margin-bottom: 0.5rem; }
.journal-type { display: inline-block; padding: 2px 8px; background: var(--gray-100); color: var(--gray-600); border-radius: 999px; font-size: 0.7rem; margin-left: 0.5rem; }
.journal-content { color: var(--gray-700); white-space: pre-wrap; font-size: 0.9rem; }

/* Message preview */
.msg-preview { background: linear-gradient(135deg, var(--blue-800), var(--blue-900)); color: white; border-radius: 12px; padding: 1.5rem; margin-top: 1rem; position: relative; }
.msg-preview::before { content: 'üí¨'; position: absolute; top: 1rem; right: 1rem; font-size: 1.25rem; opacity: 0.5; }
.msg-preview-title { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 0.1em; opacity: 0.7; margin-bottom: 1rem; }
.msg-preview-content { font-family: var(--font-display); font-size: 1rem; line-height: 1.8; white-space: pre-wrap; }
.msg-actions { display: flex; gap: 0.75rem; margin-top: 1rem; }

/* Modal */
.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 2000; opacity: 0; visibility: hidden; transition: all 0.2s; padding: 1rem; }
.modal-overlay.active { opacity: 1; visibility: visible; }
.modal { background: var(--white); border-radius: 16px; max-width: 550px; width: 100%; max-height: 90vh; overflow-y: auto; transform: scale(0.95); transition: transform 0.2s; }
.modal-overlay.active .modal { transform: scale(1); }
.modal-header { padding: 1.25rem 1.5rem; border-bottom: 1px solid var(--gray-200); display: flex; align-items: center; justify-content: space-between; }
.modal-title { font-size: 1.1rem; }
.modal-close { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: var(--gray-500); font-size: 1.25rem; cursor: pointer; }
.modal-close:hover { background: var(--gray-100); }
.modal-body { padding: 1.5rem; }

/* Drop zone */
.drop-zone { border: 2px dashed var(--gray-300); border-radius: 12px; padding: 2.5rem; text-align: center; cursor: pointer; transition: all 0.15s; }
.drop-zone:hover, .drop-zone.dragover { border-color: var(--blue-500); background: var(--blue-100); }
.drop-zone-icon { font-size: 2.5rem; margin-bottom: 1rem; }
.drop-zone-text { color: var(--gray-600); margin-bottom: 0.5rem; }
.drop-zone-hint { font-size: 0.8rem; color: var(--gray-500); }

/* Export options */
.export-options { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem; }
@media (max-width: 500px) { .export-options { grid-template-columns: repeat(2, 1fr); } }
.export-opt { background: var(--gray-100); border: 1px solid var(--gray-200); border-radius: 10px; padding: 1rem; text-align: center; cursor: pointer; transition: all 0.15s; }
.export-opt:hover { border-color: var(--blue-500); background: var(--blue-100); }
.export-opt-icon { font-size: 1.75rem; margin-bottom: 0.5rem; }
.export-opt-name { font-weight: 600; font-size: 0.85rem; color: var(--gray-700); }
.export-opt-desc { font-size: 0.7rem; color: var(--gray-500); margin-top: 0.25rem; }

/* Toast */
.toast-container { position: fixed; bottom: 1.5rem; right: 1.5rem; z-index: 3000; display: flex; flex-direction: column; gap: 0.75rem; }
.toast { background: var(--gray-900); color: white; padding: 1rem 1.25rem; border-radius: 10px; display: flex; align-items: center; gap: 0.75rem; box-shadow: 0 10px 25px rgba(0,0,0,0.2); animation: slideIn 0.3s; min-width: 250px; }
.toast.success { border-left: 4px solid var(--success); }
.toast.error { border-left: 4px solid var(--error); }
.toast.info { border-left: 4px solid var(--info); }
@keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

/* Nav */
.nav-btns { display: flex; justify-content: space-between; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--gray-200); }

/* Utils */
.text-muted { color: var(--gray-500); }
.text-center { text-align: center; }
.mt-1 { margin-top: 0.5rem; }
.mt-2 { margin-top: 1rem; }
.mt-3 { margin-top: 1.5rem; }
.mb-1 { margin-bottom: 0.5rem; }
.mb-2 { margin-bottom: 1rem; }
.mb-3 { margin-bottom: 1.5rem; }
.empty { color: var(--gray-400); font-style: italic; padding: 1rem; text-align: center; }
    </style>
</head>
<body>
<div class="app">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <div class="logo-icon">‚öñÔ∏è</div>
                <div class="logo-text">Plaidoyer Citoyen<small>Poste de Travail v3</small></div>
            </div>
        </div>
        <nav class="sidebar-nav">
            <div class="nav-section">
                <div class="nav-title">Navigation</div>
                <div class="nav-item active" data-section="accueil"><span class="num">üè†</span>Accueil</div>
                <div class="nav-item" data-section="dashboard"><span class="num">üìä</span>Tableau de bord</div>
            </div>
            <div class="nav-section">
                <div class="nav-title">Phase 1 ‚Äî VOIR</div>
                <div class="nav-item voir" data-section="outil-1"><span class="num">01</span>Domino du changement</div>
                <div class="nav-item voir" data-section="outil-2"><span class="num">02</span>Profil d'engagement</div>
                <div class="nav-item voir" data-section="outil-3"><span class="num">03</span>Fleur de pouvoir</div>
                <div class="nav-item voir" data-section="outil-4"><span class="num">04</span>Cartographie acteurs</div>
            </div>
            <div class="nav-section">
                <div class="nav-title">Phase 2 ‚Äî JUGER</div>
                <div class="nav-item juger" data-section="outil-5"><span class="num">05</span>Th√©orie du changement</div>
                <div class="nav-item juger" data-section="outil-6"><span class="num">06</span>Analyse SWOT</div>
                <div class="nav-item juger" data-section="outil-7"><span class="num">07</span>Analyse PESTEL</div>
                <div class="nav-item juger" data-section="outil-8"><span class="num">08</span>Arbre √† probl√®me</div>
                <div class="nav-item juger" data-section="outil-9"><span class="num">09</span>Les 5 Pourquoi</div>
            </div>
            <div class="nav-section">
                <div class="nav-title">Phase 3 ‚Äî AGIR</div>
                <div class="nav-item agir" data-section="outil-10"><span class="num">10</span>Modes d'action</div>
                <div class="nav-item agir" data-section="outil-11"><span class="num">11</span>Objectifs SMART</div>
                <div class="nav-item agir" data-section="outil-12"><span class="num">12</span>Cibles et alliances</div>
                <div class="nav-item agir" data-section="outil-13"><span class="num">13</span>Construire un message</div>
                <div class="nav-item agir" data-section="outil-14"><span class="num">14</span>Check-list rencontre</div>
                <div class="nav-item agir" data-section="outil-15"><span class="num">15</span>Suivi et √©valuation</div>
            </div>
            <div class="nav-section">
                <div class="nav-title">Outils</div>
                <div class="nav-item" data-section="journal"><span class="num">üìì</span>Journal de bord</div>
                <div class="nav-item" data-section="ressources"><span class="num">üìö</span>Ressources</div>
            </div>
        </nav>
        <div class="sidebar-footer">
            Projet actuel<strong id="project-name">Nouveau projet</strong>
            <div class="progress-bar"><div class="progress-fill" id="sidebar-progress" style="width:0%"></div></div>
        </div>
    </aside>
    <div class="overlay" id="overlay"></div>

    <!-- Header -->
    <header class="header">
        <div class="header-left">
            <button class="menu-btn" id="menu-btn">‚ò∞</button>
            <div class="breadcrumb">Plaidoyer ‚Ä∫ <strong id="breadcrumb">Accueil</strong></div>
        </div>
        <div class="header-actions">
            <button class="btn btn-ghost" onclick="openModal('import-modal')" title="Importer">üì•</button>
            <button class="btn btn-ghost" onclick="openModal('export-modal')" title="Exporter">üì§</button>
            <button class="btn btn-primary" onclick="save()">üíæ Sauvegarder</button>
        </div>
    </header>

    <!-- Main -->
    <main class="main">
        <div class="content">
            <!-- Accueil -->
            <section id="accueil" class="section active">
                <div class="hero">
                    <div class="hero-content">
                        <h1>Poste de Travail <span>Plaidoyer Citoyen</span></h1>
                        <p class="hero-sub">15 outils m√©thodologiques pour construire, mener et √©valuer votre strat√©gie de plaidoyer politique. M√©thode Voir-Juger-Agir.</p>
                        <div class="hero-stats">
                            <div><div class="hero-stat-val">15</div><div class="hero-stat-label">Outils</div></div>
                            <div><div class="hero-stat-val" id="hero-progress">0%</div><div class="hero-stat-label">Progression</div></div>
                            <div><div class="hero-stat-val" id="hero-actors">0</div><div class="hero-stat-label">Acteurs</div></div>
                        </div>
                        <div class="hero-actions">
                            <button class="btn btn-gold btn-lg" onclick="go('outil-1')">üöÄ Commencer</button>
                            <button class="btn btn-secondary btn-lg" onclick="openModal('import-modal')">üìÇ Charger un projet</button>
                        </div>
                    </div>
                </div>
                <h2 class="mb-2">Les trois phases du plaidoyer</h2>
                <div class="phase-grid">
                    <div class="phase-card voir" onclick="go('outil-1')">
                        <div class="phase-icon">üëÅÔ∏è</div>
                        <div class="phase-name">VOIR</div>
                        <p class="phase-desc">Analyser le contexte et identifier les acteurs cl√©s.</p>
                        <div class="phase-tools">4 outils ‚Ä¢ Outils 1-4</div>
                        <div class="phase-progress"><div class="phase-progress-fill" id="prog-voir" style="width:0%"></div></div>
                    </div>
                    <div class="phase-card juger" onclick="go('outil-5')">
                        <div class="phase-icon">‚öñÔ∏è</div>
                        <div class="phase-name">JUGER</div>
                        <p class="phase-desc">R√©flexion critique et √©laboration de la strat√©gie.</p>
                        <div class="phase-tools">5 outils ‚Ä¢ Outils 5-9</div>
                        <div class="phase-progress"><div class="phase-progress-fill" id="prog-juger" style="width:0%"></div></div>
                    </div>
                    <div class="phase-card agir" onclick="go('outil-10')">
                        <div class="phase-icon">üöÄ</div>
                        <div class="phase-name">AGIR</div>
                        <p class="phase-desc">Actions concr√®tes et suivi de l'impact.</p>
                        <div class="phase-tools">6 outils ‚Ä¢ Outils 10-15</div>
                        <div class="phase-progress"><div class="phase-progress-fill" id="prog-agir" style="width:0%"></div></div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header"><h3 class="card-title">üìñ √Ä propos</h3></div>
                    <div class="card-body">
                        <p>Ce poste de travail est inspir√© du <strong>Petit Guide du Plaidoyer Citoyen</strong> de Justice et Paix. Le plaidoyer citoyen est un outil indispensable pour faire entendre ses revendications, √† la port√©e de chacun¬∑e.</p>
                    </div>
                </div>
            </section>

            <!-- Dashboard -->
            <section id="dashboard" class="section">
                <h2 class="mb-2">üìä Tableau de bord</h2>
                <div class="dash-grid">
                    <div class="stat-card progress"><div class="stat-icon">üìà</div><div class="stat-val" id="d-prog">0%</div><div class="stat-label">Progression</div></div>
                    <div class="stat-card voir"><div class="stat-icon">üëÅÔ∏è</div><div class="stat-val" id="d-voir">0%</div><div class="stat-label">Phase VOIR</div></div>
                    <div class="stat-card juger"><div class="stat-icon">‚öñÔ∏è</div><div class="stat-val" id="d-juger">0%</div><div class="stat-label">Phase JUGER</div></div>
                    <div class="stat-card agir"><div class="stat-icon">üöÄ</div><div class="stat-val" id="d-agir">0%</div><div class="stat-label">Phase AGIR</div></div>
                </div>
                <div class="card">
                    <div class="card-header"><h3 class="card-title">üìã R√©sum√©</h3></div>
                    <div class="card-body">
                        <div class="form-row">
                            <div><div class="stat-label">Champs remplis</div><div class="stat-val" id="d-fields" style="font-size:1.5rem">0</div></div>
                            <div><div class="stat-label">Acteurs</div><div class="stat-val" id="d-actors" style="font-size:1.5rem">0</div></div>
                            <div><div class="stat-label">Journal</div><div class="stat-val" id="d-journal" style="font-size:1.5rem">0</div></div>
                            <div><div class="stat-label">Check-list</div><div class="stat-val" id="d-checks" style="font-size:1.5rem">0/12</div></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Outil 1 -->
            <section id="outil-1" class="section">
                <h2>üëÅÔ∏è Outil 1 : Domino du Changement</h2>
                <p class="text-muted mb-2">Cadrez votre projet en identifiant vos motivations et le changement souhait√©.</p>
                <div class="card">
                    <div class="card-body">
                        <div class="tip"><strong>üí° Conseil :</strong> Commencez par ce qui vous motive profond√©ment. Quelles valeurs vous animent ?</div>
                        <div class="form-group"><label class="form-label">Pourquoi voulez-vous vous engager ? <span class="req">*</span></label><textarea class="form-textarea lg" data-field="domino_pourquoi" placeholder="Vos motivations profondes..."></textarea></div>
                        <div class="form-group"><label class="form-label">Vos valeurs fondamentales</label><textarea class="form-textarea" data-field="domino_valeurs" placeholder="Justice, √©galit√©, solidarit√©..."></textarea></div>
                        <div class="form-group"><label class="form-label">Changements souhait√©s <span class="req">*</span></label><textarea class="form-textarea lg" data-field="domino_changements" placeholder="Les changements concrets que vous visez..."></textarea></div>
                        <div class="form-group"><label class="form-label">Sujet pr√©cis du plaidoyer</label><input type="text" class="form-input" data-field="domino_sujet" placeholder="Ex: Acc√®s au logement pour les jeunes"></div>
                        <div class="nav-btns"><button class="btn btn-secondary" onclick="go('accueil')">‚Üê Retour</button><button class="btn btn-primary" onclick="go('outil-2')">Suivant ‚Üí</button></div>
                    </div>
                </div>
            </section>

            <!-- Outil 2 -->
            <section id="outil-2" class="section">
                <h2>üëÅÔ∏è Outil 2 : Profil d'Engagement</h2>
                <p class="text-muted mb-2">D√©couvrez votre style d'engagement et comment contribuer efficacement.</p>
                <div class="card">
                    <div class="card-body">
                        <div class="tip"><strong>üí° Conseil :</strong> Pas de bon ou mauvais profil. Chaque style a sa place dans le plaidoyer.</div>
                        <div class="form-group"><label class="form-label">Comment pr√©f√©rez-vous agir ?</label>
                            <div class="choice-group">
                                <label class="choice-item"><input type="radio" name="profil" value="planifier" data-field="profil_type"><div><div class="choice-title">üóÇÔ∏è Planifier</div><div class="choice-desc">Structurer, coordonner, organiser</div></div></label>
                                <label class="choice-item"><input type="radio" name="profil" value="communiquer" data-field="profil_type"><div><div class="choice-title">üó£Ô∏è Communiquer</div><div class="choice-desc">Parler, n√©gocier, convaincre</div></div></label>
                                <label class="choice-item"><input type="radio" name="profil" value="rechercher" data-field="profil_type"><div><div class="choice-title">üî¨ Rechercher</div><div class="choice-desc">Analyser, documenter, argumenter</div></div></label>
                                <label class="choice-item"><input type="radio" name="profil" value="mobiliser" data-field="profil_type"><div><div class="choice-title">‚úä Mobiliser</div><div class="choice-desc">Rassembler, f√©d√©rer, cr√©er du lien</div></div></label>
                            </div>
                        </div>
                        <div class="form-group"><label class="form-label">Temps disponible</label><select class="form-select" data-field="profil_temps"><option value="">S√©lectionnez...</option><option value="ponctuel">Quelques heures/mois</option><option value="regulier">Quelques heures/semaine</option><option value="intensif">Plusieurs heures/semaine</option></select></div>
                        <div class="form-group"><label class="form-label">Comp√©tences particuli√®res</label><textarea class="form-textarea" data-field="profil_competences" placeholder="R√©daction, r√©seaux sociaux, droit, graphisme..."></textarea></div>
                        <div class="nav-btns"><button class="btn btn-secondary" onclick="go('outil-1')">‚Üê Pr√©c√©dent</button><button class="btn btn-primary" onclick="go('outil-3')">Suivant ‚Üí</button></div>
                    </div>
                </div>
            </section>

            <!-- Outil 3 -->
            <section id="outil-3" class="section">
                <h2>üëÅÔ∏è Outil 3 : Fleur de Pouvoir</h2>
                <p class="text-muted mb-2">Analysez votre position sociale et vos privil√®ges.</p>
                <div class="card">
                    <div class="card-body">
                        <div class="tip"><strong>üí° Conseil :</strong> Prendre conscience de sa position dans les rapports de domination aide √† identifier vos ressources et angles morts.</div>
                        <p class="mb-2">√âvaluez votre position pour chaque dimension :</p>
                        <div class="form-row">
                            <div class="form-group"><label class="form-label">Genre</label><select class="form-select" data-field="fleur_genre"><option value="">S√©lectionnez...</option><option value="privilegie">Privil√©gi√©¬∑e</option><option value="intermediaire">Interm√©diaire</option><option value="marginalise">Marginalis√©¬∑e</option></select></div>
                            <div class="form-group"><label class="form-label">Classe sociale</label><select class="form-select" data-field="fleur_classe"><option value="">S√©lectionnez...</option><option value="privilegie">Privil√©gi√©¬∑e</option><option value="intermediaire">Interm√©diaire</option><option value="marginalise">Marginalis√©¬∑e</option></select></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label class="form-label">Origine</label><select class="form-select" data-field="fleur_origine"><option value="">S√©lectionnez...</option><option value="privilegie">Privil√©gi√©¬∑e</option><option value="intermediaire">Interm√©diaire</option><option value="marginalise">Marginalis√©¬∑e</option></select></div>
                            <div class="form-group"><label class="form-label">√âducation</label><select class="form-select" data-field="fleur_education"><option value="">S√©lectionnez...</option><option value="privilegie">Privil√©gi√©¬∑e</option><option value="intermediaire">Interm√©diaire</option><option value="marginalise">Marginalis√©¬∑e</option></select></div>
                        </div>
                        <div class="form-group"><label class="form-label">Comment votre position influence-t-elle votre engagement ?</label><textarea class="form-textarea lg" data-field="fleur_reflexion" placeholder="R√©flexion sur vos privil√®ges et marginalisations..."></textarea></div>
                        <div class="nav-btns"><button class="btn btn-secondary" onclick="go('outil-2')">‚Üê Pr√©c√©dent</button><button class="btn btn-primary" onclick="go('outil-4')">Suivant ‚Üí</button></div>
                    </div>
                </div>
            </section>

            <!-- Outil 4 -->
            <section id="outil-4" class="section">
                <h2>üëÅÔ∏è Outil 4 : Cartographie des Acteurs</h2>
                <p class="text-muted mb-2">Identifiez les parties prenantes : alli√©s, opposants, cibles.</p>
                <div class="card">
                    <div class="card-body">
                        <div class="tip"><strong>üí° Conseil :</strong> Le "power mapping" permet de visualiser les rapports de force et d'identifier les leviers d'action.</div>
                        <h4 class="mb-1">Ajouter un acteur</h4>
                        <div class="form-row">
                            <div class="form-group"><label class="form-label">Nom <span class="req">*</span></label><input type="text" class="form-input" id="actor-name" placeholder="Ex: Ministre du Logement"></div>
                            <div class="form-group"><label class="form-label">Organisation</label><input type="text" class="form-input" id="actor-org" placeholder="Ex: Gouvernement"></div>
                        </div>
                        <div class="form-row">
                            <div class="form-group"><label class="form-label">Type</label><select class="form-select" id="actor-type"><option value="neutral">Neutre</option><option value="ally">Alli√©¬∑e</option><option value="opponent">Opposant¬∑e</option><option value="target">Cible</option></select></div>
                            <div class="form-group"><label class="form-label">Pouvoir (1-10)</label><input type="range" id="actor-power" min="1" max="10" value="5" style="width:100%"><div style="display:flex;justify-content:space-between;font-size:0.75rem;color:var(--gray-500)"><span>Faible</span><span id="power-val">5</span><span>Fort</span></div></div>
                        </div>
                        <div class="form-group"><label class="form-label">Notes</label><textarea class="form-textarea" id="actor-notes" placeholder="Strat√©gie, int√©r√™ts..."></textarea></div>
                        <button class="btn btn-primary mb-2" onclick="addActor()">‚ûï Ajouter</button>
                        <h4 class="mb-1">Acteurs (<span id="actors-count">0</span>)</h4>
                        <div class="actors-grid" id="actors-grid"><div class="empty" id="no-actors">Aucun acteur ajout√©</div></div>
                        <div class="nav-btns"><button class="btn btn-secondary" onclick="go('outil-3')">‚Üê Pr√©c√©dent</button><button class="btn btn-primary" onclick="go('outil-5')">Phase JUGER ‚Üí</button></div>
                    </div>
                </div>
            </section>

            <!-- Outil 5 -->
            <section id="outil-5" class="section">
                <h2>‚öñÔ∏è Outil 5 : Th√©orie du Changement</h2>
                <p class="text-muted mb-2">Comment le changement se produit : activit√©s ‚Üí r√©sultats ‚Üí impact.</p>
                <div class="card">
                    <div class="card-body">
                        <div class="tip"><strong>üí° Conseil :</strong> La th√©orie du changement articule vos actions et leurs effets attendus.</div>
                        <div class="form-group"><label class="form-label">Vision √† long terme <span class="req">*</span></label><textarea class="form-textarea" data-field="toc_vision" placeholder="L'impact final souhait√©..."></textarea></div>
                        <div class="form-group"><label class="form-label">R√©sultats interm√©diaires</label><textarea class="form-textarea" data-field="toc_resultats" placeholder="Changements interm√©diaires n√©cessaires..."></textarea></div>
                        <div class="form-group"><label class="form-label">Activit√©s pr√©vues</label><textarea class="form-textarea" data-field="toc_activites" placeholder="Actions √† mener..."></textarea></div>
                        <h4 class="mt-2 mb-1">Matrice du changement</h4>
                        <div class="toc-grid">
                            <div class="toc-quad q1"><div class="toc-quad-title">üß† Individuel interne</div><textarea class="form-textarea" data-field="toc_q1" placeholder="Croyances, valeurs..."></textarea></div>
                            <div class="toc-quad q2"><div class="toc-quad-title">üë§ Individuel externe</div><textarea class="form-textarea" data-field="toc_q2" placeholder="Comportements..."></textarea></div>
                            <div class="toc-quad q3"><div class="toc-quad-title">üåê Collectif interne</div><textarea class="form-textarea" data-field="toc_q3" placeholder="Culture, normes..."></textarea></div>
                            <div class="toc-quad q4"><div class="toc-quad-title">üèõÔ∏è Collectif externe</div><textarea class="form-textarea" data-field="toc_q4" placeholder="Lois, politiques..."></textarea></div>
                        </div>
                        <div class="nav-btns"><button class="btn btn-secondary" onclick="go('outil-4')">‚Üê Pr√©c√©dent</button><button class="btn btn-primary" onclick="go('outil-6')">Suivant ‚Üí</button></div>
                    </div>
                </div>
            </section>

            <!-- Outil 6 -->
            <section id="outil-6" class="section">
                <h2>‚öñÔ∏è Outil 6 : Analyse SWOT</h2>
                <p class="text-muted mb-2">Forces, Faiblesses, Opportunit√©s, Menaces.</p>
                <div class="card">
                    <div class="card-body">
                        <div class="tip"><strong>üí° Conseil :</strong> Forces/Faiblesses = interne. Opportunit√©s/Menaces = externe.</div>
                        <div class="matrix-grid">
                            <div class="matrix-cell s"><div class="matrix-title">üí™ Forces</div><textarea class="form-textarea" data-field="swot_forces" placeholder="Vos atouts, ressources..."></textarea></div>
                            <div class="matrix-cell w"><div class="matrix-title">‚ö†Ô∏è Faiblesses</div><textarea class="form-textarea" data-field="swot_faiblesses" placeholder="Points faibles, manques..."></textarea></div>
                            <div class="matrix-cell o"><div class="matrix-title">üéØ Opportunit√©s</div><textarea class="form-textarea" data-field="swot_opportunites" placeholder="Occasions favorables..."></textarea></div>
                            <div class="matrix-cell t"><div class="matrix-title">üö® Menaces</div><textarea class="form-textarea" data-field="swot_menaces" placeholder="Risques, obstacles..."></textarea></div>
                        </div>
                        <div class="form-group mt-2"><label class="form-label">Conclusions strat√©giques</label><textarea class="form-textarea lg" data-field="swot_conclusions" placeholder="Comment exploiter forces et opportunit√©s ? Att√©nuer faiblesses et menaces ?"></textarea></div>
                        <div class="nav-btns"><button class="btn btn-secondary" onclick="go('outil-5')">‚Üê Pr√©c√©dent</button><button class="btn btn-primary" onclick="go('outil-7')">Suivant ‚Üí</button></div>
                    </div>
                </div>
            </section>

            <!-- Outil 7 -->
            <section id="outil-7" class="section">
                <h2>‚öñÔ∏è Outil 7 : Analyse PESTEL</h2>
                <p class="text-muted mb-2">Facteurs Politique, √âconomique, Social, Technologique, Environnemental, L√©gal.</p>
                <div class="card">
                    <div class="card-body">
                        <div class="form-group"><label class="form-label">üèõÔ∏è Politique</label><textarea class="form-textarea" data-field="pestel_p" placeholder="Contexte politique, soutiens..."></textarea></div>
                        <div class="form-group"><label class="form-label">üí∞ √âconomique</label><textarea class="form-textarea" data-field="pestel_e" placeholder="Situation √©conomique, budgets..."></textarea></div>
                        <div class="form-group"><label class="form-label">üë• Social</label><textarea class="form-textarea" data-field="pestel_s" placeholder="Tendances sociales, opinion..."></textarea></div>
                        <div class="form-group"><label class="form-label">üíª Technologique</label><textarea class="form-textarea" data-field="pestel_t" placeholder="Outils num√©riques, innovations..."></textarea></div>
                        <div class="form-group"><label class="form-label">üåø Environnemental</label><textarea class="form-textarea" data-field="pestel_env" placeholder="Enjeux √©cologiques..."></textarea></div>
                        <div class="form-group"><label class="form-label">‚öñÔ∏è L√©gal</label><textarea class="form-textarea" data-field="pestel_l" placeholder="Cadre juridique, √©volutions..."></textarea></div>
                        <div class="nav-btns"><button class="btn btn-secondary" onclick="go('outil-6')">‚Üê Pr√©c√©dent</button><button class="btn btn-primary" onclick="go('outil-8')">Suivant ‚Üí</button></div>
                    </div>
                </div>
            </section>

            <!-- Outil 8 -->
            <section id="outil-8" class="section">
                <h2>‚öñÔ∏è Outil 8 : Arbre √† Probl√®me</h2>
                <p class="text-muted mb-2">Identifiez causes (racines) et effets (branches) du probl√®me.</p>
                <div class="card">
                    <div class="card-body">
                        <div class="form-group"><label class="form-label">Probl√®me central <span class="req">*</span></label><input type="text" class="form-input" data-field="arbre_probleme" id="problem-input" placeholder="Ex: Difficult√© d'acc√®s au logement"></div>
                        <div class="tree-container">
                            <div class="tree-level">
                                <div class="tree-level-title">üåø Effets (cons√©quences)</div>
                                <div class="tree-add"><input type="text" class="form-input" id="effect-input" placeholder="Ajouter un effet..."><button class="btn btn-secondary" onclick="addTree('effect')">Ajouter</button></div>
                                <div class="tree-items" id="effects-list"></div>
                            </div>
                            <div class="tree-level" style="text-align:center;padding:1rem"><div class="tree-item problem" style="display:inline-flex" id="problem-display">‚Üí D√©finissez le probl√®me ci-dessus ‚Üê</div></div>
                            <div class="tree-level">
                                <div class="tree-level-title">üå± Causes (origines)</div>
                                <div class="tree-add"><input type="text" class="form-input" id="cause-input" placeholder="Ajouter une cause..."><button class="btn btn-secondary" onclick="addTree('cause')">Ajouter</button></div>
                                <div class="tree-items" id="causes-list"></div>
                            </div>
                        </div>
                        <div class="form-group mt-2"><label class="form-label">Objectif central (inverse du probl√®me)</label><input type="text" class="form-input" data-field="arbre_objectif" placeholder="Ex: Acc√®s facilit√© au logement"></div>
                        <div class="nav-btns"><button class="btn btn-secondary" onclick="go('outil-7')">‚Üê Pr√©c√©dent</button><button class="btn btn-primary" onclick="go('outil-9')">Suivant ‚Üí</button></div>
                    </div>
                </div>
            </section>

            <!-- Outil 9 -->
            <section id="outil-9" class="section">
                <h2>‚öñÔ∏è Outil 9 : Les 5 Pourquoi</h2>
                <p class="text-muted mb-2">Remontez √† la cause racine en posant "Pourquoi ?" it√©rativement.</p>
                <div class="card">
                    <div class="card-body">
                        <div class="form-group"><label class="form-label">Probl√®me de d√©part</label><input type="text" class="form-input" data-field="p5_probleme" placeholder="Quel probl√®me analyser ?"></div>
                        <div class="form-group"><label class="form-label">1Ô∏è‚É£ Pourquoi ?</label><textarea class="form-textarea" data-field="p5_1" placeholder="Premi√®re r√©ponse..."></textarea></div>
                        <div class="form-group"><label class="form-label">2Ô∏è‚É£ Pourquoi ?</label><textarea class="form-textarea" data-field="p5_2" placeholder="Deuxi√®me r√©ponse..."></textarea></div>
                        <div class="form-group"><label class="form-label">3Ô∏è‚É£ Pourquoi ?</label><textarea class="form-textarea" data-field="p5_3" placeholder="Troisi√®me r√©ponse..."></textarea></div>
                        <div class="form-group"><label class="form-label">4Ô∏è‚É£ Pourquoi ?</label><textarea class="form-textarea" data-field="p5_4" placeholder="Quatri√®me r√©ponse..."></textarea></div>
                        <div class="form-group"><label class="form-label">5Ô∏è‚É£ Pourquoi ?</label><textarea class="form-textarea" data-field="p5_5" placeholder="Cinqui√®me r√©ponse..."></textarea></div>
                        <div class="form-group"><label class="form-label">üéØ Cause racine</label><textarea class="form-textarea" data-field="p5_racine" placeholder="Synth√®se : la cause fondamentale"></textarea></div>
                        <div class="nav-btns"><button class="btn btn-secondary" onclick="go('outil-8')">‚Üê Pr√©c√©dent</button><button class="btn btn-primary" onclick="go('outil-10')">Phase AGIR ‚Üí</button></div>
                    </div>
                </div>
            </section>

            <!-- Outil 10 -->
            <section id="outil-10" class="section">
                <h2>üöÄ Outil 10 : Modes d'Action</h2>
                <p class="text-muted mb-2">Avec, Sans ou Contre le pouvoir ?</p>
                <div class="card">
                    <div class="card-body">
                        <div class="tip"><strong>üí° Conseil :</strong> Trois approches compl√©mentaires selon le contexte.</div>
                        <div class="choice-group mb-2">
                            <label class="choice-item"><input type="checkbox" data-field="mode_avec"><div><div class="choice-title">ü§ù AVEC le pouvoir</div><div class="choice-desc">Collaboration, consultation, co-construction</div></div></label>
                            <label class="choice-item"><input type="checkbox" data-field="mode_sans"><div><div class="choice-title">üîÑ SANS le pouvoir</div><div class="choice-desc">Cr√©er des alternatives, d√©montrer un autre mod√®le</div></div></label>
                            <label class="choice-item"><input type="checkbox" data-field="mode_contre"><div><div class="choice-title">‚úä CONTRE le pouvoir</div><div class="choice-desc">Contester, faire pression, actions directes</div></div></label>
                        </div>
                        <div class="form-group"><label class="form-label">Justification</label><textarea class="form-textarea lg" data-field="mode_justif" placeholder="Pourquoi ce(s) mode(s) ? Avantages et risques ?"></textarea></div>
                        <div class="nav-btns"><button class="btn btn-secondary" onclick="go('outil-9')">‚Üê Pr√©c√©dent</button><button class="btn btn-primary" onclick="go('outil-11')">Suivant ‚Üí</button></div>
                    </div>
                </div>
            </section>

            <!-- Outil 11 -->
            <section id="outil-11" class="section">
                <h2>üöÄ Outil 11 : Objectifs SMART</h2>
                <p class="text-muted mb-2">Sp√©cifique, Mesurable, Atteignable, R√©aliste, Temporel.</p>
                <div class="card">
                    <div class="card-body">
                        <div class="form-group"><label class="form-label">üìç Sp√©cifique</label><textarea class="form-textarea" data-field="smart_s" placeholder="Objectif pr√©cis..."></textarea></div>
                        <div class="form-group"><label class="form-label">üìä Mesurable</label><textarea class="form-textarea" data-field="smart_m" placeholder="Indicateurs de succ√®s..."></textarea></div>
                        <div class="form-group"><label class="form-label">üéØ Atteignable</label><textarea class="form-textarea" data-field="smart_a" placeholder="Ressources disponibles..."></textarea></div>
                        <div class="form-group"><label class="form-label">‚úÖ R√©aliste</label><textarea class="form-textarea" data-field="smart_r" placeholder="Pertinence dans le contexte..."></textarea></div>
                        <div class="form-group"><label class="form-label">‚è∞ Temporel</label><div class="form-row"><input type="date" class="form-input" data-field="smart_date"><input type="text" class="form-input" data-field="smart_delai" placeholder="Ex: D'ici 6 mois"></div></div>
                        <div class="form-group"><label class="form-label">üìù Objectif SMART complet</label><textarea class="form-textarea lg" data-field="smart_objectif" placeholder="Ex: D'ici d√©cembre 2025, obtenir 10 000 signatures..."></textarea></div>
                        <div class="nav-btns"><button class="btn btn-secondary" onclick="go('outil-10')">‚Üê Pr√©c√©dent</button><button class="btn btn-primary" onclick="go('outil-12')">Suivant ‚Üí</button></div>
                    </div>
                </div>
            </section>

            <!-- Outil 12 -->
            <section id="outil-12" class="section">
                <h2>üöÄ Outil 12 : Cibles et Alliances</h2>
                <p class="text-muted mb-2">Identifiez vos cibles et construisez vos alliances.</p>
                <div class="card">
                    <div class="card-body">
                        <h4 class="mb-1">Cibles</h4>
                        <div class="form-group"><label class="form-label">üéØ Cible primaire (d√©cideur)</label><input type="text" class="form-input" data-field="cible_1" placeholder="Ex: Ministre"><textarea class="form-textarea mt-1" data-field="cible_1_strat" placeholder="Strat√©gie d'approche..."></textarea></div>
                        <div class="form-group"><label class="form-label">üéØ Cible secondaire (influenceur)</label><input type="text" class="form-input" data-field="cible_2" placeholder="Ex: Conseiller"><textarea class="form-textarea mt-1" data-field="cible_2_strat" placeholder="Strat√©gie d'approche..."></textarea></div>
                        <h4 class="mt-2 mb-1">Alliances</h4>
                        <div class="form-group"><label class="form-label">ü§ù Alli√©s naturels</label><textarea class="form-textarea" data-field="alliance_naturels" placeholder="M√™mes objectifs..."></textarea></div>
                        <div class="form-group"><label class="form-label">üîó Alli√©s potentiels</label><textarea class="form-textarea" data-field="alliance_potentiels" placeholder="Int√©r√™ts convergents..."></textarea></div>
                        <div class="nav-btns"><button class="btn btn-secondary" onclick="go('outil-11')">‚Üê Pr√©c√©dent</button><button class="btn btn-primary" onclick="go('outil-13')">Suivant ‚Üí</button></div>
                    </div>
                </div>
            </section>

            <!-- Outil 13 -->
            <section id="outil-13" class="section">
                <h2>üöÄ Outil 13 : Construire un Message</h2>
                <p class="text-muted mb-2">5 composantes : accroche, probl√®me, importance, cible, action.</p>
                <div class="card">
                    <div class="card-body">
                        <div class="form-group"><label class="form-label">üé£ Accroche</label><textarea class="form-textarea" data-field="msg_accroche" placeholder="Phrase choc..."></textarea><div class="form-hint">Fait marquant, statistique, question rh√©torique...</div></div>
                        <div class="form-group"><label class="form-label">‚ö†Ô∏è Probl√®me</label><textarea class="form-textarea" data-field="msg_probleme" placeholder="Description du probl√®me..."></textarea></div>
                        <div class="form-group"><label class="form-label">üí° Importance</label><textarea class="form-textarea" data-field="msg_importance" placeholder="Cons√©quences, urgence..."></textarea></div>
                        <div class="form-group"><label class="form-label">üéØ Destinataire</label><input type="text" class="form-input" data-field="msg_cible" placeholder="Ex: Madame la Ministre"></div>
                        <div class="form-group"><label class="form-label">‚úã Action demand√©e</label><textarea class="form-textarea" data-field="msg_action" placeholder="Ce que vous demandez..."></textarea></div>
                        <div class="msg-preview">
                            <div class="msg-preview-title">Aper√ßu du message</div>
                            <div class="msg-preview-content" id="msg-preview">Remplissez les champs pour voir le message...</div>
                            <div class="msg-actions"><button class="btn btn-secondary btn-sm" onclick="copyMsg()">üìã Copier</button></div>
                        </div>
                        <div class="nav-btns"><button class="btn btn-secondary" onclick="go('outil-12')">‚Üê Pr√©c√©dent</button><button class="btn btn-primary" onclick="go('outil-14')">Suivant ‚Üí</button></div>
                    </div>
                </div>
            </section>

            <!-- Outil 14 -->
            <section id="outil-14" class="section">
                <h2>üöÄ Outil 14 : Check-list Rencontre</h2>
                <p class="text-muted mb-2">Pr√©parez efficacement vos rencontres avec les d√©cideurs.</p>
                <div class="card">
                    <div class="card-body">
                        <h4 class="mb-1">Avant</h4>
                        <div class="checklist">
                            <div class="check-item" data-check="c1" onclick="toggleCheck(this)"><div class="check-box"></div><span class="check-text">Cible et int√©r√™ts identifi√©s</span></div>
                            <div class="check-item" data-check="c2" onclick="toggleCheck(this)"><div class="check-box"></div><span class="check-text">Message cl√© pr√©par√©</span></div>
                            <div class="check-item" data-check="c3" onclick="toggleCheck(this)"><div class="check-box"></div><span class="check-text">Documents de soutien rassembl√©s</span></div>
                            <div class="check-item" data-check="c4" onclick="toggleCheck(this)"><div class="check-box"></div><span class="check-text">Objections anticip√©es</span></div>
                        </div>
                        <h4 class="mt-2 mb-1">Pendant</h4>
                        <div class="checklist">
                            <div class="check-item" data-check="c5" onclick="toggleCheck(this)"><div class="check-box"></div><span class="check-text">Pr√©sentation et objectif expliqu√©s</span></div>
                            <div class="check-item" data-check="c6" onclick="toggleCheck(this)"><div class="check-box"></div><span class="check-text">√âcoute active, notes</span></div>
                            <div class="check-item" data-check="c7" onclick="toggleCheck(this)"><div class="check-box"></div><span class="check-text">Demande formul√©e clairement</span></div>
                            <div class="check-item" data-check="c8" onclick="toggleCheck(this)"><div class="check-box"></div><span class="check-text">Prochaines √©tapes propos√©es</span></div>
                        </div>
                        <h4 class="mt-2 mb-1">Apr√®s</h4>
                        <div class="checklist">
                            <div class="check-item" data-check="c9" onclick="toggleCheck(this)"><div class="check-box"></div><span class="check-text">Mail de remerciement envoy√©</span></div>
                            <div class="check-item" data-check="c10" onclick="toggleCheck(this)"><div class="check-box"></div><span class="check-text">Compte-rendu partag√©</span></div>
                            <div class="check-item" data-check="c11" onclick="toggleCheck(this)"><div class="check-box"></div><span class="check-text">Suivi planifi√©</span></div>
                            <div class="check-item" data-check="c12" onclick="toggleCheck(this)"><div class="check-box"></div><span class="check-text">Apprentissages document√©s</span></div>
                        </div>
                        <div class="form-group mt-2"><label class="form-label">Notes</label><textarea class="form-textarea lg" data-field="rencontre_notes" placeholder="Notes pour la prochaine rencontre..."></textarea></div>
                        <div class="nav-btns"><button class="btn btn-secondary" onclick="go('outil-13')">‚Üê Pr√©c√©dent</button><button class="btn btn-primary" onclick="go('outil-15')">Suivant ‚Üí</button></div>
                    </div>
                </div>
            </section>

            <!-- Outil 15 -->
            <section id="outil-15" class="section">
                <h2>üöÄ Outil 15 : Suivi et √âvaluation</h2>
                <p class="text-muted mb-2">Mesurez l'impact et tirez les le√ßons.</p>
                <div class="card">
                    <div class="card-body">
                        <div class="form-group"><label class="form-label">üìä Indicateurs</label><textarea class="form-textarea" data-field="eval_indic" placeholder="Comment mesurer le succ√®s ?"></textarea></div>
                        <div class="form-group"><label class="form-label">üéØ Atteinte des objectifs</label><select class="form-select" data-field="eval_atteinte"><option value="">S√©lectionnez...</option><option value="non">Non commenc√©</option><option value="cours">En cours</option><option value="partiel">Partiel</option><option value="atteint">Atteint</option><option value="depasse">D√©pass√©</option></select></div>
                        <div class="form-group"><label class="form-label">‚úÖ Ce qui a fonctionn√©</label><textarea class="form-textarea" data-field="eval_succes" placeholder="Points forts..."></textarea></div>
                        <div class="form-group"><label class="form-label">‚ö†Ô∏è Difficult√©s</label><textarea class="form-textarea" data-field="eval_diff" placeholder="Obstacles, impr√©vus..."></textarea></div>
                        <div class="form-group"><label class="form-label">üí° Le√ßons apprises</label><textarea class="form-textarea lg" data-field="eval_lecons" placeholder="Qu'avez-vous appris ?"></textarea></div>
                        <div class="form-group"><label class="form-label">üîÑ Prochaines √©tapes</label><textarea class="form-textarea" data-field="eval_next" placeholder="Actions √† mener..."></textarea></div>
                        <div class="nav-btns"><button class="btn btn-secondary" onclick="go('outil-14')">‚Üê Pr√©c√©dent</button><button class="btn btn-gold" onclick="go('dashboard')">üìä Tableau de bord</button></div>
                    </div>
                </div>
            </section>

            <!-- Journal -->
            <section id="journal" class="section">
                <h2>üìì Journal de Bord</h2>
                <p class="text-muted mb-2">Documentez votre parcours de plaidoyer.</p>
                <div class="card mb-2">
                    <div class="card-body">
                        <div class="form-group"><label class="form-label">Nouvelle entr√©e</label><textarea class="form-textarea lg" id="journal-input" placeholder="Actions, rencontres, apprentissages..."></textarea></div>
                        <div class="form-row">
                            <div class="form-group"><label class="form-label">Type</label><select class="form-select" id="journal-type"><option value="note">üìù Note</option><option value="rencontre">ü§ù Rencontre</option><option value="action">‚úä Action</option><option value="succes">üéâ Succ√®s</option><option value="apprentissage">üí° Apprentissage</option></select></div>
                            <div class="form-group" style="display:flex;align-items:flex-end"><button class="btn btn-primary" onclick="addJournal()">‚ûï Ajouter</button></div>
                        </div>
                    </div>
                </div>
                <h4 class="mb-1">Historique (<span id="journal-count">0</span>)</h4>
                <div class="journal-entries" id="journal-entries"><div class="empty" id="no-journal">Aucune entr√©e</div></div>
            </section>

            <!-- Ressources -->
            <section id="ressources" class="section">
                <h2>üìö Ressources</h2>
                <p class="text-muted mb-2">Documentation et outils compl√©mentaires.</p>
                <div class="card mb-2">
                    <div class="card-header"><h3 class="card-title">üìñ Guides</h3></div>
                    <div class="card-body">
                        <ul style="list-style:none;display:flex;flex-direction:column;gap:0.75rem">
                            <li><a href="https://www.justicepaix.be" target="_blank"><strong>Justice et Paix</strong></a> ‚Äî Guide original du Plaidoyer Citoyen</li>
                            <li><a href="https://voxpublic.org" target="_blank"><strong>VoxPublic</strong></a> ‚Äî Ressources de plaidoyer francophones</li>
                            <li><a href="https://www.bond.org.uk/resources/advocacy-toolkit/" target="_blank"><strong>BOND UK</strong></a> ‚Äî 80 √©tudes de cas</li>
                        </ul>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header"><h3 class="card-title">üîß Outils num√©riques</h3></div>
                    <div class="card-body">
                        <ul style="list-style:none;display:flex;flex-direction:column;gap:0.75rem">
                            <li><a href="https://framasoft.org" target="_blank"><strong>Framasoft</strong></a> ‚Äî Outils libres (Framapad, Framadate...)</li>
                            <li><a href="https://decidim.org" target="_blank"><strong>Decidim</strong></a> ‚Äî Plateforme de d√©mocratie participative</li>
                            <li><a href="https://www.loomio.org" target="_blank"><strong>Loomio</strong></a> ‚Äî D√©lib√©ration et d√©cision</li>
                        </ul>
                    </div>
                </div>
            </section>
        </div>
    </main>
</div>

<!-- Modals -->
<div class="modal-overlay" id="import-modal">
    <div class="modal">
        <div class="modal-header"><h3 class="modal-title">üì• Importer</h3><button class="modal-close" onclick="closeModal('import-modal')">√ó</button></div>
        <div class="modal-body">
            <div class="drop-zone" id="drop-zone" ondrop="handleDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)" onclick="document.getElementById('file-input').click()">
                <div class="drop-zone-icon">üìÇ</div>
                <div class="drop-zone-text">Glissez un fichier ici</div>
                <div class="drop-zone-hint">ou cliquez (JSON)</div>
            </div>
            <input type="file" id="file-input" accept=".json" style="display:none" onchange="handleFile(event)">
        </div>
    </div>
</div>

<div class="modal-overlay" id="export-modal">
    <div class="modal">
        <div class="modal-header"><h3 class="modal-title">üì§ Exporter</h3><button class="modal-close" onclick="closeModal('export-modal')">√ó</button></div>
        <div class="modal-body">
            <p class="text-muted mb-2">Choisissez un format :</p>
            <div class="export-options">
                <div class="export-opt" onclick="exportAs('json')"><div class="export-opt-icon">üìã</div><div class="export-opt-name">JSON</div><div class="export-opt-desc">Sauvegarde compl√®te</div></div>
                <div class="export-opt" onclick="exportAs('md')"><div class="export-opt-icon">üìù</div><div class="export-opt-name">Markdown</div><div class="export-opt-desc">Document texte</div></div>
                <div class="export-opt" onclick="exportAs('html')"><div class="export-opt-icon">üåê</div><div class="export-opt-name">HTML</div><div class="export-opt-desc">Page web</div></div>
                <div class="export-opt" onclick="exportAs('csv')"><div class="export-opt-icon">üìä</div><div class="export-opt-name">CSV</div><div class="export-opt-desc">Tableur</div></div>
                <div class="export-opt" onclick="exportAs('txt')"><div class="export-opt-icon">üìÑ</div><div class="export-opt-name">TXT</div><div class="export-opt-desc">Texte brut</div></div>
            </div>
        </div>
    </div>
</div>

<div class="toast-container" id="toast-container"></div>

<script>
// Data
let D = { meta: { name: 'Nouveau projet', created: new Date().toISOString(), updated: new Date().toISOString() }, fields: {}, actors: [], tree: { causes: [], effects: [] }, checks: {}, journal: [] };
const KEY = 'plaidoyer_v3';

// Init
document.addEventListener('DOMContentLoaded', () => {
    load();
    setupListeners();
    updateStats();
    updateMsg();
});

function setupListeners() {
    document.querySelectorAll('.nav-item').forEach(n => n.addEventListener('click', () => go(n.dataset.section)));
    document.getElementById('menu-btn').addEventListener('click', toggleMenu);
    document.getElementById('overlay').addEventListener('click', toggleMenu);
    document.querySelectorAll('[data-field]').forEach(f => {
        const ev = f.type === 'checkbox' || f.type === 'radio' ? 'change' : 'input';
        f.addEventListener(ev, debounce(e => {
            const k = e.target.dataset.field;
            D.fields[k] = e.target.type === 'checkbox' ? e.target.checked : e.target.value;
            D.meta.updated = new Date().toISOString();
            saveLocal();
            updateStats();
        }, 400));
    });
    document.getElementById('actor-power').addEventListener('input', e => document.getElementById('power-val').textContent = e.target.value);
    document.getElementById('problem-input').addEventListener('input', e => document.getElementById('problem-display').textContent = e.target.value || '‚Üí D√©finissez le probl√®me ‚Üê');
    ['msg_accroche','msg_probleme','msg_importance','msg_cible','msg_action'].forEach(f => {
        const el = document.querySelector(`[data-field="${f}"]`);
        if (el) el.addEventListener('input', updateMsg);
    });
    document.addEventListener('keydown', e => { if (e.ctrlKey && e.key === 's') { e.preventDefault(); save(); } });
}

// Navigation
function go(id) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    document.getElementById(id)?.classList.add('active');
    document.querySelectorAll('.nav-item').forEach(n => n.classList.toggle('active', n.dataset.section === id));
    document.getElementById('breadcrumb').textContent = document.querySelector(`[data-section="${id}"]`)?.textContent.trim() || 'Accueil';
    document.getElementById('sidebar').classList.remove('open');
    document.getElementById('overlay').classList.remove('active');
    window.scrollTo(0, 0);
}
function toggleMenu() {
    document.getElementById('sidebar').classList.toggle('open');
    document.getElementById('overlay').classList.toggle('active');
}

// Actors
function addActor() {
    const name = document.getElementById('actor-name').value.trim();
    if (!name) return toast('Entrez un nom', 'error');
    const a = { id: Date.now(), name, org: document.getElementById('actor-org').value.trim(), type: document.getElementById('actor-type').value, power: +document.getElementById('actor-power').value, notes: document.getElementById('actor-notes').value.trim() };
    D.actors.push(a);
    renderActor(a);
    ['actor-name','actor-org','actor-notes'].forEach(x => document.getElementById(x).value = '');
    document.getElementById('actor-type').value = 'neutral';
    document.getElementById('actor-power').value = 5;
    document.getElementById('power-val').textContent = 5;
    document.getElementById('no-actors').style.display = 'none';
    saveLocal(); updateStats(); toast('Acteur ajout√© !');
}
function renderActor(a) {
    const labels = { ally: 'Alli√©', opponent: 'Opposant', neutral: 'Neutre', target: 'Cible' };
    const div = document.createElement('div');
    div.className = `actor-card ${a.type}`;
    div.dataset.id = a.id;
    div.innerHTML = `<div class="actor-header"><div class="actor-name">${esc(a.name)}</div><span class="actor-type ${a.type}">${labels[a.type]}</span></div>${a.org ? `<div class="actor-org">${esc(a.org)}</div>` : ''}<div class="power-row"><span class="power-label">Pouvoir:</span><div class="power-bar"><div class="power-fill" style="width:${a.power*10}%"></div></div><span class="power-val">${a.power}/10</span></div><div class="actor-actions"><button class="btn btn-ghost btn-sm" onclick="delActor(${a.id})">üóëÔ∏è</button></div>`;
    document.getElementById('actors-grid').appendChild(div);
}
function delActor(id) {
    D.actors = D.actors.filter(a => a.id !== id);
    document.querySelector(`.actor-card[data-id="${id}"]`)?.remove();
    if (!D.actors.length) document.getElementById('no-actors').style.display = 'block';
    saveLocal(); updateStats(); toast('Acteur supprim√©', 'info');
}

// Tree
function addTree(type) {
    const input = document.getElementById(type + '-input');
    const val = input.value.trim();
    if (!val) return;
    if (type === 'cause') D.tree.causes.push(val);
    else D.tree.effects.push(val);
    renderTree(type === 'cause' ? 'causes-list' : 'effects-list', val, type);
    input.value = '';
    saveLocal();
}
function renderTree(cid, val, type) {
    const div = document.createElement('div');
    div.className = `tree-item ${type}`;
    div.innerHTML = `<span>${esc(val)}</span><span class="tree-remove" onclick="delTree(this,'${type}','${esc(val)}')">√ó</span>`;
    document.getElementById(cid).appendChild(div);
}
function delTree(el, type, val) {
    if (type === 'cause') D.tree.causes = D.tree.causes.filter(c => c !== val);
    else D.tree.effects = D.tree.effects.filter(e => e !== val);
    el.parentElement.remove();
    saveLocal();
}

// Checklist
function toggleCheck(el) {
    el.classList.toggle('done');
    const done = el.classList.contains('done');
    el.querySelector('.check-box').textContent = done ? '‚úì' : '';
    D.checks[el.dataset.check] = done;
    saveLocal(); updateStats();
}

// Journal
function addJournal() {
    const content = document.getElementById('journal-input').value.trim();
    if (!content) return toast('√âcrivez quelque chose', 'error');
    const e = { id: Date.now(), date: new Date().toISOString(), type: document.getElementById('journal-type').value, content };
    D.journal.unshift(e);
    renderJournal(e);
    document.getElementById('journal-input').value = '';
    document.getElementById('no-journal').style.display = 'none';
    saveLocal(); updateStats(); toast('Entr√©e ajout√©e !');
}
function renderJournal(e) {
    const icons = { note: 'üìù', rencontre: 'ü§ù', action: '‚úä', succes: 'üéâ', apprentissage: 'üí°' };
    const div = document.createElement('div');
    div.className = 'journal-entry';
    div.innerHTML = `<div class="journal-date">${new Date(e.date).toLocaleDateString('fr-FR', { day: 'numeric', month: 'long', year: 'numeric', hour: '2-digit', minute: '2-digit' })}<span class="journal-type">${icons[e.type] || 'üìù'} ${e.type}</span></div><div class="journal-content">${esc(e.content)}</div>`;
    document.getElementById('journal-entries').prepend(div);
}

// Message
function updateMsg() {
    const get = f => document.querySelector(`[data-field="${f}"]`)?.value || '';
    let m = '';
    if (get('msg_accroche')) m += get('msg_accroche') + '\n\n';
    if (get('msg_probleme')) m += get('msg_probleme') + '\n\n';
    if (get('msg_importance')) m += 'Pourquoi c\'est important : ' + get('msg_importance') + '\n\n';
    if (get('msg_cible') && get('msg_action')) m += `Nous demandons √† ${get('msg_cible')} de ${get('msg_action')}`;
    else if (get('msg_action')) m += 'Nous demandons : ' + get('msg_action');
    document.getElementById('msg-preview').textContent = m || 'Remplissez les champs...';
}
function copyMsg() {
    navigator.clipboard.writeText(document.getElementById('msg-preview').textContent).then(() => toast('Copi√© !'));
}

// Stats
function updateStats() {
    const voirF = ['domino_pourquoi','domino_valeurs','domino_changements','domino_sujet','profil_type','profil_temps','profil_competences','fleur_genre','fleur_classe','fleur_reflexion'];
    const jugerF = ['toc_vision','toc_resultats','toc_activites','swot_forces','swot_faiblesses','swot_opportunites','swot_menaces','pestel_p','arbre_probleme','p5_racine'];
    const agirF = ['mode_justif','smart_objectif','cible_1','msg_accroche','msg_probleme','msg_action','eval_indic','eval_lecons'];
    const calcP = fs => Math.round(fs.filter(f => D.fields[f] && String(D.fields[f]).trim()).length / fs.length * 100);
    const vP = calcP(voirF), jP = calcP(jugerF), aP = calcP(agirF), tP = Math.round((vP + jP + aP) / 3);
    const fC = Object.values(D.fields).filter(v => v && String(v).trim()).length;
    const cC = Object.values(D.checks).filter(v => v).length;
    document.getElementById('hero-progress').textContent = tP + '%';
    document.getElementById('hero-actors').textContent = D.actors.length;
    document.getElementById('prog-voir').style.width = vP + '%';
    document.getElementById('prog-juger').style.width = jP + '%';
    document.getElementById('prog-agir').style.width = aP + '%';
    document.getElementById('sidebar-progress').style.width = tP + '%';
    document.getElementById('d-prog').textContent = tP + '%';
    document.getElementById('d-voir').textContent = vP + '%';
    document.getElementById('d-juger').textContent = jP + '%';
    document.getElementById('d-agir').textContent = aP + '%';
    document.getElementById('d-fields').textContent = fC;
    document.getElementById('d-actors').textContent = D.actors.length;
    document.getElementById('d-journal').textContent = D.journal.length;
    document.getElementById('d-checks').textContent = cC + '/12';
    document.getElementById('actors-count').textContent = D.actors.length;
    document.getElementById('journal-count').textContent = D.journal.length;
}

// Save/Load
function saveLocal() { localStorage.setItem(KEY, JSON.stringify(D)); }
function save() { D.meta.updated = new Date().toISOString(); saveLocal(); toast('Sauvegard√© !'); }
function load() {
    const s = localStorage.getItem(KEY);
    if (s) {
        try {
            D = JSON.parse(s);
            Object.entries(D.fields).forEach(([k, v]) => {
                const el = document.querySelector(`[data-field="${k}"]`);
                if (el) { if (el.type === 'checkbox') el.checked = v; else if (el.type === 'radio') { if (el.value === v) el.checked = true; } else el.value = v; }
            });
            if (D.actors.length) { document.getElementById('no-actors').style.display = 'none'; D.actors.forEach(renderActor); }
            D.tree.causes.forEach(c => renderTree('causes-list', c, 'cause'));
            D.tree.effects.forEach(e => renderTree('effects-list', e, 'effect'));
            Object.entries(D.checks).forEach(([k, v]) => { if (v) { const el = document.querySelector(`[data-check="${k}"]`); if (el) { el.classList.add('done'); el.querySelector('.check-box').textContent = '‚úì'; } } });
            if (D.journal.length) { document.getElementById('no-journal').style.display = 'none'; D.journal.forEach(renderJournal); }
            if (D.meta.name) document.getElementById('project-name').textContent = D.meta.name;
            const pEl = document.getElementById('problem-input');
            if (pEl?.value) document.getElementById('problem-display').textContent = pEl.value;
        } catch (e) { console.error(e); }
    }
}

// Import/Export
function exportAs(fmt) {
    const fn = 'plaidoyer_' + new Date().toISOString().slice(0, 10);
    let c, t;
    if (fmt === 'json') { c = JSON.stringify(D, null, 2); t = 'application/json'; }
    else if (fmt === 'md') {
        c = `# Projet de Plaidoyer Citoyen\n\n_Export√© le ${new Date().toLocaleDateString('fr-FR')}_\n\n`;
        Object.entries(D.fields).forEach(([k, v]) => { if (v && String(v).trim()) c += `## ${k.replace(/_/g, ' ')}\n\n${v}\n\n`; });
        t = 'text/markdown';
    } else if (fmt === 'html') {
        c = `<!DOCTYPE html><html lang="fr"><head><meta charset="UTF-8"><title>Plaidoyer</title><style>body{font-family:system-ui;max-width:800px;margin:0 auto;padding:2rem;line-height:1.6}h1{color:#2c5282}h2{color:#319795;border-bottom:2px solid #e2e8f0;padding-bottom:0.5rem}.field{margin-bottom:1.5rem;padding:1rem;background:#f7fafc;border-radius:8px;border-left:4px solid #4299e1}</style></head><body><h1>Projet de Plaidoyer</h1>`;
        Object.entries(D.fields).forEach(([k, v]) => { if (v && String(v).trim()) c += `<div class="field"><h2>${k.replace(/_/g, ' ')}</h2><p>${esc(String(v))}</p></div>`; });
        c += '</body></html>'; t = 'text/html';
    } else if (fmt === 'csv') {
        c = 'Champ,Valeur\n';
        Object.entries(D.fields).forEach(([k, v]) => { if (v) c += `"${k}","${String(v).replace(/"/g, '""')}"\n`; });
        t = 'text/csv';
    } else if (fmt === 'txt') {
        c = `PROJET DE PLAIDOYER\n${'='.repeat(40)}\n\n`;
        Object.entries(D.fields).forEach(([k, v]) => { if (v && String(v).trim()) c += `${k.replace(/_/g, ' ').toUpperCase()}\n${'-'.repeat(30)}\n${v}\n\n`; });
        t = 'text/plain';
    }
    download(c, fn + '.' + fmt, t);
    closeModal('export-modal');
    toast(`Export ${fmt.toUpperCase()} OK !`);
}
function download(c, fn, t) {
    const b = new Blob([c], { type: t + ';charset=utf-8' });
    const u = URL.createObjectURL(b);
    const a = document.createElement('a');
    a.href = u; a.download = fn;
    document.body.appendChild(a); a.click(); document.body.removeChild(a);
    URL.revokeObjectURL(u);
}
function handleDrop(e) { e.preventDefault(); e.target.classList.remove('dragover'); if (e.dataTransfer.files[0]) importFile(e.dataTransfer.files[0]); }
function handleDragOver(e) { e.preventDefault(); e.currentTarget.classList.add('dragover'); }
function handleDragLeave(e) { e.currentTarget.classList.remove('dragover'); }
function handleFile(e) { if (e.target.files[0]) importFile(e.target.files[0]); }
function importFile(f) {
    const r = new FileReader();
    r.onload = e => {
        try {
            D = JSON.parse(e.target.result);
            saveLocal(); location.reload();
        } catch { toast('Fichier invalide', 'error'); }
    };
    r.readAsText(f);
    closeModal('import-modal');
}

// Modals
function openModal(id) { document.getElementById(id).classList.add('active'); }
function closeModal(id) { document.getElementById(id).classList.remove('active'); }
document.querySelectorAll('.modal-overlay').forEach(o => o.addEventListener('click', e => { if (e.target === o) o.classList.remove('active'); }));

// Utils
function esc(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }
function debounce(fn, ms) { let t; return (...a) => { clearTimeout(t); t = setTimeout(() => fn(...a), ms); }; }
function toast(msg, type = 'success') {
    const c = document.getElementById('toast-container');
    const t = document.createElement('div');
    t.className = 'toast ' + type;
    const icons = { success: '‚úÖ', error: '‚ùå', info: '‚ÑπÔ∏è' };
    t.innerHTML = `<span>${icons[type] || '‚ÑπÔ∏è'}</span><span>${msg}</span>`;
    c.appendChild(t);
    setTimeout(() => { t.style.opacity = '0'; t.style.transform = 'translateX(100%)'; setTimeout(() => t.remove(), 300); }, 3000);
}
</script>
</body>
</html>
