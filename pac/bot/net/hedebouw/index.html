<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0a0a0f">
    <meta name="description" content="Plaidoyer Citoyen - Poste de travail pour la participation citoyenne">
    <title>Plaidoyer Citoyen 3.0</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VARIABLES & RESET
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
    --bg-deep: #0a0a0f;
    --bg-base: #0f0f16;
    --bg-card: #151520;
    --bg-elevated: #1a1a28;
    --bg-input: #12121c;
    
    --green-soft: #7fefaf;
    --green-medium: #5fd38d;
    --green-dark: #3da86d;
    --green-glow: rgba(127, 239, 175, 0.25);
    --green-subtle: rgba(127, 239, 175, 0.08);
    
    --lilac-soft: #c9b8ff;
    --lilac-medium: #a78bfa;
    --lilac-dark: #8b5cf6;
    --lilac-glow: rgba(201, 184, 255, 0.25);
    --lilac-subtle: rgba(201, 184, 255, 0.08);
    
    --cyan: #67e8f9;
    --orange: #fbbf24;
    --rose: #fb7185;
    
    --text-primary: #f0f0f8;
    --text-secondary: #a0a0b8;
    --text-muted: #606078;
    
    --border: rgba(127, 239, 175, 0.15);
    --border-lilac: rgba(201, 184, 255, 0.15);
    
    --radius-sm: 8px;
    --radius-md: 12px;
    --radius-lg: 16px;
    --radius-xl: 24px;
    
    --shadow-glow-green: 0 0 20px var(--green-glow), 0 0 40px rgba(127, 239, 175, 0.1);
    --shadow-glow-lilac: 0 0 20px var(--lilac-glow), 0 0 40px rgba(201, 184, 255, 0.1);
    
    --transition: 0.2s ease;
    --font-main: 'Nunito', system-ui, sans-serif;
    --font-mono: 'Space Mono', monospace;
}

*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; -webkit-tap-highlight-color: transparent; }

body {
    font-family: var(--font-main);
    background: var(--bg-deep);
    color: var(--text-primary);
    line-height: 1.6;
    min-height: 100vh;
    min-height: 100dvh;
    overflow-x: hidden;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LAYOUT MOBILE-FIRST
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.app {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    min-height: 100dvh;
}

.header {
    position: sticky;
    top: 0;
    z-index: 100;
    background: rgba(10, 10, 15, 0.92);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border-bottom: 1px solid var(--border);
    padding: 0.75rem 1rem;
}

.header-inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    max-width: 1400px;
    margin: 0 auto;
}

.logo {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.logo-icon {
    width: 32px;
    height: 32px;
    background: linear-gradient(135deg, var(--green-soft), var(--lilac-soft));
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem;
    box-shadow: var(--shadow-glow-green);
}

.logo-text {
    font-weight: 700;
    font-size: 0.95rem;
    background: linear-gradient(135deg, var(--green-soft), var(--lilac-soft));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.header-actions {
    display: flex;
    gap: 0.5rem;
}

.main {
    flex: 1;
    padding: 1rem;
    padding-bottom: calc(80px + env(safe-area-inset-bottom));
    max-width: 1400px;
    margin: 0 auto;
    width: 100%;
}

/* Bottom Navigation Mobile */
.bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(15, 15, 22, 0.95);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
    border-top: 1px solid var(--border);
    padding: 0.5rem 0.25rem;
    padding-bottom: calc(0.5rem + env(safe-area-inset-bottom));
    z-index: 100;
}

.nav-tabs {
    display: flex;
    justify-content: space-around;
    max-width: 500px;
    margin: 0 auto;
}

.nav-tab {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.2rem;
    padding: 0.5rem 0.75rem;
    border-radius: var(--radius-md);
    background: transparent;
    border: none;
    color: var(--text-muted);
    font-family: var(--font-main);
    font-size: 0.65rem;
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition);
    min-width: 60px;
}

.nav-tab-icon {
    font-size: 1.25rem;
    transition: transform var(--transition);
}

.nav-tab.active {
    color: var(--green-soft);
    background: var(--green-subtle);
}

.nav-tab.active .nav-tab-icon {
    transform: scale(1.1);
}

.nav-tab:active {
    transform: scale(0.95);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTIONS & CARDS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.section {
    display: none;
    animation: fadeIn 0.3s ease;
}

.section.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.section-header {
    margin-bottom: 1.25rem;
}

.section-title {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 0.25rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.section-subtitle {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    margin-bottom: 1rem;
    overflow: hidden;
    transition: all var(--transition);
}

.card:hover {
    border-color: var(--green-soft);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
}

.card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem;
    cursor: pointer;
    user-select: none;
    -webkit-user-select: none;
}

.card-header:active {
    background: var(--bg-elevated);
}

.card-title-group {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.card-icon {
    width: 40px;
    height: 40px;
    background: var(--green-subtle);
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
}

.card-icon.lilac {
    background: var(--lilac-subtle);
}

.card-icon.orange {
    background: rgba(251, 191, 36, 0.1);
}

.card-title {
    font-weight: 700;
    font-size: 1rem;
}

.card-number {
    font-family: var(--font-mono);
    font-size: 0.7rem;
    color: var(--text-muted);
}

.card-toggle {
    font-size: 1.25rem;
    color: var(--text-muted);
    transition: transform var(--transition);
}

.card.open .card-toggle {
    transform: rotate(180deg);
}

.card-body {
    display: none;
    padding: 0 1rem 1rem;
}

.card.open .card-body {
    display: block;
}

.card-description {
    background: var(--bg-input);
    border-radius: var(--radius-sm);
    padding: 0.75rem;
    margin-bottom: 1rem;
    font-size: 0.85rem;
    color: var(--text-secondary);
    border-left: 3px solid var(--green-soft);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORM ELEMENTS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.form-group {
    margin-bottom: 1rem;
}

.form-label {
    display: block;
    font-weight: 600;
    font-size: 0.85rem;
    margin-bottom: 0.4rem;
    color: var(--text-secondary);
}

.form-input,
.form-textarea,
.form-select {
    width: 100%;
    padding: 0.75rem 1rem;
    background: var(--bg-input);
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    color: var(--text-primary);
    font-family: var(--font-main);
    font-size: 1rem;
    transition: all var(--transition);
    -webkit-appearance: none;
}

.form-input:focus,
.form-textarea:focus,
.form-select:focus {
    outline: none;
    border-color: var(--green-soft);
    box-shadow: 0 0 0 3px var(--green-glow);
}

.form-textarea {
    min-height: 100px;
    resize: vertical;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr;
    gap: 0.75rem;
}

@media (min-width: 480px) {
    .form-row.two-col {
        grid-template-columns: 1fr 1fr;
    }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUTTONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.4rem;
    padding: 0.65rem 1rem;
    border-radius: var(--radius-md);
    font-family: var(--font-main);
    font-weight: 600;
    font-size: 0.85rem;
    border: none;
    cursor: pointer;
    transition: all var(--transition);
    min-height: 44px;
    white-space: nowrap;
}

.btn:active {
    transform: scale(0.97);
}

.btn-primary {
    background: linear-gradient(135deg, var(--green-soft), var(--green-medium));
    color: var(--bg-deep);
}

.btn-primary:hover {
    box-shadow: var(--shadow-glow-green);
}

.btn-secondary {
    background: var(--bg-elevated);
    color: var(--text-primary);
    border: 1px solid var(--border);
}

.btn-secondary:hover {
    border-color: var(--lilac-soft);
    color: var(--lilac-soft);
}

.btn-ghost {
    background: transparent;
    color: var(--text-secondary);
    padding: 0.5rem;
}

.btn-ghost:hover {
    color: var(--green-soft);
    background: var(--green-subtle);
}

.btn-sm {
    padding: 0.4rem 0.75rem;
    font-size: 0.8rem;
    min-height: 36px;
}

.btn-danger {
    background: rgba(251, 113, 133, 0.15);
    color: var(--rose);
    border: 1px solid rgba(251, 113, 133, 0.3);
}

.btn-danger:hover {
    background: rgba(251, 113, 133, 0.25);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DASHBOARD
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.75rem;
    margin-bottom: 1.5rem;
}

@media (min-width: 600px) {
    .stats-grid {
        grid-template-columns: repeat(4, 1fr);
    }
}

.stat-card {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    padding: 1rem;
    text-align: center;
}

.stat-value {
    font-family: var(--font-mono);
    font-size: 1.75rem;
    font-weight: 700;
    color: var(--green-soft);
    line-height: 1.2;
}

.stat-value.lilac { color: var(--lilac-soft); }
.stat-value.cyan { color: var(--cyan); }
.stat-value.orange { color: var(--orange); }

.stat-label {
    font-size: 0.75rem;
    color: var(--text-muted);
    margin-top: 0.25rem;
}

.progress-section {
    margin-bottom: 1.5rem;
}

.progress-title {
    font-weight: 600;
    margin-bottom: 0.75rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.progress-bar-container {
    background: var(--bg-input);
    border-radius: var(--radius-lg);
    height: 12px;
    overflow: hidden;
    margin-bottom: 0.75rem;
}

.progress-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--green-soft), var(--lilac-soft));
    border-radius: var(--radius-lg);
    transition: width 0.5s ease;
}

.phase-progress {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0.75rem;
}

.phase-item {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    padding: 0.75rem;
    text-align: center;
}

.phase-item.voir { border-color: rgba(103, 232, 249, 0.3); }
.phase-item.juger { border-color: rgba(201, 184, 255, 0.3); }
.phase-item.agir { border-color: rgba(251, 191, 36, 0.3); }

.phase-label {
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 0.25rem;
}

.phase-item.voir .phase-label { color: var(--cyan); }
.phase-item.juger .phase-label { color: var(--lilac-soft); }
.phase-item.agir .phase-label { color: var(--orange); }

.phase-value {
    font-family: var(--font-mono);
    font-size: 1.25rem;
    font-weight: 700;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ARBRE Ã€ PROBLÃˆME (TREE)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tree-container {
    background: var(--bg-input);
    border-radius: var(--radius-md);
    padding: 1rem;
    margin-top: 1rem;
}

.tree-level {
    margin-bottom: 1rem;
}

.tree-level:last-child {
    margin-bottom: 0;
}

.tree-level-title {
    font-weight: 600;
    font-size: 0.85rem;
    margin-bottom: 0.5rem;
    color: var(--text-secondary);
}

.tree-items {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.tree-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    padding: 0.6rem 0.75rem;
    font-size: 0.9rem;
}

.tree-item.effect {
    border-left: 3px solid var(--cyan);
}

.tree-item.cause {
    border-left: 3px solid var(--rose);
}

.tree-item.problem {
    background: var(--lilac-subtle);
    border: 1px solid var(--lilac-soft);
    border-left: 3px solid var(--lilac-soft);
    font-weight: 600;
}

.tree-item-text {
    flex: 1;
}

.tree-item-delete {
    background: none;
    border: none;
    color: var(--text-muted);
    cursor: pointer;
    padding: 0.25rem;
    font-size: 1rem;
    opacity: 0.6;
    transition: all var(--transition);
}

.tree-item-delete:hover {
    opacity: 1;
    color: var(--rose);
}

.tree-add-row {
    display: flex;
    gap: 0.5rem;
    margin-top: 0.5rem;
}

.tree-add-row .form-input {
    flex: 1;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACTEURS (POWER MAP)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.actors-grid {
    display: grid;
    gap: 0.75rem;
    margin-top: 1rem;
}

.actor-card {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    background: var(--bg-input);
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    padding: 0.75rem;
}

.actor-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
    flex-shrink: 0;
}

.actor-avatar.ally { background: rgba(127, 239, 175, 0.2); }
.actor-avatar.target { background: rgba(201, 184, 255, 0.2); }
.actor-avatar.neutral { background: rgba(251, 191, 36, 0.2); }
.actor-avatar.opponent { background: rgba(251, 113, 133, 0.2); }

.actor-info {
    flex: 1;
    min-width: 0;
}

.actor-name {
    font-weight: 600;
    font-size: 0.9rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.actor-meta {
    font-size: 0.75rem;
    color: var(--text-muted);
}

.actor-actions {
    display: flex;
    gap: 0.25rem;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VEILLE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.veille-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.veille-item {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    padding: 1rem;
}

.veille-item-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
}

.veille-item-title {
    font-weight: 600;
    font-size: 0.95rem;
    flex: 1;
}

.veille-item-category {
    font-size: 0.7rem;
    padding: 0.2rem 0.5rem;
    border-radius: var(--radius-sm);
    background: var(--green-subtle);
    color: var(--green-soft);
    font-weight: 600;
}

.veille-item-url {
    font-size: 0.8rem;
    color: var(--lilac-soft);
    word-break: break-all;
}

.veille-item-date {
    font-size: 0.75rem;
    color: var(--text-muted);
    margin-top: 0.5rem;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHECKLIST
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.checklist {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.checklist-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem;
    background: var(--bg-input);
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all var(--transition);
    user-select: none;
    -webkit-user-select: none;
}

.checklist-item:active {
    transform: scale(0.98);
}

.checklist-item.completed {
    background: var(--green-subtle);
    border-color: var(--green-soft);
}

.checkbox {
    width: 22px;
    height: 22px;
    border: 2px solid var(--border);
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    transition: all var(--transition);
}

.checklist-item.completed .checkbox {
    background: var(--green-soft);
    border-color: var(--green-soft);
    color: var(--bg-deep);
}

.checklist-text {
    flex: 1;
    font-size: 0.9rem;
}

.checklist-item.completed .checklist-text {
    text-decoration: line-through;
    opacity: 0.7;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODALS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    display: none;
    align-items: flex-end;
    justify-content: center;
    z-index: 1000;
    padding: 1rem;
}

.modal-overlay.active {
    display: flex;
}

.modal {
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-radius: var(--radius-xl) var(--radius-xl) 0 0;
    width: 100%;
    max-width: 500px;
    max-height: 85vh;
    overflow-y: auto;
    animation: slideUp 0.3s ease;
}

@keyframes slideUp {
    from { transform: translateY(100%); }
    to { transform: translateY(0); }
}

@media (min-width: 600px) {
    .modal-overlay {
        align-items: center;
    }
    .modal {
        border-radius: var(--radius-xl);
    }
}

.modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 1.25rem;
    border-bottom: 1px solid var(--border);
    position: sticky;
    top: 0;
    background: var(--bg-card);
    z-index: 1;
}

.modal-title {
    font-weight: 700;
    font-size: 1.1rem;
}

.modal-close {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: var(--bg-elevated);
    border: none;
    color: var(--text-secondary);
    font-size: 1.25rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all var(--transition);
}

.modal-close:hover {
    background: var(--rose);
    color: white;
}

.modal-body {
    padding: 1.25rem;
}

.modal-footer {
    padding: 1rem 1.25rem;
    border-top: 1px solid var(--border);
    display: flex;
    gap: 0.75rem;
    justify-content: flex-end;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOASTS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.toast-container {
    position: fixed;
    top: 1rem;
    right: 1rem;
    z-index: 2000;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.toast {
    background: var(--bg-elevated);
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    padding: 0.75rem 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
    animation: toastIn 0.3s ease;
    font-size: 0.9rem;
}

@keyframes toastIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

.toast.success { border-color: var(--green-soft); }
.toast.error { border-color: var(--rose); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EXPORT BUTTONS GRID
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.export-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.75rem;
}

@media (min-width: 400px) {
    .export-grid {
        grid-template-columns: repeat(3, 1fr);
    }
}

.export-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.4rem;
    padding: 1rem;
    background: var(--bg-input);
    border: 1px solid var(--border);
    border-radius: var(--radius-md);
    color: var(--text-primary);
    font-family: var(--font-main);
    font-weight: 600;
    font-size: 0.8rem;
    cursor: pointer;
    transition: all var(--transition);
}

.export-btn:hover {
    border-color: var(--green-soft);
    background: var(--green-subtle);
}

.export-btn:active {
    transform: scale(0.97);
}

.export-btn-icon {
    font-size: 1.5rem;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILITIES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.mt-1 { margin-top: 0.5rem; }
.mt-2 { margin-top: 1rem; }
.mb-1 { margin-bottom: 0.5rem; }
.mb-2 { margin-bottom: 1rem; }
.text-center { text-align: center; }
.text-muted { color: var(--text-muted); }
.text-sm { font-size: 0.85rem; }

.empty-state {
    text-align: center;
    padding: 2rem 1rem;
    color: var(--text-muted);
}

.empty-state-icon {
    font-size: 2.5rem;
    margin-bottom: 0.5rem;
    opacity: 0.5;
}

/* Desktop sidebar */
@media (min-width: 900px) {
    .app {
        flex-direction: row;
    }
    
    .bottom-nav {
        position: static;
        width: 220px;
        flex-shrink: 0;
        border-top: none;
        border-right: 1px solid var(--border);
        padding: 1rem 0.75rem;
        height: 100vh;
        height: 100dvh;
        overflow-y: auto;
    }
    
    .nav-tabs {
        flex-direction: column;
        gap: 0.25rem;
    }
    
    .nav-tab {
        flex-direction: row;
        justify-content: flex-start;
        gap: 0.75rem;
        font-size: 0.85rem;
        padding: 0.75rem 1rem;
        width: 100%;
    }
    
    .nav-tab-icon {
        font-size: 1.1rem;
    }
    
    .main {
        padding-bottom: 2rem;
        overflow-y: auto;
        height: 100vh;
        height: 100dvh;
    }
}
    </style>
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="header-inner">
                <div class="logo">
                    <div class="logo-icon">ğŸ—³ï¸</div>
                    <span class="logo-text">Plaidoyer Citoyen</span>
                </div>
                <div class="header-actions">
                    <button class="btn btn-ghost" onclick="openModal('export-modal')" title="Exporter">ğŸ“¤</button>
                    <button class="btn btn-ghost" onclick="openModal('import-modal')" title="Importer">ğŸ“¥</button>
                    <button class="btn btn-primary btn-sm" onclick="saveProject()">ğŸ’¾</button>
                </div>
            </div>
        </header>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <div class="nav-tabs">
                <button class="nav-tab active" data-section="dashboard">
                    <span class="nav-tab-icon">ğŸ“Š</span>
                    <span>Tableau</span>
                </button>
                <button class="nav-tab" data-section="voir">
                    <span class="nav-tab-icon">ğŸ‘ï¸</span>
                    <span>Voir</span>
                </button>
                <button class="nav-tab" data-section="juger">
                    <span class="nav-tab-icon">âš–ï¸</span>
                    <span>Juger</span>
                </button>
                <button class="nav-tab" data-section="agir">
                    <span class="nav-tab-icon">ğŸ¯</span>
                    <span>Agir</span>
                </button>
                <button class="nav-tab" data-section="veille">
                    <span class="nav-tab-icon">ğŸ“¡</span>
                    <span>Veille</span>
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main">
            <!-- DASHBOARD -->
            <section id="dashboard" class="section active">
                <div class="section-header">
                    <h1 class="section-title">ğŸ“Š Tableau de bord</h1>
                    <p class="section-subtitle">Vue d'ensemble de votre projet de plaidoyer</p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="stat-progress">0%</div>
                        <div class="stat-label">Progression</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value lilac" id="stat-fields">0</div>
                        <div class="stat-label">Champs</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value cyan" id="stat-actors">0</div>
                        <div class="stat-label">Acteurs</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value orange" id="stat-veille">0</div>
                        <div class="stat-label">Veille</div>
                    </div>
                </div>

                <div class="progress-section">
                    <div class="progress-title">ğŸš€ Progression globale</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="global-progress-bar" style="width: 0%"></div>
                    </div>
                    <div class="phase-progress">
                        <div class="phase-item voir">
                            <div class="phase-label">ğŸ‘ï¸ Voir</div>
                            <div class="phase-value" id="prog-voir">0%</div>
                        </div>
                        <div class="phase-item juger">
                            <div class="phase-label">âš–ï¸ Juger</div>
                            <div class="phase-value" id="prog-juger">0%</div>
                        </div>
                        <div class="phase-item agir">
                            <div class="phase-label">ğŸ¯ Agir</div>
                            <div class="phase-value" id="prog-agir">0%</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header" onclick="toggleCard(this.parentElement)">
                        <div class="card-title-group">
                            <div class="card-icon">ğŸ“</div>
                            <div>
                                <div class="card-title">Informations du projet</div>
                                <div class="card-number">MÃ©tadonnÃ©es</div>
                            </div>
                        </div>
                        <span class="card-toggle">â–¼</span>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label class="form-label">Nom du projet</label>
                            <input type="text" class="form-input" data-field="project_name" placeholder="Mon projet de plaidoyer">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Description courte</label>
                            <textarea class="form-textarea" data-field="project_description" placeholder="DÃ©crivez briÃ¨vement votre projet..."></textarea>
                        </div>
                    </div>
                </div>
            </section>

            <!-- VOIR -->
            <section id="voir" class="section">
                <div class="section-header">
                    <h1 class="section-title">ğŸ‘ï¸ Phase VOIR</h1>
                    <p class="section-subtitle">Observer et comprendre la situation</p>
                </div>

                <!-- Outil 1: Domino du Changement -->
                <div class="card">
                    <div class="card-header" onclick="toggleCard(this.parentElement)">
                        <div class="card-title-group">
                            <div class="card-icon">ğŸ¡</div>
                            <div>
                                <div class="card-title">Domino du Changement</div>
                                <div class="card-number">Outil #1</div>
                            </div>
                        </div>
                        <span class="card-toggle">â–¼</span>
                    </div>
                    <div class="card-body">
                        <div class="card-description">
                            Identifiez pourquoi vous voulez agir, vos valeurs, les changements souhaitÃ©s et les actions concrÃ¨tes Ã  mener.
                        </div>
                        <div class="form-group">
                            <label class="form-label">ğŸ”¥ Pourquoi voulez-vous agir ?</label>
                            <textarea class="form-textarea" data-field="domino_pourquoi" placeholder="Qu'est-ce qui vous motive Ã  agir ?"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ğŸ’ Quelles valeurs dÃ©fendez-vous ?</label>
                            <textarea class="form-textarea" data-field="domino_valeurs" placeholder="Justice, Ã©quitÃ©, solidaritÃ©..."></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ğŸ¯ Quels changements souhaitez-vous ?</label>
                            <textarea class="form-textarea" data-field="domino_changements" placeholder="DÃ©crivez les changements concrets..."></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">âœŠ Quelles actions allez-vous mener ?</label>
                            <textarea class="form-textarea" data-field="domino_actions" placeholder="Listez les actions envisagÃ©es..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Outil 2: Profil d'engagement -->
                <div class="card">
                    <div class="card-header" onclick="toggleCard(this.parentElement)">
                        <div class="card-title-group">
                            <div class="card-icon">ğŸ‘¤</div>
                            <div>
                                <div class="card-title">Profil d'engagement</div>
                                <div class="card-number">Outil #2</div>
                            </div>
                        </div>
                        <span class="card-toggle">â–¼</span>
                    </div>
                    <div class="card-body">
                        <div class="card-description">
                            DÃ©couvrez votre style d'engagement citoyen pour mieux contribuer au collectif.
                        </div>
                        <div class="form-group">
                            <label class="form-label">Face Ã  un problÃ¨me, vous prÃ©fÃ©rez...</label>
                            <select class="form-select" data-field="profil_q1">
                                <option value="">Choisissez...</option>
                                <option value="analyser">Analyser en profondeur</option>
                                <option value="communiquer">Communiquer et mobiliser</option>
                                <option value="organiser">Organiser et planifier</option>
                                <option value="agir">Agir immÃ©diatement</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Dans un groupe, vous Ãªtes plutÃ´t...</label>
                            <select class="form-select" data-field="profil_q2">
                                <option value="">Choisissez...</option>
                                <option value="leader">Celui/celle qui prend les dÃ©cisions</option>
                                <option value="mediateur">Celui/celle qui facilite les Ã©changes</option>
                                <option value="expert">Celui/celle qui apporte l'expertise</option>
                                <option value="executant">Celui/celle qui met en Å“uvre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Vos compÃ©tences principales</label>
                            <textarea class="form-textarea" data-field="profil_competences" placeholder="Communication, analyse, organisation..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Outil 3: Fleur de pouvoir -->
                <div class="card">
                    <div class="card-header" onclick="toggleCard(this.parentElement)">
                        <div class="card-title-group">
                            <div class="card-icon">ğŸŒ¸</div>
                            <div>
                                <div class="card-title">Fleur de pouvoir</div>
                                <div class="card-number">Outil #3</div>
                            </div>
                        </div>
                        <span class="card-toggle">â–¼</span>
                    </div>
                    <div class="card-body">
                        <div class="card-description">
                            Analysez les diffÃ©rentes dimensions du pouvoir qui influencent votre situation.
                        </div>
                        <div class="form-group">
                            <label class="form-label">Genre</label>
                            <textarea class="form-textarea" data-field="fleur_genre" placeholder="Comment le genre influence la situation ?"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Classe sociale</label>
                            <textarea class="form-textarea" data-field="fleur_classe" placeholder="Impact des inÃ©galitÃ©s Ã©conomiques..."></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Origine / EthnicitÃ©</label>
                            <textarea class="form-textarea" data-field="fleur_origine" placeholder="Discriminations, privilÃ¨ges..."></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Autres facteurs</label>
                            <textarea class="form-textarea" data-field="fleur_autres" placeholder="Ã‚ge, handicap, religion..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Outil 4: Cartographie des acteurs -->
                <div class="card">
                    <div class="card-header" onclick="toggleCard(this.parentElement)">
                        <div class="card-title-group">
                            <div class="card-icon">ğŸ—ºï¸</div>
                            <div>
                                <div class="card-title">Cartographie des acteurs</div>
                                <div class="card-number">Outil #4</div>
                            </div>
                        </div>
                        <span class="card-toggle">â–¼</span>
                    </div>
                    <div class="card-body">
                        <div class="card-description">
                            Identifiez tous les acteurs impliquÃ©s dans votre cause : alliÃ©s, cibles, opposants.
                        </div>
                        
                        <button class="btn btn-primary mb-2" onclick="openModal('actor-modal')">â• Ajouter un acteur</button>
                        
                        <div class="actors-grid" id="actors-list">
                            <div class="empty-state">
                                <div class="empty-state-icon">ğŸ‘¥</div>
                                <p>Aucun acteur ajoutÃ©</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- JUGER -->
            <section id="juger" class="section">
                <div class="section-header">
                    <h1 class="section-title">âš–ï¸ Phase JUGER</h1>
                    <p class="section-subtitle">Analyser et Ã©valuer la situation</p>
                </div>

                <!-- Outil 5: ThÃ©orie du changement -->
                <div class="card">
                    <div class="card-header" onclick="toggleCard(this.parentElement)">
                        <div class="card-title-group">
                            <div class="card-icon lilac">ğŸ”„</div>
                            <div>
                                <div class="card-title">ThÃ©orie du changement</div>
                                <div class="card-number">Outil #5</div>
                            </div>
                        </div>
                        <span class="card-toggle">â–¼</span>
                    </div>
                    <div class="card-body">
                        <div class="card-description">
                            DÃ©finissez la logique de votre intervention : vision, hypothÃ¨ses et missions.
                        </div>
                        <div class="form-group">
                            <label class="form-label">ğŸŒŸ Vision Ã  long terme</label>
                            <textarea class="form-textarea" data-field="toc_vision" placeholder="Quel monde voulez-vous construire ?"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ğŸ’¡ HypothÃ¨ses de changement</label>
                            <textarea class="form-textarea" data-field="toc_hypotheses" placeholder="Si nous faisons X, alors Y se produira..."></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ğŸ¯ Missions concrÃ¨tes</label>
                            <textarea class="form-textarea" data-field="toc_missions" placeholder="Quelles missions pour atteindre la vision ?"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Outil 6: Analyse SWOT -->
                <div class="card">
                    <div class="card-header" onclick="toggleCard(this.parentElement)">
                        <div class="card-title-group">
                            <div class="card-icon lilac">ğŸ“Š</div>
                            <div>
                                <div class="card-title">Analyse SWOT</div>
                                <div class="card-number">Outil #6</div>
                            </div>
                        </div>
                        <span class="card-toggle">â–¼</span>
                    </div>
                    <div class="card-body">
                        <div class="card-description">
                            Forces, Faiblesses, OpportunitÃ©s, Menaces de votre projet.
                        </div>
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label class="form-label">ğŸ’ª Forces</label>
                                <textarea class="form-textarea" data-field="swot_forces" placeholder="Atouts internes..."></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">âš ï¸ Faiblesses</label>
                                <textarea class="form-textarea" data-field="swot_faiblesses" placeholder="Points Ã  amÃ©liorer..."></textarea>
                            </div>
                        </div>
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label class="form-label">ğŸŒ± OpportunitÃ©s</label>
                                <textarea class="form-textarea" data-field="swot_opportunites" placeholder="Facteurs externes favorables..."></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ğŸŒ©ï¸ Menaces</label>
                                <textarea class="form-textarea" data-field="swot_menaces" placeholder="Risques externes..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Outil 7: Analyse PESTEL -->
                <div class="card">
                    <div class="card-header" onclick="toggleCard(this.parentElement)">
                        <div class="card-title-group">
                            <div class="card-icon lilac">ğŸ”¬</div>
                            <div>
                                <div class="card-title">Analyse PESTEL</div>
                                <div class="card-number">Outil #7</div>
                            </div>
                        </div>
                        <span class="card-toggle">â–¼</span>
                    </div>
                    <div class="card-body">
                        <div class="card-description">
                            Analysez l'environnement macro : Politique, Ã‰conomique, Social, Technologique, Ã‰cologique, LÃ©gal.
                        </div>
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label class="form-label">ğŸ›ï¸ Politique</label>
                                <textarea class="form-textarea" data-field="pestel_politique" placeholder="Contexte politique..."></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ğŸ’° Ã‰conomique</label>
                                <textarea class="form-textarea" data-field="pestel_economique" placeholder="Facteurs Ã©conomiques..."></textarea>
                            </div>
                        </div>
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label class="form-label">ğŸ‘¥ Social</label>
                                <textarea class="form-textarea" data-field="pestel_social" placeholder="Tendances sociales..."></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ğŸ’» Technologique</label>
                                <textarea class="form-textarea" data-field="pestel_techno" placeholder="Ã‰volutions technologiques..."></textarea>
                            </div>
                        </div>
                        <div class="form-row two-col">
                            <div class="form-group">
                                <label class="form-label">ğŸŒ Ã‰cologique</label>
                                <textarea class="form-textarea" data-field="pestel_ecolo" placeholder="Enjeux environnementaux..."></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">âš–ï¸ LÃ©gal</label>
                                <textarea class="form-textarea" data-field="pestel_legal" placeholder="Cadre juridique..."></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Outil 8: Arbre Ã  problÃ¨me -->
                <div class="card">
                    <div class="card-header" onclick="toggleCard(this.parentElement)">
                        <div class="card-title-group">
                            <div class="card-icon lilac">ğŸŒ³</div>
                            <div>
                                <div class="card-title">Arbre Ã  problÃ¨me</div>
                                <div class="card-number">Outil #8</div>
                            </div>
                        </div>
                        <span class="card-toggle">â–¼</span>
                    </div>
                    <div class="card-body">
                        <div class="card-description">
                            Visualisez les causes (racines) et effets (branches) du problÃ¨me central.
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">ğŸ¯ ProblÃ¨me central</label>
                            <input type="text" class="form-input" data-field="arbre_probleme" id="tree-problem-input" placeholder="DÃ©finissez le problÃ¨me central..." oninput="updateTreeProblem()">
                        </div>
                        
                        <div class="tree-container">
                            <!-- Effets (haut) -->
                            <div class="tree-level">
                                <div class="tree-level-title">ğŸŒ¿ Effets / ConsÃ©quences</div>
                                <div class="tree-items" id="tree-effects-list"></div>
                                <div class="tree-add-row">
                                    <input type="text" class="form-input" id="effect-input" placeholder="Ajouter un effet...">
                                    <button class="btn btn-secondary btn-sm" onclick="addTreeItem('effect')">+</button>
                                </div>
                            </div>
                            
                            <!-- ProblÃ¨me central -->
                            <div class="tree-level">
                                <div class="tree-items">
                                    <div class="tree-item problem">
                                        <span class="tree-item-text" id="tree-problem-display">â†’ DÃ©finissez le problÃ¨me ci-dessus â†</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Causes (bas) -->
                            <div class="tree-level">
                                <div class="tree-level-title">ğŸŒ± Causes profondes</div>
                                <div class="tree-items" id="tree-causes-list"></div>
                                <div class="tree-add-row">
                                    <input type="text" class="form-input" id="cause-input" placeholder="Ajouter une cause...">
                                    <button class="btn btn-secondary btn-sm" onclick="addTreeItem('cause')">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Outil 9: Les 5 Pourquoi -->
                <div class="card">
                    <div class="card-header" onclick="toggleCard(this.parentElement)">
                        <div class="card-title-group">
                            <div class="card-icon lilac">â“</div>
                            <div>
                                <div class="card-title">Les 5 Pourquoi</div>
                                <div class="card-number">Outil #9</div>
                            </div>
                        </div>
                        <span class="card-toggle">â–¼</span>
                    </div>
                    <div class="card-body">
                        <div class="card-description">
                            Remontez Ã  la cause racine en posant 5 fois la question "Pourquoi ?".
                        </div>
                        <div class="form-group">
                            <label class="form-label">1ï¸âƒ£ Pourquoi ce problÃ¨me existe ?</label>
                            <input type="text" class="form-input" data-field="pourquoi_1" placeholder="PremiÃ¨re rÃ©ponse...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">2ï¸âƒ£ Pourquoi cette cause ?</label>
                            <input type="text" class="form-input" data-field="pourquoi_2" placeholder="DeuxiÃ¨me rÃ©ponse...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">3ï¸âƒ£ Pourquoi encore ?</label>
                            <input type="text" class="form-input" data-field="pourquoi_3" placeholder="TroisiÃ¨me rÃ©ponse...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">4ï¸âƒ£ Et pourquoi cela ?</label>
                            <input type="text" class="form-input" data-field="pourquoi_4" placeholder="QuatriÃ¨me rÃ©ponse...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">5ï¸âƒ£ Cause racine finale</label>
                            <input type="text" class="form-input" data-field="pourquoi_5" placeholder="La cause racine...">
                        </div>
                    </div>
                </div>
            </section>

            <!-- AGIR -->
            <section id="agir" class="section">
                <div class="section-header">
                    <h1 class="section-title">ğŸ¯ Phase AGIR</h1>
                    <p class="section-subtitle">Planifier et mettre en Å“uvre l'action</p>
                </div>

                <!-- Outil 10: Objectifs SMART -->
                <div class="card">
                    <div class="card-header" onclick="toggleCard(this.parentElement)">
                        <div class="card-title-group">
                            <div class="card-icon orange">ğŸ¯</div>
                            <div>
                                <div class="card-title">Objectifs SMART</div>
                                <div class="card-number">Outil #10</div>
                            </div>
                        </div>
                        <span class="card-toggle">â–¼</span>
                    </div>
                    <div class="card-body">
                        <div class="card-description">
                            DÃ©finissez des objectifs SpÃ©cifiques, Mesurables, Atteignables, RÃ©alistes, Temporels.
                        </div>
                        <div class="form-group">
                            <label class="form-label">ğŸ”¹ SpÃ©cifique</label>
                            <input type="text" class="form-input" data-field="smart_s" placeholder="Objectif prÃ©cis et clair...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ğŸ“ Mesurable</label>
                            <input type="text" class="form-input" data-field="smart_m" placeholder="Indicateurs de mesure...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">âœ… Atteignable</label>
                            <input type="text" class="form-input" data-field="smart_a" placeholder="Ressources disponibles...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ğŸ¯ RÃ©aliste</label>
                            <input type="text" class="form-input" data-field="smart_r" placeholder="Pertinence par rapport au contexte...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">â° Temporel</label>
                            <input type="text" class="form-input" data-field="smart_t" placeholder="Ã‰chÃ©ance prÃ©cise...">
                        </div>
                    </div>
                </div>

                <!-- Outil 11: Cibles et Alliances -->
                <div class="card">
                    <div class="card-header" onclick="toggleCard(this.parentElement)">
                        <div class="card-title-group">
                            <div class="card-icon orange">ğŸ¤</div>
                            <div>
                                <div class="card-title">Cibles et Alliances</div>
                                <div class="card-number">Outil #11</div>
                            </div>
                        </div>
                        <span class="card-toggle">â–¼</span>
                    </div>
                    <div class="card-body">
                        <div class="card-description">
                            Identifiez qui peut dÃ©cider (cibles) et qui peut vous aider (alliÃ©s).
                        </div>
                        <div class="form-group">
                            <label class="form-label">ğŸ¯ Cible principale</label>
                            <textarea class="form-textarea" data-field="cible_principale" placeholder="Qui a le pouvoir de dÃ©cision ?"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ğŸ¯ Cibles secondaires</label>
                            <textarea class="form-textarea" data-field="cible_secondaires" placeholder="Qui peut influencer la cible principale ?"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ğŸ¤ AlliÃ©s potentiels</label>
                            <textarea class="form-textarea" data-field="allies" placeholder="Qui partage vos objectifs ?"></textarea>
                        </div>
                    </div>
                </div>

                <!-- Outil 12: Construction du message -->
                <div class="card">
                    <div class="card-header" onclick="toggleCard(this.parentElement)">
                        <div class="card-title-group">
                            <div class="card-icon orange">ğŸ’¬</div>
                            <div>
                                <div class="card-title">Construction du message</div>
                                <div class="card-number">Outil #12</div>
                            </div>
                        </div>
                        <span class="card-toggle">â–¼</span>
                    </div>
                    <div class="card-body">
                        <div class="card-description">
                            Construisez un message de plaidoyer percutant et mÃ©morable.
                        </div>
                        <div class="form-group">
                            <label class="form-label">ğŸ”¥ Accroche</label>
                            <input type="text" class="form-input" data-field="msg_accroche" placeholder="Une phrase choc pour capter l'attention..." oninput="updateMessagePreview()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">ğŸ˜° Le problÃ¨me</label>
                            <textarea class="form-textarea" data-field="msg_probleme" placeholder="DÃ©crivez le problÃ¨me de faÃ§on concrÃ¨te..." oninput="updateMessagePreview()"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ğŸ’¡ La solution</label>
                            <textarea class="form-textarea" data-field="msg_solution" placeholder="Quelle solution proposez-vous ?" oninput="updateMessagePreview()"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">âœŠ Appel Ã  l'action</label>
                            <input type="text" class="form-input" data-field="msg_action" placeholder="Que doit faire la cible ?" oninput="updateMessagePreview()">
                        </div>
                        
                        <div class="form-group mt-2">
                            <label class="form-label">ğŸ“ AperÃ§u du message</label>
                            <div id="message-preview" style="background: var(--bg-input); padding: 1rem; border-radius: var(--radius-md); border-left: 3px solid var(--orange); font-style: italic; color: var(--text-secondary);">
                                Remplissez les champs ci-dessus pour voir l'aperÃ§u...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Outil 13: Check-list rencontre -->
                <div class="card">
                    <div class="card-header" onclick="toggleCard(this.parentElement)">
                        <div class="card-title-group">
                            <div class="card-icon orange">âœ…</div>
                            <div>
                                <div class="card-title">Check-list rencontre</div>
                                <div class="card-number">Outil #13</div>
                            </div>
                        </div>
                        <span class="card-toggle">â–¼</span>
                    </div>
                    <div class="card-body">
                        <div class="card-description">
                            PrÃ©parez efficacement une rencontre de plaidoyer.
                        </div>
                        <div class="checklist" id="checklist">
                            <!-- Items gÃ©nÃ©rÃ©s par JS -->
                        </div>
                    </div>
                </div>

                <!-- Outil 14: Suivi-Ã©valuation -->
                <div class="card">
                    <div class="card-header" onclick="toggleCard(this.parentElement)">
                        <div class="card-title-group">
                            <div class="card-icon orange">ğŸ“ˆ</div>
                            <div>
                                <div class="card-title">Suivi et Ã©valuation</div>
                                <div class="card-number">Outil #14</div>
                            </div>
                        </div>
                        <span class="card-toggle">â–¼</span>
                    </div>
                    <div class="card-body">
                        <div class="card-description">
                            Ã‰valuez l'impact de vos actions et ajustez votre stratÃ©gie.
                        </div>
                        <div class="form-group">
                            <label class="form-label">ğŸ“Š Indicateurs de suivi</label>
                            <textarea class="form-textarea" data-field="suivi_indicateurs" placeholder="Quels indicateurs mesurer ?"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">âœ… RÃ©sultats obtenus</label>
                            <textarea class="form-textarea" data-field="suivi_resultats" placeholder="Qu'avez-vous accompli ?"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ğŸ“ LeÃ§ons apprises</label>
                            <textarea class="form-textarea" data-field="suivi_lecons" placeholder="Qu'avez-vous appris ?"></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ğŸ”„ Ajustements Ã  faire</label>
                            <textarea class="form-textarea" data-field="suivi_ajustements" placeholder="Que modifier pour la suite ?"></textarea>
                        </div>
                    </div>
                </div>
            </section>

            <!-- VEILLE -->
            <section id="veille" class="section">
                <div class="section-header">
                    <h1 class="section-title">ğŸ“¡ Veille citoyenne</h1>
                    <p class="section-subtitle">Suivez l'actualitÃ© de votre cause</p>
                </div>

                <button class="btn btn-primary mb-2" onclick="openModal('veille-modal')">â• Ajouter une source</button>

                <div class="veille-list" id="veille-list">
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“°</div>
                        <p>Aucune source de veille</p>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- MODALS -->
    
    <!-- Export Modal -->
    <div class="modal-overlay" id="export-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ“¤ Exporter le projet</h2>
                <button class="modal-close" onclick="closeModal('export-modal')">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="export-grid">
                    <button class="export-btn" onclick="exportProject('json')">
                        <span class="export-btn-icon">ğŸ“„</span>
                        <span>JSON</span>
                    </button>
                    <button class="export-btn" onclick="exportProject('md')">
                        <span class="export-btn-icon">ğŸ“</span>
                        <span>Markdown</span>
                    </button>
                    <button class="export-btn" onclick="exportProject('html')">
                        <span class="export-btn-icon">ğŸŒ</span>
                        <span>HTML</span>
                    </button>
                    <button class="export-btn" onclick="exportProject('txt')">
                        <span class="export-btn-icon">ğŸ“ƒ</span>
                        <span>Texte</span>
                    </button>
                    <button class="export-btn" onclick="exportProject('csv')">
                        <span class="export-btn-icon">ğŸ“Š</span>
                        <span>CSV</span>
                    </button>
                    <button class="export-btn" onclick="window.print()">
                        <span class="export-btn-icon">ğŸ–¨ï¸</span>
                        <span>Imprimer</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div class="modal-overlay" id="import-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ“¥ Importer un projet</h2>
                <button class="modal-close" onclick="closeModal('import-modal')">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="card-description mb-2">
                    Importez un fichier JSON prÃ©cÃ©demment exportÃ©.
                </div>
                <input type="file" id="import-file" accept=".json" onchange="importProject(event)" style="display:none">
                <button class="btn btn-primary" onclick="document.getElementById('import-file').click()" style="width:100%">
                    ğŸ“ Choisir un fichier JSON
                </button>
                <p class="text-sm text-muted text-center mt-2">
                    âš ï¸ L'import remplacera les donnÃ©es actuelles
                </p>
            </div>
        </div>
    </div>

    <!-- Actor Modal -->
    <div class="modal-overlay" id="actor-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ‘¤ Ajouter un acteur</h2>
                <button class="modal-close" onclick="closeModal('actor-modal')">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Nom de l'acteur</label>
                    <input type="text" class="form-input" id="actor-name" placeholder="Nom ou organisation...">
                </div>
                <div class="form-group">
                    <label class="form-label">Type</label>
                    <select class="form-select" id="actor-type">
                        <option value="ally">ğŸ¤ AlliÃ©</option>
                        <option value="target">ğŸ¯ Cible</option>
                        <option value="neutral">âš–ï¸ Neutre</option>
                        <option value="opponent">ğŸš« Opposant</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Niveau d'influence</label>
                    <select class="form-select" id="actor-influence">
                        <option value="faible">Faible</option>
                        <option value="moyen" selected>Moyen</option>
                        <option value="fort">Fort</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea class="form-textarea" id="actor-notes" placeholder="Informations supplÃ©mentaires..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('actor-modal')">Annuler</button>
                <button class="btn btn-primary" onclick="addActor()">Ajouter</button>
            </div>
        </div>
    </div>

    <!-- Veille Modal -->
    <div class="modal-overlay" id="veille-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">ğŸ“° Ajouter une source</h2>
                <button class="modal-close" onclick="closeModal('veille-modal')">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Titre</label>
                    <input type="text" class="form-input" id="veille-title" placeholder="Titre de l'article ou de la source...">
                </div>
                <div class="form-group">
                    <label class="form-label">URL (optionnel)</label>
                    <input type="url" class="form-input" id="veille-url" placeholder="https://...">
                </div>
                <div class="form-group">
                    <label class="form-label">CatÃ©gorie</label>
                    <select class="form-select" id="veille-category">
                        <option value="politique">ğŸ›ï¸ Politique</option>
                        <option value="social">ğŸ‘¥ Social</option>
                        <option value="economique">ğŸ’° Ã‰conomique</option>
                        <option value="environnement">ğŸŒ Environnement</option>
                        <option value="juridique">âš–ï¸ Juridique</option>
                        <option value="autre">ğŸ“Œ Autre</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea class="form-textarea" id="veille-notes" placeholder="RÃ©sumÃ© ou points clÃ©s..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('veille-modal')">Annuler</button>
                <button class="btn btn-primary" onclick="addVeille()">Ajouter</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATA STRUCTURE - CORRECTEMENT INITIALISÃ‰E
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let data = {
    meta: {
        version: '3.0',
        created: new Date().toISOString(),
        updated: new Date().toISOString()
    },
    fields: {},
    actors: [],
    veille: [],
    checklist: {},
    tree: {
        causes: [],
        effects: []
    }
};

const CHECKLIST_ITEMS = [
    "DÃ©finir l'objectif de la rencontre",
    "Identifier les participants",
    "PrÃ©parer les arguments clÃ©s",
    "Anticiper les contre-arguments",
    "PrÃ©parer les documents Ã  remettre",
    "DÃ©finir la demande concrÃ¨te",
    "PrÃ©voir les questions Ã  poser",
    "Ã‰tablir le plan de suivi",
    "RÃ©pÃ©ter la prÃ©sentation",
    "VÃ©rifier la logistique"
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INITIALIZATION
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.addEventListener('DOMContentLoaded', () => {
    loadProject();
    initNavigation();
    initFields();
    initChecklist();
    renderActors();
    renderVeille();
    renderTree();
    updateDashboard();
    updateMessagePreview();
});

function initNavigation() {
    document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.addEventListener('click', () => {
            const section = tab.dataset.section;
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            tab.classList.add('active');
            document.getElementById(section)?.classList.add('active');
        });
    });
}

function initFields() {
    document.querySelectorAll('[data-field]').forEach(el => {
        el.addEventListener('input', debounce(() => {
            data.fields[el.dataset.field] = el.value;
            saveProject(false);
            updateDashboard();
        }, 500));
    });
}

function initChecklist() {
    const container = document.getElementById('checklist');
    if (!container) return;
    
    container.innerHTML = CHECKLIST_ITEMS.map((text, i) => `
        <div class="checklist-item ${data.checklist['c' + i] ? 'completed' : ''}" onclick="toggleChecklist(${i})">
            <div class="checkbox">${data.checklist['c' + i] ? 'âœ“' : ''}</div>
            <span class="checklist-text">${text}</span>
        </div>
    `).join('');
}

function toggleChecklist(index) {
    const key = 'c' + index;
    data.checklist[key] = !data.checklist[key];
    saveProject(false);
    initChecklist();
    updateDashboard();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARDS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function toggleCard(card) {
    card.classList.toggle('open');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TREE (ARBRE Ã€ PROBLÃˆME) - STRUCTURE CORRECTE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateTreeProblem() {
    const input = document.getElementById('tree-problem-input');
    const display = document.getElementById('tree-problem-display');
    if (input && display) {
        display.textContent = input.value || 'â†’ DÃ©finissez le problÃ¨me ci-dessus â†';
    }
}

function addTreeItem(type) {
    const inputId = type === 'cause' ? 'cause-input' : 'effect-input';
    const input = document.getElementById(inputId);
    if (!input || !input.value.trim()) return;
    
    // S'assurer que tree existe
    if (!data.tree) {
        data.tree = { causes: [], effects: [] };
    }
    if (!data.tree.causes) data.tree.causes = [];
    if (!data.tree.effects) data.tree.effects = [];
    
    const item = {
        id: Date.now().toString(),
        text: input.value.trim()
    };
    
    if (type === 'cause') {
        data.tree.causes.push(item);
    } else {
        data.tree.effects.push(item);
    }
    
    input.value = '';
    saveProject(false);
    renderTree();
}

function removeTreeItem(type, id) {
    if (!data.tree) return;
    
    if (type === 'cause' && data.tree.causes) {
        data.tree.causes = data.tree.causes.filter(c => c.id !== id);
    } else if (type === 'effect' && data.tree.effects) {
        data.tree.effects = data.tree.effects.filter(e => e.id !== id);
    }
    
    saveProject(false);
    renderTree();
}

function renderTree() {
    const causesContainer = document.getElementById('tree-causes-list');
    const effectsContainer = document.getElementById('tree-effects-list');
    
    // S'assurer que tree existe
    if (!data.tree) {
        data.tree = { causes: [], effects: [] };
    }
    
    const causes = data.tree.causes || [];
    const effects = data.tree.effects || [];
    
    if (causesContainer) {
        if (causes.length === 0) {
            causesContainer.innerHTML = '<p class="text-muted text-sm">Aucune cause ajoutÃ©e</p>';
        } else {
            causesContainer.innerHTML = causes.map(c => `
                <div class="tree-item cause">
                    <span class="tree-item-text">${escapeHtml(c.text)}</span>
                    <button class="tree-item-delete" onclick="removeTreeItem('cause', '${c.id}')">Ã—</button>
                </div>
            `).join('');
        }
    }
    
    if (effectsContainer) {
        if (effects.length === 0) {
            effectsContainer.innerHTML = '<p class="text-muted text-sm">Aucun effet ajoutÃ©</p>';
        } else {
            effectsContainer.innerHTML = effects.map(e => `
                <div class="tree-item effect">
                    <span class="tree-item-text">${escapeHtml(e.text)}</span>
                    <button class="tree-item-delete" onclick="removeTreeItem('effect', '${e.id}')">Ã—</button>
                </div>
            `).join('');
        }
    }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACTORS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function addActor() {
    const name = document.getElementById('actor-name').value.trim();
    if (!name) {
        showToast('Veuillez entrer un nom', 'error');
        return;
    }
    
    const actor = {
        id: Date.now().toString(),
        name: name,
        type: document.getElementById('actor-type').value,
        influence: document.getElementById('actor-influence').value,
        notes: document.getElementById('actor-notes').value.trim()
    };
    
    data.actors.push(actor);
    saveProject(false);
    renderActors();
    closeModal('actor-modal');
    
    // Reset form
    document.getElementById('actor-name').value = '';
    document.getElementById('actor-notes').value = '';
    
    showToast('Acteur ajoutÃ©');
    updateDashboard();
}

function removeActor(id) {
    data.actors = data.actors.filter(a => a.id !== id);
    saveProject(false);
    renderActors();
    updateDashboard();
    showToast('Acteur supprimÃ©');
}

function renderActors() {
    const container = document.getElementById('actors-list');
    if (!container) return;
    
    if (data.actors.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <div class="empty-state-icon">ğŸ‘¥</div>
                <p>Aucun acteur ajoutÃ©</p>
            </div>
        `;
        return;
    }
    
    const typeIcons = {
        ally: 'ğŸ¤',
        target: 'ğŸ¯',
        neutral: 'âš–ï¸',
        opponent: 'ğŸš«'
    };
    
    const typeLabels = {
        ally: 'AlliÃ©',
        target: 'Cible',
        neutral: 'Neutre',
        opponent: 'Opposant'
    };
    
    container.innerHTML = data.actors.map(a => `
        <div class="actor-card">
            <div class="actor-avatar ${a.type}">${typeIcons[a.type] || 'ğŸ‘¤'}</div>
            <div class="actor-info">
                <div class="actor-name">${escapeHtml(a.name)}</div>
                <div class="actor-meta">${typeLabels[a.type] || a.type} â€¢ ${a.influence}</div>
            </div>
            <div class="actor-actions">
                <button class="btn btn-ghost btn-sm" onclick="removeActor('${a.id}')">ğŸ—‘ï¸</button>
            </div>
        </div>
    `).join('');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VEILLE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function addVeille() {
    const title = document.getElementById('veille-title').value.trim();
    if (!title) {
        showToast('Veuillez entrer un titre', 'error');
        return;
    }
    
    const item = {
        id: Date.now().toString(),
        title: title,
        url: document.getElementById('veille-url').value.trim(),
        category: document.getElementById('veille-category').value,
        notes: document.getElementById('veille-notes').value.trim(),
        date: new Date().toISOString()
    };
    
    data.veille.push(item);
    saveProject(false);
    renderVeille();
    closeModal('veille-modal');
    
    // Reset form
    document.getElementById('veille-title').value = '';
    document.getElementById('veille-url').value = '';
    document.getElementById('veille-notes').value = '';
    
    showToast('Source ajoutÃ©e');
    updateDashboard();
}

function removeVeille(id) {
    data.veille = data.veille.filter(v => v.id !== id);
    saveProject(false);
    renderVeille();
    updateDashboard();
    showToast('Source supprimÃ©e');
}

function renderVeille() {
    const container = document.getElementById('veille-list');
    if (!container) return;
    
    if (data.veille.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <div class="empty-state-icon">ğŸ“°</div>
                <p>Aucune source de veille</p>
            </div>
        `;
        return;
    }
    
    const categoryLabels = {
        politique: 'ğŸ›ï¸ Politique',
        social: 'ğŸ‘¥ Social',
        economique: 'ğŸ’° Ã‰conomique',
        environnement: 'ğŸŒ Environnement',
        juridique: 'âš–ï¸ Juridique',
        autre: 'ğŸ“Œ Autre'
    };
    
    container.innerHTML = data.veille.map(v => `
        <div class="veille-item">
            <div class="veille-item-header">
                <div class="veille-item-title">${escapeHtml(v.title)}</div>
                <span class="veille-item-category">${categoryLabels[v.category] || v.category}</span>
            </div>
            ${v.url ? `<a href="${escapeHtml(v.url)}" target="_blank" class="veille-item-url">${escapeHtml(v.url)}</a>` : ''}
            ${v.notes ? `<p class="text-sm mt-1">${escapeHtml(v.notes)}</p>` : ''}
            <div class="veille-item-date">
                ${new Date(v.date).toLocaleDateString('fr-FR')}
                <button class="btn btn-ghost btn-sm" onclick="removeVeille('${v.id}')" style="float:right">ğŸ—‘ï¸</button>
            </div>
        </div>
    `).join('');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MESSAGE PREVIEW
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateMessagePreview() {
    const preview = document.getElementById('message-preview');
    if (!preview) return;
    
    const accroche = data.fields.msg_accroche || '';
    const probleme = data.fields.msg_probleme || '';
    const solution = data.fields.msg_solution || '';
    const action = data.fields.msg_action || '';
    
    if (!accroche && !probleme && !solution && !action) {
        preview.innerHTML = 'Remplissez les champs ci-dessus pour voir l\'aperÃ§u...';
        return;
    }
    
    preview.innerHTML = `
        ${accroche ? `<strong>${escapeHtml(accroche)}</strong><br><br>` : ''}
        ${probleme ? `${escapeHtml(probleme)}<br><br>` : ''}
        ${solution ? `${escapeHtml(solution)}<br><br>` : ''}
        ${action ? `<em>â†’ ${escapeHtml(action)}</em>` : ''}
    `;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DASHBOARD
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateDashboard() {
    // Compter les champs remplis
    const filledFields = Object.values(data.fields).filter(v => v && v.toString().trim()).length;
    
    // Stats
    const statProgress = document.getElementById('stat-progress');
    const statFields = document.getElementById('stat-fields');
    const statActors = document.getElementById('stat-actors');
    const statVeille = document.getElementById('stat-veille');
    
    const totalFields = 35; // Nombre approximatif de champs
    const progress = Math.min(100, Math.round((filledFields / totalFields) * 100));
    
    if (statProgress) statProgress.textContent = progress + '%';
    if (statFields) statFields.textContent = filledFields;
    if (statActors) statActors.textContent = data.actors.length;
    if (statVeille) statVeille.textContent = data.veille.length;
    
    // Barre de progression globale
    const progressBar = document.getElementById('global-progress-bar');
    if (progressBar) progressBar.style.width = progress + '%';
    
    // Progress par phase
    const voirFields = ['domino_pourquoi', 'domino_valeurs', 'domino_changements', 'domino_actions', 'fleur_genre', 'fleur_classe'];
    const jugerFields = ['toc_vision', 'toc_hypotheses', 'swot_forces', 'swot_faiblesses', 'arbre_probleme', 'pourquoi_1'];
    const agirFields = ['smart_s', 'smart_m', 'cible_principale', 'msg_accroche', 'msg_probleme'];
    
    const calcPhaseProgress = (fields) => {
        const filled = fields.filter(f => data.fields[f] && data.fields[f].trim()).length;
        return Math.round((filled / fields.length) * 100);
    };
    
    const progVoir = document.getElementById('prog-voir');
    const progJuger = document.getElementById('prog-juger');
    const progAgir = document.getElementById('prog-agir');
    
    if (progVoir) progVoir.textContent = calcPhaseProgress(voirFields) + '%';
    if (progJuger) progJuger.textContent = calcPhaseProgress(jugerFields) + '%';
    if (progAgir) progAgir.textContent = calcPhaseProgress(agirFields) + '%';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SAVE / LOAD
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function saveProject(notify = true) {
    data.meta.updated = new Date().toISOString();
    localStorage.setItem('plaidoyer_v3', JSON.stringify(data));
    if (notify) showToast('Projet sauvegardÃ©');
}

function loadProject() {
    const saved = localStorage.getItem('plaidoyer_v3');
    if (saved) {
        try {
            const loaded = JSON.parse(saved);
            
            // Merge avec les valeurs par dÃ©faut pour s'assurer que tout existe
            data = {
                meta: loaded.meta || data.meta,
                fields: loaded.fields || {},
                actors: loaded.actors || [],
                veille: loaded.veille || [],
                checklist: loaded.checklist || {},
                tree: {
                    causes: (loaded.tree && loaded.tree.causes) || [],
                    effects: (loaded.tree && loaded.tree.effects) || []
                }
            };
            
            // Restaurer les valeurs des champs
            Object.entries(data.fields).forEach(([key, value]) => {
                const el = document.querySelector(`[data-field="${key}"]`);
                if (el) el.value = value;
            });
            
            // Mettre Ã  jour l'affichage du problÃ¨me central
            updateTreeProblem();
            
        } catch (e) {
            console.error('Erreur de chargement:', e);
        }
    }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EXPORT / IMPORT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function exportProject(format) {
    const filename = `plaidoyer_${new Date().toISOString().slice(0, 10)}`;
    let content, type, ext;
    
    switch (format) {
        case 'json':
            content = JSON.stringify(data, null, 2);
            type = 'application/json';
            ext = 'json';
            break;
            
        case 'md':
            content = generateMarkdown();
            type = 'text/markdown';
            ext = 'md';
            break;
            
        case 'html':
            content = generateHTML();
            type = 'text/html';
            ext = 'html';
            break;
            
        case 'txt':
            content = generateText();
            type = 'text/plain';
            ext = 'txt';
            break;
            
        case 'csv':
            content = generateCSV();
            type = 'text/csv';
            ext = 'csv';
            break;
            
        default:
            return;
    }
    
    downloadFile(content, `${filename}.${ext}`, type);
    closeModal('export-modal');
    showToast(`Export ${format.toUpperCase()} rÃ©ussi`);
}

function generateMarkdown() {
    let md = `# Projet de Plaidoyer Citoyen\n\n`;
    md += `*ExportÃ© le ${new Date().toLocaleDateString('fr-FR')}*\n\n`;
    md += `---\n\n`;
    
    // Phase VOIR
    md += `## ğŸ‘ï¸ Phase VOIR\n\n`;
    if (data.fields.domino_pourquoi) md += `### Pourquoi agir ?\n${data.fields.domino_pourquoi}\n\n`;
    if (data.fields.domino_valeurs) md += `### Valeurs\n${data.fields.domino_valeurs}\n\n`;
    if (data.fields.domino_changements) md += `### Changements souhaitÃ©s\n${data.fields.domino_changements}\n\n`;
    
    // Phase JUGER
    md += `## âš–ï¸ Phase JUGER\n\n`;
    if (data.fields.toc_vision) md += `### Vision\n${data.fields.toc_vision}\n\n`;
    if (data.fields.swot_forces) md += `### Forces\n${data.fields.swot_forces}\n\n`;
    if (data.fields.arbre_probleme) md += `### ProblÃ¨me central\n${data.fields.arbre_probleme}\n\n`;
    
    // Phase AGIR
    md += `## ğŸ¯ Phase AGIR\n\n`;
    if (data.fields.smart_s) md += `### Objectif SMART\n- SpÃ©cifique: ${data.fields.smart_s}\n`;
    if (data.fields.msg_accroche) md += `### Message\n${data.fields.msg_accroche}\n\n`;
    
    // Acteurs
    if (data.actors.length > 0) {
        md += `## ğŸ‘¥ Acteurs\n\n`;
        data.actors.forEach(a => {
            md += `- **${a.name}** (${a.type}) - Influence: ${a.influence}\n`;
        });
    }
    
    return md;
}

function generateHTML() {
    return `<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Projet de Plaidoyer</title>
    <style>
        body { font-family: system-ui; max-width: 800px; margin: 0 auto; padding: 2rem; background: #1a1a2e; color: #eee; }
        h1 { color: #7fefaf; } h2 { color: #c9b8ff; border-bottom: 1px solid #333; padding-bottom: 0.5rem; }
        .section { margin-bottom: 2rem; padding: 1rem; background: #12121a; border-radius: 8px; }
    </style>
</head>
<body>
    <h1>Projet de Plaidoyer Citoyen</h1>
    <p><em>ExportÃ© le ${new Date().toLocaleDateString('fr-FR')}</em></p>
    ${Object.entries(data.fields).filter(([k, v]) => v && v.trim()).map(([k, v]) => `
        <div class="section">
            <h2>${k.replace(/_/g, ' ')}</h2>
            <p>${v}</p>
        </div>
    `).join('')}
</body>
</html>`;
}

function generateText() {
    let txt = `PROJET DE PLAIDOYER CITOYEN\n`;
    txt += `ExportÃ© le ${new Date().toLocaleDateString('fr-FR')}\n`;
    txt += `${'='.repeat(50)}\n\n`;
    
    Object.entries(data.fields).forEach(([key, value]) => {
        if (value && value.trim()) {
            txt += `${key.replace(/_/g, ' ').toUpperCase()}\n`;
            txt += `${value}\n\n`;
        }
    });
    
    return txt;
}

function generateCSV() {
    let csv = 'Champ,Valeur\n';
    Object.entries(data.fields).forEach(([key, value]) => {
        if (value) {
            csv += `"${key}","${value.replace(/"/g, '""')}"\n`;
        }
    });
    return csv;
}

function downloadFile(content, filename, type) {
    const blob = new Blob([content], { type: type + ';charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

function importProject(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = (e) => {
        try {
            const imported = JSON.parse(e.target.result);
            localStorage.setItem('plaidoyer_v3', JSON.stringify(imported));
            location.reload();
        } catch (err) {
            showToast('Erreur: fichier invalide', 'error');
        }
    };
    reader.readAsText(file);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODALS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openModal(id) {
    document.getElementById(id)?.classList.add('active');
}

function closeModal(id) {
    document.getElementById(id)?.classList.remove('active');
}

// Fermer modal en cliquant Ã  l'extÃ©rieur
document.querySelectorAll('.modal-overlay').forEach(overlay => {
    overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
            overlay.classList.remove('active');
        }
    });
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILITIES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showToast(message, type = 'success') {
    const container = document.getElementById('toast-container');
    const toast = document.createElement('div');
    toast.className = `toast ${type}`;
    toast.innerHTML = `<span>${type === 'success' ? 'âœ…' : 'âŒ'}</span><span>${message}</span>`;
    container.appendChild(toast);
    
    setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateX(100%)';
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}

function debounce(fn, ms) {
    let timeout;
    return (...args) => {
        clearTimeout(timeout);
        timeout = setTimeout(() => fn(...args), ms);
    };
}

function escapeHtml(text) {
    if (!text) return '';
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   KEYBOARD SHORTCUTS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
document.addEventListener('keydown', (e) => {
    if (e.ctrlKey || e.metaKey) {
        switch (e.key.toLowerCase()) {
            case 's':
                e.preventDefault();
                saveProject();
                break;
            case 'e':
                e.preventDefault();
                openModal('export-modal');
                break;
            case 'i':
                e.preventDefault();
                openModal('import-modal');
                break;
        }
    }
    if (e.key === 'Escape') {
        document.querySelectorAll('.modal-overlay.active').forEach(m => m.classList.remove('active'));
    }
});

// Auto-save toutes les 30 secondes
setInterval(() => saveProject(false), 30000);

console.log('ğŸ—³ï¸ Plaidoyer Citoyen v3.0 initialisÃ©');
    </script>
</body>
</html>
