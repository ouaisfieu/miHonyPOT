<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plaidoyer Citoyen 2.0 ‚Äî Intelligence Civile & Veille Citoyenne</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Quicksand:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #0a0a0f;
            --bg-card: #12121a;
            --bg-card-hover: #1a1a25;
            --bg-input: #0d0d14;
            --green-soft: #7fff7f;
            --green-medium: #5fe65f;
            --green-dark: #3da83d;
            --green-glow: rgba(127, 255, 127, 0.4);
            --green-subtle: rgba(127, 255, 127, 0.1);
            --lilac-soft: #c8b6ff;
            --lilac-medium: #a78bfa;
            --lilac-dark: #8b5cf6;
            --lilac-glow: rgba(200, 182, 255, 0.4);
            --lilac-subtle: rgba(200, 182, 255, 0.1);
            --cyan: #60d8c4;
            --cyan-glow: rgba(96, 216, 196, 0.4);
            --orange: #ffb347;
            --orange-glow: rgba(255, 179, 71, 0.4);
            --pink: #ff7eb3;
            --pink-glow: rgba(255, 126, 179, 0.4);
            --text-primary: #f0f0f5;
            --text-secondary: #a0a0b0;
            --text-muted: #606070;
            --border-color: rgba(127, 255, 127, 0.2);
            --border-lilac: rgba(200, 182, 255, 0.2);
            --shadow-neon-green: 0 0 20px rgba(127, 255, 127, 0.3), 0 0 40px rgba(127, 255, 127, 0.1);
            --shadow-neon-lilac: 0 0 20px rgba(200, 182, 255, 0.3), 0 0 40px rgba(200, 182, 255, 0.1);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --transition-fast: 0.15s ease;
            --transition-med: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        
        body {
            font-family: 'Quicksand', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Background */
        .bg-effects {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .bg-gradient {
            position: absolute;
            width: 600px;
            height: 600px;
            border-radius: 50%;
            filter: blur(120px);
            opacity: 0.12;
            animation: float 25s ease-in-out infinite;
        }

        .bg-gradient-1 { background: var(--green-soft); top: -200px; left: -200px; }
        .bg-gradient-2 { background: var(--lilac-soft); bottom: -200px; right: -200px; animation-delay: -12s; }
        .bg-gradient-3 { background: var(--cyan); top: 50%; left: 50%; transform: translate(-50%, -50%); width: 400px; height: 400px; opacity: 0.06; animation-delay: -6s; }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(30px, -30px) scale(1.05); }
            66% { transform: translate(-20px, 20px) scale(0.95); }
        }

        .grid-overlay {
            position: absolute;
            inset: 0;
            background-image: 
                linear-gradient(var(--border-color) 1px, transparent 1px),
                linear-gradient(90deg, var(--border-color) 1px, transparent 1px);
            background-size: 50px 50px;
            opacity: 0.25;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(10, 10, 15, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            padding: 0.6rem 1rem;
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--green-soft), var(--lilac-soft));
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            box-shadow: var(--shadow-neon-green);
            animation: pulse-glow 4s ease-in-out infinite;
        }

        @keyframes pulse-glow {
            0%, 100% { box-shadow: var(--shadow-neon-green); }
            50% { box-shadow: var(--shadow-neon-lilac); }
        }

        .logo-text {
            font-family: 'Orbitron', monospace;
            font-weight: 700;
            font-size: 0.9rem;
            background: linear-gradient(135deg, var(--green-soft), var(--lilac-soft));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo-version {
            font-size: 0.6rem;
            background: var(--lilac-subtle);
            color: var(--lilac-soft);
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 0.5rem;
        }

        .header-actions {
            display: flex;
            gap: 0.4rem;
        }

        .btn {
            font-family: 'Quicksand', sans-serif;
            font-weight: 600;
            padding: 0.5rem 0.9rem;
            border-radius: var(--radius-sm);
            border: none;
            cursor: pointer;
            transition: all var(--transition-med);
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.8rem;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: translateX(-100%);
            transition: transform var(--transition-med);
        }

        .btn:hover::before { transform: translateX(100%); }

        .btn-primary {
            background: linear-gradient(135deg, var(--green-soft), var(--green-medium));
            color: var(--bg-dark);
        }

        .btn-primary:hover {
            box-shadow: var(--shadow-neon-green);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--lilac-soft);
            border: 1px solid var(--border-lilac);
        }

        .btn-secondary:hover {
            background: var(--bg-card-hover);
            box-shadow: var(--shadow-neon-lilac);
        }

        .btn-ghost {
            background: transparent;
            color: var(--text-secondary);
            padding: 0.5rem;
        }

        .btn-ghost:hover {
            color: var(--green-soft);
            background: var(--green-subtle);
        }

        /* Main */
        .main-container {
            position: relative;
            z-index: 1;
            padding-top: 60px;
            min-height: 100vh;
        }

        /* Navigation */
        .nav-tabs {
            position: sticky;
            top: 60px;
            z-index: 100;
            background: rgba(10, 10, 15, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }

        .nav-tabs::-webkit-scrollbar { display: none; }

        .nav-tabs-inner {
            display: flex;
            gap: 0;
            padding: 0 0.5rem;
            min-width: max-content;
        }

        .nav-tab {
            font-family: 'Quicksand', sans-serif;
            font-weight: 600;
            padding: 0.8rem 1rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all var(--transition-fast);
            position: relative;
            white-space: nowrap;
            font-size: 0.8rem;
        }

        .nav-tab::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--green-soft), var(--lilac-soft));
            border-radius: 3px 3px 0 0;
            transition: all var(--transition-med);
            transform: translateX(-50%);
        }

        .nav-tab:hover { color: var(--text-primary); }
        .nav-tab:hover::after { width: 20px; }
        .nav-tab.active { color: var(--green-soft); }
        .nav-tab.active::after { width: 100%; box-shadow: 0 0 10px var(--green-glow); }

        .nav-tab.highlight {
            color: var(--cyan);
        }

        .nav-tab.highlight.active {
            color: var(--cyan);
        }

        .nav-tab.highlight.active::after {
            background: linear-gradient(90deg, var(--cyan), var(--lilac-soft));
        }

        /* Sections */
        .section {
            display: none;
            padding: 1.5rem 1rem;
            max-width: 1400px;
            margin: 0 auto;
            animation: fadeIn 0.4s ease;
        }

        .section.active { display: block; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-header {
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .section-title {
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--green-soft), var(--lilac-soft));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .section-subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1.25rem;
            margin-bottom: 1.25rem;
            transition: all var(--transition-med);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--green-soft), var(--lilac-soft));
            opacity: 0;
            transition: opacity var(--transition-med);
        }

        .card:hover {
            border-color: var(--green-soft);
            transform: translateY(-3px);
            box-shadow: var(--shadow-neon-green);
        }

        .card:hover::before { opacity: 1; }

        .card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
        }

        .card-number {
            font-family: 'Orbitron', monospace;
            font-size: 0.7rem;
            font-weight: 700;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--green-soft), var(--lilac-soft));
            color: var(--bg-dark);
            border-radius: var(--radius-sm);
            flex-shrink: 0;
        }

        .card-title {
            font-family: 'Orbitron', monospace;
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--text-primary);
            flex: 1;
        }

        .card-toggle {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            transition: transform var(--transition-med);
            font-size: 0.7rem;
        }

        .card.expanded .card-toggle { transform: rotate(180deg); }

        .card-content {
            display: none;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border-color);
        }

        .card.expanded .card-content {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card-description {
            color: var(--text-secondary);
            margin-bottom: 1rem;
            font-size: 0.85rem;
        }

        /* Forms */
        .form-group { margin-bottom: 1rem; }

        .form-label {
            display: block;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.4rem;
            font-size: 0.85rem;
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 0.75rem;
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            color: var(--text-primary);
            font-family: 'Quicksand', sans-serif;
            font-size: 0.9rem;
            transition: all var(--transition-fast);
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--green-soft);
            box-shadow: 0 0 0 3px var(--green-subtle);
        }

        .form-textarea { min-height: 100px; resize: vertical; }

        /* Grids */
        .grid-2 { display: grid; grid-template-columns: 1fr; gap: 1rem; }
        .grid-3 { display: grid; grid-template-columns: 1fr; gap: 1rem; }
        .grid-4 { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; }

        @media (min-width: 640px) {
            .grid-2 { grid-template-columns: 1fr 1fr; }
            .grid-4 { grid-template-columns: repeat(4, 1fr); }
        }

        @media (min-width: 768px) {
            .grid-3 { grid-template-columns: repeat(3, 1fr); }
        }

        /* SWOT Grid */
        .swot-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
        }

        @media (min-width: 640px) {
            .swot-grid { grid-template-columns: 1fr 1fr; }
        }

        .swot-cell {
            background: var(--bg-input);
            border-radius: var(--radius-md);
            padding: 1rem;
            border: 1px solid var(--border-color);
        }

        .swot-cell.strengths { border-color: var(--green-soft); }
        .swot-cell.weaknesses { border-color: var(--lilac-soft); }
        .swot-cell.opportunities { border-color: var(--cyan); }
        .swot-cell.threats { border-color: #ff7f7f; }

        .swot-label {
            font-family: 'Orbitron', monospace;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
        }

        .swot-cell.strengths .swot-label { color: var(--green-soft); }
        .swot-cell.weaknesses .swot-label { color: var(--lilac-soft); }
        .swot-cell.opportunities .swot-label { color: var(--cyan); }
        .swot-cell.threats .swot-label { color: #ff7f7f; }

        /* Power Map Canvas */
        .power-map-container {
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 1rem;
            margin: 1rem 0;
        }

        .power-map {
            position: relative;
            width: 100%;
            aspect-ratio: 1.5;
            max-height: 400px;
            background: linear-gradient(135deg, rgba(127,255,127,0.03), rgba(200,182,255,0.03));
            border-radius: var(--radius-sm);
            overflow: hidden;
        }

        .power-map-axis {
            position: absolute;
            background: var(--border-color);
        }

        .power-map-axis.horizontal {
            left: 10%;
            right: 10%;
            top: 50%;
            height: 1px;
        }

        .power-map-axis.vertical {
            top: 10%;
            bottom: 10%;
            left: 50%;
            width: 1px;
        }

        .power-map-label {
            position: absolute;
            font-size: 0.65rem;
            color: var(--text-muted);
            font-weight: 600;
        }

        .power-map-label.top { top: 2%; left: 50%; transform: translateX(-50%); }
        .power-map-label.bottom { bottom: 2%; left: 50%; transform: translateX(-50%); }
        .power-map-label.left { left: 2%; top: 50%; transform: translateY(-50%); writing-mode: vertical-rl; text-orientation: mixed; transform: translateY(-50%) rotate(180deg); }
        .power-map-label.right { right: 2%; top: 50%; transform: translateY(-50%); writing-mode: vertical-rl; }

        .power-map-quadrant {
            position: absolute;
            font-size: 0.6rem;
            color: var(--text-muted);
            opacity: 0.6;
        }

        .power-map-quadrant.q1 { top: 15%; right: 15%; color: var(--green-soft); }
        .power-map-quadrant.q2 { top: 15%; left: 15%; color: var(--orange); }
        .power-map-quadrant.q3 { bottom: 15%; left: 15%; color: var(--text-muted); }
        .power-map-quadrant.q4 { bottom: 15%; right: 15%; color: var(--lilac-soft); }

        .power-actor {
            position: absolute;
            min-width: 60px;
            padding: 4px 8px;
            background: var(--bg-card);
            border: 2px solid var(--green-soft);
            border-radius: 20px;
            font-size: 0.65rem;
            font-weight: 600;
            color: var(--text-primary);
            cursor: move;
            transform: translate(-50%, -50%);
            transition: box-shadow var(--transition-fast);
            text-align: center;
            white-space: nowrap;
            z-index: 10;
        }

        .power-actor:hover {
            box-shadow: var(--shadow-neon-green);
        }

        .power-actor.ally { border-color: var(--green-soft); }
        .power-actor.neutral { border-color: var(--orange); }
        .power-actor.opponent { border-color: #ff7f7f; }

        /* Intelligence Civile Cycle */
        .ic-cycle {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .ic-step {
            flex: 1;
            min-width: 140px;
            max-width: 200px;
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 1rem;
            text-align: center;
            transition: all var(--transition-med);
        }

        .ic-step:hover {
            border-color: var(--cyan);
            box-shadow: 0 0 20px var(--cyan-glow);
            transform: translateY(-5px);
        }

        .ic-step-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .ic-step-title {
            font-family: 'Orbitron', monospace;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--cyan);
            margin-bottom: 0.25rem;
        }

        .ic-step-desc {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .ic-arrow {
            display: flex;
            align-items: center;
            color: var(--cyan);
            font-size: 1.2rem;
        }

        /* Veille Dashboard */
        .veille-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        @media (min-width: 768px) {
            .veille-grid { grid-template-columns: 2fr 1fr; }
        }

        .veille-feed {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1rem;
            max-height: 400px;
            overflow-y: auto;
        }

        .veille-item {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-color);
            transition: background var(--transition-fast);
        }

        .veille-item:last-child { border-bottom: none; }
        .veille-item:hover { background: var(--bg-input); }

        .veille-item-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.25rem;
        }

        .veille-item-title {
            font-weight: 600;
            font-size: 0.85rem;
            color: var(--text-primary);
        }

        .veille-item-date {
            font-size: 0.65rem;
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
        }

        .veille-item-content {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .veille-item-tags {
            margin-top: 0.5rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
        }

        .veille-tag {
            font-size: 0.6rem;
            padding: 2px 6px;
            background: var(--green-subtle);
            color: var(--green-soft);
            border-radius: 10px;
        }

        /* Progress */
        .progress-container { margin-bottom: 1rem; }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.4rem;
        }

        .progress-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .progress-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: var(--green-soft);
        }

        .progress-bar {
            height: 6px;
            background: var(--bg-input);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--green-soft), var(--lilac-soft));
            border-radius: 3px;
            transition: width var(--transition-med);
        }

        /* Tags */
        .tag {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.3rem 0.6rem;
            background: var(--green-subtle);
            color: var(--green-soft);
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 600;
            margin: 0.2rem;
            transition: all var(--transition-fast);
            cursor: pointer;
        }

        .tag:hover {
            background: var(--green-soft);
            color: var(--bg-dark);
        }

        .tag.lilac { background: var(--lilac-subtle); color: var(--lilac-soft); }
        .tag.lilac:hover { background: var(--lilac-soft); color: var(--bg-dark); }
        .tag.cyan { background: rgba(96,216,196,0.15); color: var(--cyan); }
        .tag.cyan:hover { background: var(--cyan); color: var(--bg-dark); }

        /* Checklist */
        .checklist-item {
            display: flex;
            align-items: flex-start;
            gap: 0.6rem;
            padding: 0.6rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .checklist-item:last-child { border-bottom: none; }

        .checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-fast);
            flex-shrink: 0;
            margin-top: 2px;
        }

        .checkbox:hover { border-color: var(--green-soft); }

        .checkbox.checked {
            background: linear-gradient(135deg, var(--green-soft), var(--green-medium));
            border-color: var(--green-soft);
        }

        .checkbox.checked::after {
            content: '‚úì';
            color: var(--bg-dark);
            font-weight: 700;
            font-size: 0.75rem;
        }

        .checklist-text {
            flex: 1;
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .checklist-item.completed .checklist-text {
            color: var(--text-muted);
            text-decoration: line-through;
        }

        /* Quick Stats */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        @media (min-width: 640px) {
            .quick-stats { grid-template-columns: repeat(4, 1fr); }
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 1rem;
            text-align: center;
            transition: all var(--transition-med);
        }

        .stat-card:hover {
            border-color: var(--green-soft);
            box-shadow: var(--shadow-neon-green);
        }

        .stat-value {
            font-family: 'Orbitron', monospace;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--green-soft);
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        /* Export Options */
        .export-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }

        @media (min-width: 640px) {
            .export-options { grid-template-columns: repeat(4, 1fr); }
        }

        .export-option {
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all var(--transition-med);
        }

        .export-option:hover {
            border-color: var(--green-soft);
            box-shadow: var(--shadow-neon-green);
            transform: translateY(-3px);
        }

        .export-icon { font-size: 1.5rem; margin-bottom: 0.5rem; }
        .export-name { font-weight: 600; font-size: 0.85rem; color: var(--text-primary); }
        .export-desc { font-size: 0.65rem; color: var(--text-muted); }

        /* Phase Cards */
        .phase-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        @media (min-width: 768px) {
            .phase-grid { grid-template-columns: repeat(3, 1fr); }
        }

        .phase-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1.25rem;
            text-align: center;
            transition: all var(--transition-med);
            cursor: pointer;
        }

        .phase-card:hover { transform: translateY(-5px); }

        .phase-card.voir { border-color: var(--green-soft); }
        .phase-card.voir:hover { box-shadow: var(--shadow-neon-green); }
        .phase-card.juger { border-color: var(--lilac-soft); }
        .phase-card.juger:hover { box-shadow: var(--shadow-neon-lilac); }
        .phase-card.agir { border-color: var(--cyan); }
        .phase-card.agir:hover { box-shadow: 0 0 20px var(--cyan-glow); }

        .phase-icon { font-size: 2.5rem; margin-bottom: 0.75rem; }

        .phase-name {
            font-family: 'Orbitron', monospace;
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 0.4rem;
        }

        .phase-card.voir .phase-name { color: var(--green-soft); }
        .phase-card.juger .phase-name { color: var(--lilac-soft); }
        .phase-card.agir .phase-name { color: var(--cyan); }

        .phase-desc {
            color: var(--text-secondary);
            font-size: 0.8rem;
            margin-bottom: 0.75rem;
        }

        .phase-tools {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        /* Feature Badge */
        .feature-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
            padding: 0.2rem 0.5rem;
            background: linear-gradient(135deg, var(--cyan), var(--lilac-soft));
            color: var(--bg-dark);
            font-size: 0.6rem;
            font-weight: 700;
            border-radius: 10px;
            margin-left: 0.5rem;
        }

        /* Toast */
        .toast-container {
            position: fixed;
            bottom: 1rem;
            right: 1rem;
            z-index: 3000;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .toast {
            background: var(--bg-card);
            border: 1px solid var(--green-soft);
            border-radius: var(--radius-sm);
            padding: 0.75rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: var(--shadow-neon-green);
            animation: slideInRight 0.3s ease;
            min-width: 250px;
            font-size: 0.85rem;
        }

        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(100px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* FAB */
        .fab {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--green-soft), var(--lilac-soft));
            border: none;
            border-radius: 50%;
            color: var(--bg-dark);
            font-size: 1.25rem;
            cursor: pointer;
            box-shadow: var(--shadow-neon-green);
            transition: all var(--transition-med);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: var(--shadow-neon-lilac);
        }

        /* Timeline */
        .timeline {
            position: relative;
            padding-left: 1.5rem;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, var(--green-soft), var(--lilac-soft));
        }

        .timeline-item {
            position: relative;
            padding-bottom: 1rem;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -1.5rem;
            top: 0.2rem;
            width: 10px;
            height: 10px;
            background: var(--green-soft);
            border-radius: 50%;
            transform: translateX(-50%);
        }

        .timeline-date {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65rem;
            color: var(--lilac-soft);
        }

        .timeline-content {
            background: var(--bg-input);
            padding: 0.75rem;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border-color);
            font-size: 0.85rem;
            margin-top: 0.25rem;
        }

        /* Dropzone */
        .dropzone {
            border: 2px dashed var(--border-color);
            border-radius: var(--radius-lg);
            padding: 2rem;
            text-align: center;
            transition: all var(--transition-med);
            cursor: pointer;
        }

        .dropzone:hover,
        .dropzone.dragover {
            border-color: var(--green-soft);
            background: var(--green-subtle);
        }

        .dropzone-icon { font-size: 2.5rem; margin-bottom: 0.75rem; color: var(--text-muted); }
        .dropzone-text { color: var(--text-secondary); margin-bottom: 0.3rem; }
        .dropzone-hint { font-size: 0.75rem; color: var(--text-muted); }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--green-soft); }

        /* Print */
        @media print {
            .header, .nav-tabs, .btn, .bg-effects, .fab { display: none !important; }
            .main-container { padding-top: 0; }
            .section { display: block !important; page-break-after: always; }
            body { background: white; color: black; }
        }

        @media (max-width: 640px) {
            .header-actions .btn span:not(:first-child) { display: none; }
            .section-title { font-size: 1.25rem; }
        }
    </style>
</head>
<body>
    <div class="bg-effects">
        <div class="grid-overlay"></div>
        <div class="bg-gradient bg-gradient-1"></div>
        <div class="bg-gradient bg-gradient-2"></div>
        <div class="bg-gradient bg-gradient-3"></div>
    </div>

    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">‚ö°</div>
                <span class="logo-text">Plaidoyer Citoyen</span>
                <span class="logo-version">2.0</span>
            </div>
            <div class="header-actions">
                <button class="btn btn-ghost" onclick="openModal('import')" title="Importer">üì•</button>
                <button class="btn btn-ghost" onclick="openModal('export')" title="Exporter">üì§</button>
                <button class="btn btn-primary" onclick="saveProject()">
                    <span>üíæ</span><span>Sauver</span>
                </button>
            </div>
        </div>
    </header>

    <nav class="nav-tabs">
        <div class="nav-tabs-inner">
            <button class="nav-tab active" data-section="accueil">üè† Accueil</button>
            <button class="nav-tab" data-section="voir">üëÅÔ∏è Voir</button>
            <button class="nav-tab" data-section="juger">‚öñÔ∏è Juger</button>
            <button class="nav-tab" data-section="agir">üöÄ Agir</button>
            <button class="nav-tab highlight" data-section="intelligence">üß† Intelligence</button>
            <button class="nav-tab highlight" data-section="veille">üì° Veille</button>
            <button class="nav-tab" data-section="suivi">üìä Suivi</button>
            <button class="nav-tab" data-section="ressources">üìö Ressources</button>
        </div>
    </nav>

    <main class="main-container">
        <!-- ACCUEIL -->
        <section id="accueil" class="section active">
            <div class="section-header" style="padding: 2rem 0;">
                <h1 class="section-title" style="font-size: 2rem;">Plaidoyer Citoyen 2.0</h1>
                <p class="section-subtitle">
                    Intelligence Civile ‚Ä¢ Veille Citoyenne ‚Ä¢ 15+ Outils vers le Changement
                </p>
            </div>

            <div class="quick-stats">
                <div class="stat-card">
                    <div class="stat-value" id="stat-tools">18</div>
                    <div class="stat-label">Outils</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-progress">0%</div>
                    <div class="stat-label">Progression</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-actors">0</div>
                    <div class="stat-label">Acteurs</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-veille">0</div>
                    <div class="stat-label">Signalements</div>
                </div>
            </div>

            <div style="text-align: center; margin-bottom: 2rem;">
                <button class="btn btn-primary" onclick="switchSection('voir')" style="margin: 0.25rem;">
                    üöÄ Commencer
                </button>
                <button class="btn btn-secondary" onclick="switchSection('intelligence')" style="margin: 0.25rem;">
                    üß† Intelligence Civile
                    <span class="feature-badge">NEW</span>
                </button>
            </div>

            <div class="section-header">
                <h2 class="section-title" style="font-size: 1.25rem;">M√©thodologie Voir-Juger-Agir</h2>
            </div>

            <div class="phase-grid">
                <div class="phase-card voir" onclick="switchSection('voir')">
                    <div class="phase-icon">üëÅÔ∏è</div>
                    <div class="phase-name">VOIR</div>
                    <p class="phase-desc">Analyser le contexte et identifier les acteurs cl√©s.</p>
                    <div class="phase-tools">4 outils</div>
                </div>
                <div class="phase-card juger" onclick="switchSection('juger')">
                    <div class="phase-icon">‚öñÔ∏è</div>
                    <div class="phase-name">JUGER</div>
                    <p class="phase-desc">R√©flexion critique et √©laboration de la strat√©gie.</p>
                    <div class="phase-tools">5 outils</div>
                </div>
                <div class="phase-card agir" onclick="switchSection('agir')">
                    <div class="phase-icon">üöÄ</div>
                    <div class="phase-name">AGIR</div>
                    <p class="phase-desc">Actions concr√®tes et suivi de l'impact.</p>
                    <div class="phase-tools">6 outils</div>
                </div>
            </div>

            <div class="progress-container" style="margin-top: 2rem;">
                <div class="progress-header">
                    <span class="progress-label">Progression globale</span>
                    <span class="progress-value" id="global-progress">0%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="global-progress-fill" style="width: 0%;"></div>
                </div>
            </div>
        </section>

        <!-- VOIR -->
        <section id="voir" class="section">
            <div class="section-header">
                <h2 class="section-title">üëÅÔ∏è Phase VOIR</h2>
                <p class="section-subtitle">Comprendre le contexte, identifier les acteurs, analyser les dynamiques.</p>
            </div>

            <div class="card" data-tool="1">
                <div class="card-header" onclick="toggleCard(this.parentElement)">
                    <span class="card-number">01</span>
                    <h3 class="card-title">Domino du Changement</h3>
                    <div class="card-toggle">‚ñº</div>
                </div>
                <div class="card-content">
                    <p class="card-description">Cadrez votre projet en r√©fl√©chissant √† vos motivations et au changement d√©sir√©.</p>
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">Pourquoi voulons-nous nous engager ?</label>
                            <textarea class="form-textarea" data-field="domino_pourquoi" placeholder="Vos motivations..."></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Quelles valeurs portons-nous ?</label>
                            <textarea class="form-textarea" data-field="domino_valeurs" placeholder="Vos valeurs..."></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Quels changements souhaitons-nous ?</label>
                            <textarea class="form-textarea" data-field="domino_changements" placeholder="Votre vision..."></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Quelles actions mener ?</label>
                            <textarea class="form-textarea" data-field="domino_actions" placeholder="Actions possibles..."></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card" data-tool="2">
                <div class="card-header" onclick="toggleCard(this.parentElement)">
                    <span class="card-number">02</span>
                    <h3 class="card-title">Quel est mon profil ?</h3>
                    <div class="card-toggle">‚ñº</div>
                </div>
                <div class="card-content">
                    <p class="card-description">Identifiez votre profil dominant pour cr√©er des alliances compl√©mentaires.</p>
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">T√¢che pr√©f√©r√©e au quotidien ?</label>
                            <select class="form-select" data-field="profil_q1">
                                <option value="">S√©lectionnez...</option>
                                <option value="a">Organiser, planifier</option>
                                <option value="b">Communiquer, √©changer</option>
                                <option value="c">Rechercher, analyser</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Face √† un probl√®me ?</label>
                            <select class="form-select" data-field="profil_q2">
                                <option value="">S√©lectionnez...</option>
                                <option value="a">Faire un bilan</option>
                                <option value="b">Interroger les personnes</option>
                                <option value="c">Rechercher l'origine</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn btn-secondary" style="margin-top: 0.5rem;" onclick="calculateProfile()">Voir mon profil</button>
                    <div id="profile-result" style="margin-top: 1rem; display: none;"></div>
                </div>
            </div>

            <div class="card" data-tool="3">
                <div class="card-header" onclick="toggleCard(this.parentElement)">
                    <span class="card-number">03</span>
                    <h3 class="card-title">Fleur de Pouvoir</h3>
                    <div class="card-toggle">‚ñº</div>
                </div>
                <div class="card-content">
                    <p class="card-description">Analysez votre position par rapport aux structures de pouvoir.</p>
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">üé≠ Genre</label>
                            <input type="text" class="form-input" data-field="fleur_genre" placeholder="Position...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">üåç Origine</label>
                            <input type="text" class="form-input" data-field="fleur_origine" placeholder="Position...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">üí∞ Classe sociale</label>
                            <input type="text" class="form-input" data-field="fleur_classe" placeholder="Position...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">üéì Niveau d'√©tudes</label>
                            <input type="text" class="form-input" data-field="fleur_etudes" placeholder="Position...">
                        </div>
                    </div>
                </div>
            </div>

            <div class="card" data-tool="4">
                <div class="card-header" onclick="toggleCard(this.parentElement)">
                    <span class="card-number">04</span>
                    <h3 class="card-title">Power Mapping Interactif</h3>
                    <span class="feature-badge">ENHANCED</span>
                    <div class="card-toggle">‚ñº</div>
                </div>
                <div class="card-content">
                    <p class="card-description">Cartographiez les acteurs selon leur influence et position.</p>
                    
                    <div class="power-map-container">
                        <div class="power-map" id="power-map">
                            <div class="power-map-axis horizontal"></div>
                            <div class="power-map-axis vertical"></div>
                            <div class="power-map-label top">HAUTE INFLUENCE</div>
                            <div class="power-map-label bottom">BASSE INFLUENCE</div>
                            <div class="power-map-label left">OPPOSANT</div>
                            <div class="power-map-label right">ALLI√â</div>
                            <div class="power-map-quadrant q1">Alli√©s cl√©s</div>
                            <div class="power-map-quadrant q2">√Ä convaincre</div>
                            <div class="power-map-quadrant q3">Faible priorit√©</div>
                            <div class="power-map-quadrant q4">Mobiliser</div>
                        </div>
                    </div>

                    <div class="grid-2" style="margin-top: 1rem;">
                        <div class="form-group">
                            <label class="form-label">Nom de l'acteur</label>
                            <input type="text" class="form-input" id="actor-name" placeholder="Ex: Minist√®re...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Position</label>
                            <select class="form-select" id="actor-position">
                                <option value="ally">‚úÖ Alli√©</option>
                                <option value="neutral">‚ö™ Neutre</option>
                                <option value="opponent">‚ùå Opposant</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="addPowerActor()">‚ûï Ajouter sur la carte</button>
                </div>
            </div>
        </section>

        <!-- JUGER -->
        <section id="juger" class="section">
            <div class="section-header">
                <h2 class="section-title">‚öñÔ∏è Phase JUGER</h2>
                <p class="section-subtitle">Analyser les rapports de force et planifier la strat√©gie.</p>
            </div>

            <div class="card" data-tool="5">
                <div class="card-header" onclick="toggleCard(this.parentElement)">
                    <span class="card-number">05</span>
                    <h3 class="card-title">Th√©orie du Changement</h3>
                    <div class="card-toggle">‚ñº</div>
                </div>
                <div class="card-content">
                    <p class="card-description">Sch√©matisez le chemin vers le changement souhait√©.</p>
                    <div class="form-group">
                        <label class="form-label" style="color: var(--green-soft);">üéØ Vision</label>
                        <textarea class="form-textarea" data-field="toc_vision" placeholder="Futur id√©al..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label" style="color: var(--lilac-soft);">üíé Valeurs</label>
                        <textarea class="form-textarea" data-field="toc_valeurs" placeholder="Principes..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label" style="color: var(--cyan);">üí° Hypoth√®ses</label>
                        <textarea class="form-textarea" data-field="toc_hypotheses" placeholder="Si... alors..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label" style="color: var(--orange);">üéØ Missions</label>
                        <textarea class="form-textarea" data-field="toc_missions" placeholder="Actions pour contribuer..."></textarea>
                    </div>
                </div>
            </div>

            <div class="card" data-tool="6">
                <div class="card-header" onclick="toggleCard(this.parentElement)">
                    <span class="card-number">06</span>
                    <h3 class="card-title">Analyse SWOT</h3>
                    <div class="card-toggle">‚ñº</div>
                </div>
                <div class="card-content">
                    <div class="swot-grid">
                        <div class="swot-cell strengths">
                            <div class="swot-label">üí™ Forces</div>
                            <textarea class="form-textarea" data-field="swot_forces" placeholder="En quoi excellons-nous ?"></textarea>
                        </div>
                        <div class="swot-cell weaknesses">
                            <div class="swot-label">‚ö†Ô∏è Faiblesses</div>
                            <textarea class="form-textarea" data-field="swot_faiblesses" placeholder="Que nous manque-t-il ?"></textarea>
                        </div>
                        <div class="swot-cell opportunities">
                            <div class="swot-label">üåü Opportunit√©s</div>
                            <textarea class="form-textarea" data-field="swot_opportunites" placeholder="√âvolutions favorables ?"></textarea>
                        </div>
                        <div class="swot-cell threats">
                            <div class="swot-label">üî• Menaces</div>
                            <textarea class="form-textarea" data-field="swot_menaces" placeholder="Obstacles, risques ?"></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card" data-tool="7">
                <div class="card-header" onclick="toggleCard(this.parentElement)">
                    <span class="card-number">07</span>
                    <h3 class="card-title">Analyse PESTEL</h3>
                    <div class="card-toggle">‚ñº</div>
                </div>
                <div class="card-content">
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">üèõÔ∏è Politique</label>
                            <textarea class="form-textarea" data-field="pestel_politique" placeholder="Tendances politiques..."></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">üíπ √âconomique</label>
                            <textarea class="form-textarea" data-field="pestel_economique" placeholder="Tendances √©conomiques..."></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">üë• Social</label>
                            <textarea class="form-textarea" data-field="pestel_social" placeholder="Opinion publique..."></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">üíª Technologique</label>
                            <textarea class="form-textarea" data-field="pestel_techno" placeholder="Innovations..."></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">üåø Environnemental</label>
                            <textarea class="form-textarea" data-field="pestel_env" placeholder="Enjeux √©cologiques..."></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label">‚öñÔ∏è L√©gal</label>
                            <textarea class="form-textarea" data-field="pestel_legal" placeholder="Lois, r√©glementations..."></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card" data-tool="8">
                <div class="card-header" onclick="toggleCard(this.parentElement)">
                    <span class="card-number">08</span>
                    <h3 class="card-title">Arbre √† Probl√®me</h3>
                    <div class="card-toggle">‚ñº</div>
                </div>
                <div class="card-content">
                    <div class="form-group">
                        <label class="form-label" style="color: var(--green-soft);">üå≥ Probl√®me Central</label>
                        <input type="text" class="form-input" data-field="arbre_probleme" placeholder="Probl√®me principal..." style="text-align: center;">
                    </div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label" style="color: var(--lilac-soft);">üåø Causes (racines)</label>
                            <textarea class="form-textarea" data-field="arbre_causes" placeholder="‚Ä¢ Cause 1&#10;‚Ä¢ Cause 2..."></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label" style="color: var(--cyan);">üçÉ Cons√©quences (branches)</label>
                            <textarea class="form-textarea" data-field="arbre_consequences" placeholder="‚Ä¢ Cons√©quence 1&#10;‚Ä¢ Cons√©quence 2..."></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card" data-tool="9">
                <div class="card-header" onclick="toggleCard(this.parentElement)">
                    <span class="card-number">09</span>
                    <h3 class="card-title">Les 5 Pourquoi</h3>
                    <div class="card-toggle">‚ñº</div>
                </div>
                <div class="card-content">
                    <div class="form-group">
                        <label class="form-label">Probl√®me de d√©part</label>
                        <input type="text" class="form-input" data-field="pourquoi_0" placeholder="Le probl√®me...">
                    </div>
                    <div class="form-group">
                        <label class="form-label" style="color: var(--green-soft);">1Ô∏è‚É£ Pourquoi ?</label>
                        <input type="text" class="form-input" data-field="pourquoi_1">
                    </div>
                    <div class="form-group">
                        <label class="form-label" style="color: var(--green-soft);">2Ô∏è‚É£ Pourquoi ?</label>
                        <input type="text" class="form-input" data-field="pourquoi_2">
                    </div>
                    <div class="form-group">
                        <label class="form-label" style="color: var(--lilac-soft);">3Ô∏è‚É£ Pourquoi ?</label>
                        <input type="text" class="form-input" data-field="pourquoi_3">
                    </div>
                    <div class="form-group">
                        <label class="form-label" style="color: var(--lilac-soft);">4Ô∏è‚É£ Pourquoi ?</label>
                        <input type="text" class="form-input" data-field="pourquoi_4">
                    </div>
                    <div class="form-group">
                        <label class="form-label" style="color: var(--cyan);">5Ô∏è‚É£ Pourquoi ? (Cause profonde)</label>
                        <input type="text" class="form-input" data-field="pourquoi_5" style="border-color: var(--cyan);">
                    </div>
                </div>
            </div>
        </section>

        <!-- AGIR -->
        <section id="agir" class="section">
            <div class="section-header">
                <h2 class="section-title">üöÄ Phase AGIR</h2>
                <p class="section-subtitle">Passer √† l'action et mesurer l'impact.</p>
            </div>

            <div class="card" data-tool="10">
                <div class="card-header" onclick="toggleCard(this.parentElement)">
                    <span class="card-number">10</span>
                    <h3 class="card-title">Avec, Sans et Contre le Pouvoir</h3>
                    <div class="card-toggle">‚ñº</div>
                </div>
                <div class="card-content">
                    <div class="grid-3">
                        <div class="form-group">
                            <label class="form-label" style="color: var(--green-soft);">‚úÖ AVEC</label>
                            <textarea class="form-textarea" data-field="pouvoir_avec" placeholder="Dialogue, co-construction..."></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label" style="color: var(--lilac-soft);">‚ö° CONTRE</label>
                            <textarea class="form-textarea" data-field="pouvoir_contre" placeholder="R√©sistance, pression..."></textarea>
                        </div>
                        <div class="form-group">
                            <label class="form-label" style="color: var(--cyan);">üå± SANS</label>
                            <textarea class="form-textarea" data-field="pouvoir_sans" placeholder="Alternatives autonomes..."></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card" data-tool="11">
                <div class="card-header" onclick="toggleCard(this.parentElement)">
                    <span class="card-number">11</span>
                    <h3 class="card-title">Objectifs SMART</h3>
                    <div class="card-toggle">‚ñº</div>
                </div>
                <div class="card-content">
                    <div class="form-group">
                        <label class="form-label">Objectif principal</label>
                        <textarea class="form-textarea" data-field="smart_objectif" placeholder="D'ici [DATE], obtenir [R√âSULTAT]..."></textarea>
                    </div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">üéØ Sp√©cifique</label>
                            <input type="text" class="form-input" data-field="smart_s" placeholder="Quoi pr√©cis√©ment ?">
                        </div>
                        <div class="form-group">
                            <label class="form-label">üìè Mesurable</label>
                            <input type="text" class="form-input" data-field="smart_m" placeholder="Indicateurs ?">
                        </div>
                        <div class="form-group">
                            <label class="form-label">‚úÖ Atteignable</label>
                            <input type="text" class="form-input" data-field="smart_a" placeholder="Comment ?">
                        </div>
                        <div class="form-group">
                            <label class="form-label">üîß R√©aliste</label>
                            <input type="text" class="form-input" data-field="smart_r" placeholder="Moyens ?">
                        </div>
                        <div class="form-group">
                            <label class="form-label">‚è∞ Temporel</label>
                            <input type="date" class="form-input" data-field="smart_t">
                        </div>
                    </div>
                </div>
            </div>

            <div class="card" data-tool="12">
                <div class="card-header" onclick="toggleCard(this.parentElement)">
                    <span class="card-number">12</span>
                    <h3 class="card-title">Cibles et Alliances</h3>
                    <div class="card-toggle">‚ñº</div>
                </div>
                <div class="card-content">
                    <div class="form-group">
                        <label class="form-label" style="color: var(--green-soft);">üéØ Cible principale</label>
                        <input type="text" class="form-input" data-field="cible_principale" placeholder="Qui peut op√©rer le changement ?">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Cibles secondaires</label>
                        <textarea class="form-textarea" data-field="cibles_secondaires" placeholder="Influenceurs de la cible..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label" style="color: var(--lilac-soft);">ü§ù Alli√©s</label>
                        <textarea class="form-textarea" data-field="allies" placeholder="Partenaires potentiels..."></textarea>
                    </div>
                </div>
            </div>

            <div class="card" data-tool="13">
                <div class="card-header" onclick="toggleCard(this.parentElement)">
                    <span class="card-number">13</span>
                    <h3 class="card-title">Construire un Message</h3>
                    <div class="card-toggle">‚ñº</div>
                </div>
                <div class="card-content">
                    <div class="form-group">
                        <label class="form-label" style="color: var(--green-soft);">‚ö° Accroche</label>
                        <input type="text" class="form-input" data-field="msg_accroche" placeholder="Fait marquant...">
                    </div>
                    <div class="form-group">
                        <label class="form-label">üîç Probl√®me</label>
                        <textarea class="form-textarea" data-field="msg_probleme" placeholder="Description claire..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">üí° Importance</label>
                        <textarea class="form-textarea" data-field="msg_importance" placeholder="Pourquoi agir maintenant ?"></textarea>
                    </div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">üéØ Cible</label>
                            <input type="text" class="form-input" data-field="msg_cible" placeholder="√Ä qui ?">
                        </div>
                        <div class="form-group">
                            <label class="form-label">‚úä Action demand√©e</label>
                            <input type="text" class="form-input" data-field="msg_action" placeholder="Que doit faire la cible ?">
                        </div>
                    </div>
                    <button class="btn btn-primary" style="margin-top: 0.5rem;" onclick="generateMessage()">G√©n√©rer le message</button>
                    <div id="generated-message" style="margin-top: 1rem; padding: 1rem; background: var(--bg-input); border-radius: var(--radius-sm); display: none;"></div>
                </div>
            </div>

            <div class="card" data-tool="14">
                <div class="card-header" onclick="toggleCard(this.parentElement)">
                    <span class="card-number">14</span>
                    <h3 class="card-title">Check-list Rencontre</h3>
                    <div class="card-toggle">‚ñº</div>
                </div>
                <div class="card-content">
                    <div class="checklist" id="checklist-meeting">
                        <div class="checklist-item" onclick="toggleCheck(this)">
                            <div class="checkbox"></div>
                            <span class="checklist-text">Recherches sur le contexte politique</span>
                        </div>
                        <div class="checklist-item" onclick="toggleCheck(this)">
                            <div class="checkbox"></div>
                            <span class="checklist-text">Demande de rendez-vous envoy√©e</span>
                        </div>
                        <div class="checklist-item" onclick="toggleCheck(this)">
                            <div class="checkbox"></div>
                            <span class="checklist-text">Messages cl√©s pr√©par√©s</span>
                        </div>
                        <div class="checklist-item" onclick="toggleCheck(this)">
                            <div class="checkbox"></div>
                            <span class="checklist-text">Documents √† transmettre pr√™ts</span>
                        </div>
                        <div class="checklist-item" onclick="toggleCheck(this)">
                            <div class="checkbox"></div>
                            <span class="checklist-text">R√¥les distribu√©s dans l'√©quipe</span>
                        </div>
                        <div class="checklist-item" onclick="toggleCheck(this)">
                            <div class="checkbox"></div>
                            <span class="checklist-text">Compte-rendu r√©dig√©</span>
                        </div>
                        <div class="checklist-item" onclick="toggleCheck(this)">
                            <div class="checkbox"></div>
                            <span class="checklist-text">Remerciements envoy√©s</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card" data-tool="15">
                <div class="card-header" onclick="toggleCard(this.parentElement)">
                    <span class="card-number">15</span>
                    <h3 class="card-title">Suivi et √âvaluation</h3>
                    <div class="card-toggle">‚ñº</div>
                </div>
                <div class="card-content">
                    <div class="grid-2">
                        <div class="form-group">
                            <label class="form-label">L'approche fonctionne ?</label>
                            <select class="form-select" data-field="eval_approche">
                                <option value="">√âvaluer...</option>
                                <option value="oui">‚úÖ Oui</option>
                                <option value="partiel">‚ö†Ô∏è Partiellement</option>
                                <option value="non">‚ùå Non</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Message atteint les bonnes personnes ?</label>
                            <select class="form-select" data-field="eval_message">
                                <option value="">√âvaluer...</option>
                                <option value="oui">‚úÖ Oui</option>
                                <option value="partiel">‚ö†Ô∏è Partiellement</option>
                                <option value="non">‚ùå Non</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Notes et ajustements</label>
                        <textarea class="form-textarea" data-field="eval_notes" placeholder="Pistes d'am√©lioration..."></textarea>
                    </div>
                </div>
            </div>
        </section>

        <!-- INTELLIGENCE CIVILE -->
        <section id="intelligence" class="section">
            <div class="section-header">
                <h2 class="section-title">üß† Intelligence Civile</h2>
                <p class="section-subtitle">Veille strat√©gique, collecte collaborative et influence d'int√©r√™t g√©n√©ral.</p>
            </div>

            <div class="card" style="border-color: var(--cyan);">
                <h3 style="color: var(--cyan); margin-bottom: 1rem; font-family: 'Orbitron', monospace;">Le Cycle de l'Intelligence Civile</h3>
                <div class="ic-cycle">
                    <div class="ic-step">
                        <div class="ic-step-icon">üí¨</div>
                        <div class="ic-step-title">EXPRESSION</div>
                        <div class="ic-step-desc">Besoins informationnels collectifs</div>
                    </div>
                    <div class="ic-arrow">‚Üí</div>
                    <div class="ic-step">
                        <div class="ic-step-icon">üì•</div>
                        <div class="ic-step-title">COLLECTE</div>
                        <div class="ic-step-desc">Informations par les participants</div>
                    </div>
                    <div class="ic-arrow">‚Üí</div>
                    <div class="ic-step">
                        <div class="ic-step-icon">üî¨</div>
                        <div class="ic-step-title">TRAITEMENT</div>
                        <div class="ic-step-desc">Analyses critiques partag√©es</div>
                    </div>
                    <div class="ic-arrow">‚Üí</div>
                    <div class="ic-step">
                        <div class="ic-step-icon">üì§</div>
                        <div class="ic-step-title">DIFFUSION</div>
                        <div class="ic-step-desc">Vers la communaut√©</div>
                    </div>
                </div>
            </div>

            <div class="card" data-tool="ic1">
                <div class="card-header" onclick="toggleCard(this.parentElement)">
                    <span class="card-number" style="background: linear-gradient(135deg, var(--cyan), var(--lilac-soft));">IC</span>
                    <h3 class="card-title">Veille Strat√©gique</h3>
                    <div class="card-toggle">‚ñº</div>
                </div>
                <div class="card-content">
                    <p class="card-description">D√©finissez vos axes de veille et sources prioritaires.</p>
                    <div class="form-group">
                        <label class="form-label">Th√©matiques de veille</label>
                        <textarea class="form-textarea" data-field="ic_themes" placeholder="Ex: Transition √©cologique, Droits sociaux..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Sources prioritaires</label>
                        <textarea class="form-textarea" data-field="ic_sources" placeholder="Sites, m√©dias, institutions √† surveiller..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Mots-cl√©s de veille</label>
                        <input type="text" class="form-input" data-field="ic_keywords" placeholder="S√©par√©s par des virgules...">
                    </div>
                </div>
            </div>

            <div class="card" data-tool="ic2">
                <div class="card-header" onclick="toggleCard(this.parentElement)">
                    <span class="card-number" style="background: linear-gradient(135deg, var(--cyan), var(--lilac-soft));">IC</span>
                    <h3 class="card-title">Protection & √âthique</h3>
                    <div class="card-toggle">‚ñº</div>
                </div>
                <div class="card-content">
                    <p class="card-description">R√®gles √©thiques pour la collecte et le traitement de l'information.</p>
                    <div class="checklist">
                        <div class="checklist-item" onclick="toggleCheck(this)">
                            <div class="checkbox"></div>
                            <span class="checklist-text">Respecter la vie priv√©e des personnes</span>
                        </div>
                        <div class="checklist-item" onclick="toggleCheck(this)">
                            <div class="checkbox"></div>
                            <span class="checklist-text">V√©rifier les sources avant diffusion</span>
                        </div>
                        <div class="checklist-item" onclick="toggleCheck(this)">
                            <div class="checkbox"></div>
                            <span class="checklist-text">Anonymiser les donn√©es sensibles</span>
                        </div>
                        <div class="checklist-item" onclick="toggleCheck(this)">
                            <div class="checkbox"></div>
                            <span class="checklist-text">Transparence sur les m√©thodes</span>
                        </div>
                        <div class="checklist-item" onclick="toggleCheck(this)">
                            <div class="checkbox"></div>
                            <span class="checklist-text">Servir l'int√©r√™t g√©n√©ral</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card" data-tool="ic3">
                <div class="card-header" onclick="toggleCard(this.parentElement)">
                    <span class="card-number" style="background: linear-gradient(135deg, var(--cyan), var(--lilac-soft));">IC</span>
                    <h3 class="card-title">Influence d'Int√©r√™t G√©n√©ral</h3>
                    <div class="card-toggle">‚ñº</div>
                </div>
                <div class="card-content">
                    <p class="card-description">Strat√©gies d'influence au service du bien commun.</p>
                    <div class="form-group">
                        <label class="form-label">Canaux d'influence</label>
                        <textarea class="form-textarea" data-field="ic_canaux" placeholder="M√©dias, r√©seaux sociaux, √©v√©nements..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Narratif principal</label>
                        <textarea class="form-textarea" data-field="ic_narratif" placeholder="Le r√©cit que nous souhaitons diffuser..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Indicateurs d'influence</label>
                        <textarea class="form-textarea" data-field="ic_indicateurs" placeholder="Comment mesurer notre impact ?"></textarea>
                    </div>
                </div>
            </div>
        </section>

        <!-- VEILLE CITOYENNE -->
        <section id="veille" class="section">
            <div class="section-header">
                <h2 class="section-title">üì° Veille Citoyenne</h2>
                <p class="section-subtitle">Observatoire participatif et signalements collaboratifs.</p>
            </div>

            <div class="veille-grid">
                <div>
                    <div class="card" style="margin-bottom: 1rem;">
                        <h3 style="color: var(--cyan); margin-bottom: 1rem;">‚ûï Nouveau signalement</h3>
                        <div class="form-group">
                            <label class="form-label">Titre</label>
                            <input type="text" class="form-input" id="veille-title" placeholder="Titre du signalement...">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea class="form-textarea" id="veille-desc" placeholder="D√©tails..."></textarea>
                        </div>
                        <div class="grid-2">
                            <div class="form-group">
                                <label class="form-label">Cat√©gorie</label>
                                <select class="form-select" id="veille-cat">
                                    <option value="politique">üèõÔ∏è Politique</option>
                                    <option value="social">üë• Social</option>
                                    <option value="environnement">üåø Environnement</option>
                                    <option value="economie">üíπ √âconomie</option>
                                    <option value="autre">üìå Autre</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Priorit√©</label>
                                <select class="form-select" id="veille-priority">
                                    <option value="low">üü¢ Basse</option>
                                    <option value="medium">üü° Moyenne</option>
                                    <option value="high">üî¥ Haute</option>
                                </select>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="addVeilleItem()">üì° Signaler</button>
                    </div>

                    <div class="veille-feed" id="veille-feed">
                        <div style="text-align: center; color: var(--text-muted); padding: 2rem;">
                            Aucun signalement pour le moment.<br>
                            Ajoutez votre premi√®re observation !
                        </div>
                    </div>
                </div>

                <div>
                    <div class="card">
                        <h4 style="color: var(--lilac-soft); margin-bottom: 1rem;">üìä Statistiques</h4>
                        <div class="stat-card" style="margin-bottom: 0.5rem;">
                            <div class="stat-value" id="veille-total">0</div>
                            <div class="stat-label">Signalements</div>
                        </div>
                        <div style="margin-top: 1rem;">
                            <div class="tag cyan">üèõÔ∏è Politique: <span id="veille-politique">0</span></div>
                            <div class="tag">üåø Environnement: <span id="veille-env">0</span></div>
                            <div class="tag lilac">üë• Social: <span id="veille-social">0</span></div>
                        </div>
                    </div>

                    <div class="card" style="margin-top: 1rem;">
                        <h4 style="color: var(--green-soft); margin-bottom: 1rem;">üí° Conseils</h4>
                        <ul style="color: var(--text-secondary); font-size: 0.8rem; padding-left: 1.2rem;">
                            <li style="margin-bottom: 0.5rem;">Soyez factuel et pr√©cis</li>
                            <li style="margin-bottom: 0.5rem;">Citez vos sources</li>
                            <li style="margin-bottom: 0.5rem;">Respectez la vie priv√©e</li>
                            <li>Privil√©giez l'int√©r√™t g√©n√©ral</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- SUIVI -->
        <section id="suivi" class="section">
            <div class="section-header">
                <h2 class="section-title">üìä Tableau de Bord</h2>
            </div>

            <div class="quick-stats">
                <div class="stat-card">
                    <div class="stat-value" id="dash-fields">0</div>
                    <div class="stat-label">Champs remplis</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="dash-actors">0</div>
                    <div class="stat-label">Acteurs mapp√©s</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="dash-checks">0</div>
                    <div class="stat-label">T√¢ches OK</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="dash-veille">0</div>
                    <div class="stat-label">Veilles</div>
                </div>
            </div>

            <div class="card">
                <h3 style="color: var(--green-soft); margin-bottom: 1rem;">üìà Progression par phase</h3>
                <div class="progress-container">
                    <div class="progress-header">
                        <span class="progress-label">üëÅÔ∏è VOIR</span>
                        <span class="progress-value" id="prog-voir">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="prog-voir-fill" style="width: 0%;"></div>
                    </div>
                </div>
                <div class="progress-container">
                    <div class="progress-header">
                        <span class="progress-label">‚öñÔ∏è JUGER</span>
                        <span class="progress-value" id="prog-juger">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="prog-juger-fill" style="width: 0%;"></div>
                    </div>
                </div>
                <div class="progress-container">
                    <div class="progress-header">
                        <span class="progress-label">üöÄ AGIR</span>
                        <span class="progress-value" id="prog-agir">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="prog-agir-fill" style="width: 0%;"></div>
                    </div>
                </div>
                <div class="progress-container">
                    <div class="progress-header">
                        <span class="progress-label">üß† INTELLIGENCE</span>
                        <span class="progress-value" id="prog-ic">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="prog-ic-fill" style="width: 0%; background: linear-gradient(90deg, var(--cyan), var(--lilac-soft));"></div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h3 style="color: var(--lilac-soft); margin-bottom: 1rem;">üìÖ Journal de bord</h3>
                <div class="form-group">
                    <textarea class="form-textarea" id="journal-input" placeholder="Notez vos actions, rencontres..."></textarea>
                </div>
                <button class="btn btn-secondary" onclick="addJournalEntry()">‚ûï Ajouter</button>
                <div id="journal-timeline" class="timeline" style="margin-top: 1rem;"></div>
            </div>
        </section>

        <!-- RESSOURCES -->
        <section id="ressources" class="section">
            <div class="section-header">
                <h2 class="section-title">üìö Ressources</h2>
            </div>

            <div class="card">
                <h3 style="color: var(--green-soft); margin-bottom: 1rem;">üìñ Sources</h3>
                <div style="color: var(--text-secondary); font-size: 0.85rem;">
                    <p>‚Ä¢ <strong>Justice et Paix</strong> ‚Äî Le petit guide du plaidoyer citoyen (2020)</p>
                    <p>‚Ä¢ <strong>ULB-Coop√©ration</strong> ‚Äî Manuel Plaidoyer v4 (2022)</p>
                    <p>‚Ä¢ <strong>Intelligence Civile</strong> ‚Äî Guide pour l'√©ducation permanente</p>
                    <p>‚Ä¢ <strong>Veille Citoyenne</strong> ‚Äî Enjeux et pratiques</p>
                </div>
            </div>

            <div class="card">
                <h3 style="color: var(--lilac-soft); margin-bottom: 1rem;">üíæ Export Multiformats</h3>
                <div class="export-options">
                    <div class="export-option" onclick="exportProject('json')">
                        <div class="export-icon">üìÑ</div>
                        <div class="export-name">JSON</div>
                        <div class="export-desc">Sauvegarde</div>
                    </div>
                    <div class="export-option" onclick="exportProject('md')">
                        <div class="export-icon">üìù</div>
                        <div class="export-name">Markdown</div>
                        <div class="export-desc">Documentation</div>
                    </div>
                    <div class="export-option" onclick="exportProject('html')">
                        <div class="export-icon">üåê</div>
                        <div class="export-name">HTML</div>
                        <div class="export-desc">Page web</div>
                    </div>
                    <div class="export-option" onclick="window.print()">
                        <div class="export-icon">üñ®Ô∏è</div>
                        <div class="export-name">PDF</div>
                        <div class="export-desc">Imprimer</div>
                    </div>
                </div>

                <div class="dropzone" style="margin-top: 1rem;" 
                    ondragover="event.preventDefault(); this.classList.add('dragover')"
                    ondragleave="this.classList.remove('dragover')"
                    ondrop="handleDrop(event)"
                    onclick="document.getElementById('file-input').click()">
                    <div class="dropzone-icon">üìÇ</div>
                    <div class="dropzone-text">Importer un projet JSON</div>
                    <div class="dropzone-hint">Glissez ou cliquez</div>
                    <input type="file" id="file-input" accept=".json" style="display: none;" onchange="importFile(event)">
                </div>
            </div>
        </section>
    </main>

    <button class="fab" onclick="showNotification('üí° Ctrl+S pour sauvegarder rapidement')">‚ö°</button>

    <div class="toast-container" id="toast-container"></div>

    <script>
        // State
        let data = {
            meta: { created: new Date().toISOString(), updated: new Date().toISOString() },
            fields: {},
            actors: [],
            veille: [],
            journal: [],
            checks: {}
        };

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            loadProject();
            setupListeners();
            updateDashboard();
        });

        function setupListeners() {
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', () => switchSection(tab.dataset.section));
            });

            document.querySelectorAll('[data-field]').forEach(field => {
                field.addEventListener('input', debounce(() => {
                    data.fields[field.dataset.field] = field.value;
                    saveProject(false);
                    updateDashboard();
                }, 400));
            });
        }

        function switchSection(id) {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.toggle('active', t.dataset.section === id));
            document.querySelectorAll('.section').forEach(s => s.classList.toggle('active', s.id === id));
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function toggleCard(card) { card.classList.toggle('expanded'); }

        function toggleCheck(item) {
            item.classList.toggle('completed');
            item.querySelector('.checkbox').classList.toggle('checked');
            const idx = Array.from(document.querySelectorAll('.checklist-item')).indexOf(item);
            data.checks[`c${idx}`] = item.classList.contains('completed');
            saveProject(false);
            updateDashboard();
        }

        // Power Map
        function addPowerActor() {
            const name = document.getElementById('actor-name').value.trim();
            const position = document.getElementById('actor-position').value;
            if (!name) return showNotification('Entrez un nom', 'error');

            const map = document.getElementById('power-map');
            const x = 25 + Math.random() * 50;
            const y = 25 + Math.random() * 50;

            const actor = { id: Date.now(), name, position, x, y };
            data.actors.push(actor);
            renderPowerActor(actor);
            document.getElementById('actor-name').value = '';
            saveProject(false);
            updateDashboard();
            showNotification('Acteur ajout√© !');
        }

        function renderPowerActor(actor) {
            const map = document.getElementById('power-map');
            const el = document.createElement('div');
            el.className = `power-actor ${actor.position}`;
            el.textContent = actor.name;
            el.style.left = actor.x + '%';
            el.style.top = actor.y + '%';
            el.draggable = true;
            el.dataset.id = actor.id;

            el.addEventListener('mousedown', startDrag);
            el.addEventListener('touchstart', startDrag, { passive: false });
            map.appendChild(el);
        }

        function startDrag(e) {
            e.preventDefault();
            const el = e.target;
            const map = document.getElementById('power-map');
            const rect = map.getBoundingClientRect();

            function move(e) {
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                const x = Math.max(5, Math.min(95, ((clientX - rect.left) / rect.width) * 100));
                const y = Math.max(5, Math.min(95, ((clientY - rect.top) / rect.height) * 100));
                el.style.left = x + '%';
                el.style.top = y + '%';

                const actor = data.actors.find(a => a.id == el.dataset.id);
                if (actor) { actor.x = x; actor.y = y; }
            }

            function stop() {
                document.removeEventListener('mousemove', move);
                document.removeEventListener('mouseup', stop);
                document.removeEventListener('touchmove', move);
                document.removeEventListener('touchend', stop);
                saveProject(false);
            }

            document.addEventListener('mousemove', move);
            document.addEventListener('mouseup', stop);
            document.addEventListener('touchmove', move, { passive: false });
            document.addEventListener('touchend', stop);
        }

        // Veille
        function addVeilleItem() {
            const title = document.getElementById('veille-title').value.trim();
            const desc = document.getElementById('veille-desc').value.trim();
            const cat = document.getElementById('veille-cat').value;
            const priority = document.getElementById('veille-priority').value;

            if (!title) return showNotification('Entrez un titre', 'error');

            const item = { id: Date.now(), title, desc, cat, priority, date: new Date().toISOString() };
            data.veille.unshift(item);
            renderVeilleItem(item, true);

            document.getElementById('veille-title').value = '';
            document.getElementById('veille-desc').value = '';
            saveProject(false);
            updateDashboard();
            showNotification('Signalement ajout√© !');
        }

        function renderVeilleItem(item, prepend) {
            const feed = document.getElementById('veille-feed');
            if (feed.querySelector('div[style*="text-align: center"]')) feed.innerHTML = '';

            const el = document.createElement('div');
            el.className = 'veille-item';
            const date = new Date(item.date).toLocaleDateString('fr-FR', { day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit' });
            const catIcons = { politique: 'üèõÔ∏è', social: 'üë•', environnement: 'üåø', economie: 'üíπ', autre: 'üìå' };
            const prioColors = { low: 'var(--green-soft)', medium: 'var(--orange)', high: '#ff7f7f' };

            el.innerHTML = `
                <div class="veille-item-header">
                    <span class="veille-item-title">${catIcons[item.cat] || 'üìå'} ${item.title}</span>
                    <span class="veille-item-date">${date}</span>
                </div>
                <div class="veille-item-content">${item.desc || ''}</div>
                <div class="veille-item-tags">
                    <span class="veille-tag" style="background: ${prioColors[item.priority]}20; color: ${prioColors[item.priority]}">${item.priority}</span>
                </div>
            `;

            prepend && feed.firstChild ? feed.insertBefore(el, feed.firstChild) : feed.appendChild(el);
        }

        // Journal
        function addJournalEntry() {
            const text = document.getElementById('journal-input').value.trim();
            if (!text) return;

            const entry = { id: Date.now(), text, date: new Date().toISOString() };
            data.journal.unshift(entry);
            renderJournalEntry(entry, true);
            document.getElementById('journal-input').value = '';
            saveProject(false);
            showNotification('Entr√©e ajout√©e !');
        }

        function renderJournalEntry(entry, prepend) {
            const container = document.getElementById('journal-timeline');
            const el = document.createElement('div');
            el.className = 'timeline-item';
            const date = new Date(entry.date).toLocaleDateString('fr-FR', { day: 'numeric', month: 'short', hour: '2-digit', minute: '2-digit' });
            el.innerHTML = `<div class="timeline-date">${date}</div><div class="timeline-content">${entry.text}</div>`;
            prepend && container.firstChild ? container.insertBefore(el, container.firstChild) : container.appendChild(el);
        }

        // Message
        function generateMessage() {
            const f = data.fields;
            const msg = `${f.msg_accroche || '[Accroche]'}\n\n${f.msg_probleme || '[Probl√®me]'}\n\nPourquoi c'est important : ${f.msg_importance || '[Importance]'}\n\nNous demandons √† ${f.msg_cible || '[Cible]'} de ${f.msg_action || '[Action]'}.`;
            const el = document.getElementById('generated-message');
            el.style.display = 'block';
            el.innerHTML = `<pre style="white-space: pre-wrap; color: var(--text-primary); font-size: 0.85rem;">${msg}</pre>`;
        }

        // Profile
        function calculateProfile() {
            const q1 = data.fields.profil_q1 || '';
            const q2 = data.fields.profil_q2 || '';
            let profile = 'üî¨ Chercheur¬∑euse';
            if (q1 === 'a' || q2 === 'a') profile = 'üóÇÔ∏è Planificateur¬∑trice';
            else if (q1 === 'b' || q2 === 'b') profile = 'üó£Ô∏è Communicateur¬∑trice';
            document.getElementById('profile-result').style.display = 'block';
            document.getElementById('profile-result').innerHTML = `<div style="padding: 1rem; background: var(--bg-input); border-radius: var(--radius-sm);"><strong style="color: var(--green-soft);">${profile}</strong></div>`;
        }

        // Dashboard
        function updateDashboard() {
            const filled = Object.values(data.fields).filter(v => v && v.trim()).length;
            document.getElementById('stat-progress').textContent = Math.min(100, Math.round(filled / 30 * 100)) + '%';
            document.getElementById('stat-actors').textContent = data.actors.length;
            document.getElementById('stat-veille').textContent = data.veille.length;
            document.getElementById('dash-fields').textContent = filled;
            document.getElementById('dash-actors').textContent = data.actors.length;
            document.getElementById('dash-checks').textContent = Object.values(data.checks).filter(v => v).length;
            document.getElementById('dash-veille').textContent = data.veille.length;
            document.getElementById('global-progress').textContent = Math.min(100, Math.round(filled / 30 * 100)) + '%';
            document.getElementById('global-progress-fill').style.width = Math.min(100, Math.round(filled / 30 * 100)) + '%';

            // Veille stats
            document.getElementById('veille-total').textContent = data.veille.length;
            document.getElementById('veille-politique').textContent = data.veille.filter(v => v.cat === 'politique').length;
            document.getElementById('veille-env').textContent = data.veille.filter(v => v.cat === 'environnement').length;
            document.getElementById('veille-social').textContent = data.veille.filter(v => v.cat === 'social').length;

            // Progress bars
            const voirFields = ['domino_pourquoi', 'domino_valeurs', 'domino_changements', 'fleur_genre'];
            const jugerFields = ['toc_vision', 'swot_forces', 'arbre_probleme', 'pourquoi_1'];
            const agirFields = ['smart_objectif', 'cible_principale', 'msg_accroche'];
            const icFields = ['ic_themes', 'ic_sources', 'ic_narratif'];

            const calcProg = (fields) => Math.round(fields.filter(f => data.fields[f] && data.fields[f].trim()).length / fields.length * 100);

            ['voir', 'juger', 'agir', 'ic'].forEach((phase, i) => {
                const fields = [voirFields, jugerFields, agirFields, icFields][i];
                const prog = calcProg(fields);
                document.getElementById(`prog-${phase}`).textContent = prog + '%';
                document.getElementById(`prog-${phase}-fill`).style.width = prog + '%';
            });
        }

        // Save/Load
        function saveProject(notify = true) {
            data.meta.updated = new Date().toISOString();
            localStorage.setItem('plaidoyer_v2', JSON.stringify(data));
            if (notify) showNotification('Projet sauvegard√© !');
        }

        function loadProject() {
            const saved = localStorage.getItem('plaidoyer_v2');
            if (saved) {
                try {
                    data = JSON.parse(saved);
                    Object.entries(data.fields).forEach(([k, v]) => {
                        const el = document.querySelector(`[data-field="${k}"]`);
                        if (el) el.value = v;
                    });
                    data.actors.forEach(a => renderPowerActor(a));
                    data.veille.forEach(v => renderVeilleItem(v, false));
                    data.journal.forEach(j => renderJournalEntry(j, false));
                    Object.entries(data.checks).forEach(([k, v]) => {
                        if (v) {
                            const idx = parseInt(k.replace('c', ''));
                            const items = document.querySelectorAll('.checklist-item');
                            if (items[idx]) {
                                items[idx].classList.add('completed');
                                items[idx].querySelector('.checkbox').classList.add('checked');
                            }
                        }
                    });
                } catch (e) { console.error(e); }
            }
        }

        // Export
        function exportProject(format) {
            const filename = `plaidoyer_${new Date().toISOString().slice(0, 10)}`;
            let content, type;

            if (format === 'json') {
                content = JSON.stringify(data, null, 2);
                type = 'application/json';
            } else if (format === 'md') {
                content = `# Projet de Plaidoyer Citoyen\n\nExport√© le ${new Date().toLocaleDateString('fr-FR')}\n\n`;
                Object.entries(data.fields).forEach(([k, v]) => {
                    if (v && v.trim()) content += `## ${k.replace(/_/g, ' ').toUpperCase()}\n\n${v}\n\n`;
                });
                type = 'text/markdown';
            } else if (format === 'html') {
                content = `<!DOCTYPE html><html lang="fr"><head><meta charset="UTF-8"><title>Plaidoyer</title><style>body{font-family:system-ui;max-width:800px;margin:0 auto;padding:2rem;background:#1a1a2e;color:#eee}h1{color:#7fff7f}h2{color:#c8b6ff;border-bottom:1px solid #333;padding-bottom:0.5rem}.field{margin-bottom:1.5rem;padding:1rem;background:#12121a;border-radius:8px}</style></head><body><h1>Projet de Plaidoyer</h1>`;
                Object.entries(data.fields).forEach(([k, v]) => {
                    if (v && v.trim()) content += `<div class="field"><h2>${k.replace(/_/g, ' ')}</h2><p>${v}</p></div>`;
                });
                content += `</body></html>`;
                type = 'text/html';
            }

            const blob = new Blob([content], { type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${filename}.${format}`;
            a.click();
            URL.revokeObjectURL(url);
            showNotification(`Export ${format.toUpperCase()} OK !`);
        }

        function handleDrop(e) {
            e.preventDefault();
            e.target.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.type === 'application/json') {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        data = JSON.parse(e.target.result);
                        location.reload();
                    } catch (err) { showNotification('Fichier invalide', 'error'); }
                };
                reader.readAsText(file);
            }
        }

        function importFile(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        data = JSON.parse(e.target.result);
                        localStorage.setItem('plaidoyer_v2', JSON.stringify(data));
                        location.reload();
                    } catch (err) { showNotification('Erreur import', 'error'); }
                };
                reader.readAsText(file);
            }
        }

        // Utils
        function showNotification(msg, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `<span>${type === 'success' ? '‚úÖ' : '‚ö†Ô∏è'}</span><span>${msg}</span>`;
            container.appendChild(toast);
            setTimeout(() => { toast.style.opacity = '0'; setTimeout(() => toast.remove(), 300); }, 3000);
        }

        function debounce(fn, ms) {
            let t;
            return (...args) => { clearTimeout(t); t = setTimeout(() => fn(...args), ms); };
        }

        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 's') { e.preventDefault(); saveProject(); }
        });
    </script>
</body>
</html>
