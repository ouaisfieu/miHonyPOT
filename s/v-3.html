<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plaidoyer Citoyen 3.0 ‚Äî Poste de Travail Citoyen</title>
    <meta name="description" content="Plateforme compl√®te de plaidoyer citoyen avec export multi-formats et protocoles d'interop√©rabilit√©">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Quicksand:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.1/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/8.2.3/docx.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PptxGenJS/3.12.0/pptxgen.bundle.min.js"></script>
    <style>
        :root {
            --bg-dark: #0a0a0f;
            --bg-card: #12121a;
            --bg-card-hover: #1a1a25;
            --bg-input: #0d0d14;
            --green-soft: #7fff7f;
            --green-medium: #5fe65f;
            --green-dark: #3da83d;
            --green-glow: rgba(127, 255, 127, 0.4);
            --green-subtle: rgba(127, 255, 127, 0.1);
            --lilac-soft: #c8b6ff;
            --lilac-medium: #a78bfa;
            --lilac-dark: #8b5cf6;
            --lilac-glow: rgba(200, 182, 255, 0.4);
            --lilac-subtle: rgba(200, 182, 255, 0.1);
            --cyan: #60d8c4;
            --cyan-glow: rgba(96, 216, 196, 0.4);
            --cyan-subtle: rgba(96, 216, 196, 0.1);
            --orange: #ffb347;
            --red: #ff6b6b;
            --text-primary: #f0f0f5;
            --text-secondary: #a0a0b0;
            --text-muted: #606070;
            --border-color: rgba(127, 255, 127, 0.2);
            --border-lilac: rgba(200, 182, 255, 0.2);
            --shadow-neon-green: 0 0 20px rgba(127, 255, 127, 0.3), 0 0 40px rgba(127, 255, 127, 0.1);
            --shadow-neon-lilac: 0 0 20px rgba(200, 182, 255, 0.3), 0 0 40px rgba(200, 182, 255, 0.1);
            --shadow-neon-cyan: 0 0 20px rgba(96, 216, 196, 0.3), 0 0 40px rgba(96, 216, 196, 0.1);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --transition-fast: 0.15s ease;
            --transition-med: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { font-family: 'Quicksand', sans-serif; background: var(--bg-dark); color: var(--text-primary); min-height: 100vh; line-height: 1.6; overflow-x: hidden; }
        .bg-effects { position: fixed; inset: 0; pointer-events: none; z-index: 0; overflow: hidden; }
        .bg-gradient { position: absolute; width: 600px; height: 600px; border-radius: 50%; filter: blur(120px); opacity: 0.12; animation: float 25s ease-in-out infinite; }
        .bg-gradient-1 { background: var(--green-soft); top: -200px; left: -200px; }
        .bg-gradient-2 { background: var(--lilac-soft); bottom: -200px; right: -200px; animation-delay: -12s; }
        .bg-gradient-3 { background: var(--cyan); top: 50%; left: 50%; transform: translate(-50%, -50%); width: 400px; height: 400px; opacity: 0.06; animation-delay: -6s; }
        @keyframes float { 0%, 100% { transform: translate(0, 0) scale(1); } 33% { transform: translate(30px, -30px) scale(1.05); } 66% { transform: translate(-20px, 20px) scale(0.95); } }
        .grid-overlay { position: absolute; inset: 0; background-image: linear-gradient(var(--border-color) 1px, transparent 1px), linear-gradient(90deg, var(--border-color) 1px, transparent 1px); background-size: 50px 50px; opacity: 0.2; }
        .header { position: fixed; top: 0; left: 0; right: 0; z-index: 1000; background: rgba(10, 10, 15, 0.95); backdrop-filter: blur(20px); border-bottom: 1px solid var(--border-color); padding: 0.5rem 1rem; }
        .header-content { max-width: 1600px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; gap: 1rem; }
        .logo { display: flex; align-items: center; gap: 0.6rem; }
        .logo-icon { width: 38px; height: 38px; background: linear-gradient(135deg, var(--green-soft), var(--lilac-soft)); border-radius: var(--radius-sm); display: flex; align-items: center; justify-content: center; font-size: 1.1rem; box-shadow: var(--shadow-neon-green); animation: pulse-glow 4s ease-in-out infinite; }
        @keyframes pulse-glow { 0%, 100% { box-shadow: var(--shadow-neon-green); } 50% { box-shadow: var(--shadow-neon-lilac); } }
        .logo-text { font-family: 'Orbitron', monospace; font-weight: 700; font-size: 0.95rem; background: linear-gradient(135deg, var(--green-soft), var(--lilac-soft)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .logo-version { font-size: 0.6rem; background: linear-gradient(135deg, var(--cyan), var(--lilac-soft)); color: var(--bg-dark); padding: 2px 8px; border-radius: 10px; font-weight: 700; }
        .header-actions { display: flex; gap: 0.4rem; }
        .btn { font-family: 'Quicksand', sans-serif; font-weight: 600; padding: 0.5rem 1rem; border-radius: var(--radius-sm); border: none; cursor: pointer; transition: all var(--transition-med); display: flex; align-items: center; gap: 0.4rem; font-size: 0.8rem; position: relative; overflow: hidden; }
        .btn::before { content: ''; position: absolute; inset: 0; background: linear-gradient(135deg, transparent, rgba(255,255,255,0.1), transparent); transform: translateX(-100%); transition: transform var(--transition-med); }
        .btn:hover::before { transform: translateX(100%); }
        .btn-primary { background: linear-gradient(135deg, var(--green-soft), var(--green-medium)); color: var(--bg-dark); }
        .btn-primary:hover { box-shadow: var(--shadow-neon-green); transform: translateY(-2px); }
        .btn-secondary { background: var(--bg-card); color: var(--lilac-soft); border: 1px solid var(--border-lilac); }
        .btn-secondary:hover { background: var(--bg-card-hover); box-shadow: var(--shadow-neon-lilac); }
        .btn-ghost { background: transparent; color: var(--text-secondary); padding: 0.5rem 0.7rem; }
        .btn-ghost:hover { color: var(--green-soft); background: var(--green-subtle); }
        .btn-cyan { background: linear-gradient(135deg, var(--cyan), #4fc3b0); color: var(--bg-dark); }
        .btn-cyan:hover { box-shadow: var(--shadow-neon-cyan); transform: translateY(-2px); }
        .main-container { position: relative; z-index: 1; padding-top: 56px; min-height: 100vh; }
        .nav-tabs { position: sticky; top: 56px; z-index: 100; background: rgba(10, 10, 15, 0.98); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border-color); overflow-x: auto; -webkit-overflow-scrolling: touch; scrollbar-width: none; }
        .nav-tabs::-webkit-scrollbar { display: none; }
        .nav-tabs-inner { display: flex; gap: 0; padding: 0 0.5rem; min-width: max-content; }
        .nav-tab { font-family: 'Quicksand', sans-serif; font-weight: 600; padding: 0.75rem 1rem; background: none; border: none; color: var(--text-secondary); cursor: pointer; transition: all var(--transition-fast); position: relative; white-space: nowrap; font-size: 0.8rem; }
        .nav-tab::after { content: ''; position: absolute; bottom: 0; left: 50%; width: 0; height: 3px; background: linear-gradient(90deg, var(--green-soft), var(--lilac-soft)); border-radius: 3px 3px 0 0; transition: all var(--transition-med); transform: translateX(-50%); }
        .nav-tab:hover { color: var(--text-primary); }
        .nav-tab:hover::after { width: 20px; }
        .nav-tab.active { color: var(--green-soft); }
        .nav-tab.active::after { width: 100%; box-shadow: 0 0 10px var(--green-glow); }
        .nav-tab.highlight { color: var(--cyan); }
        .nav-tab.highlight.active { color: var(--cyan); }
        .nav-tab.highlight.active::after { background: linear-gradient(90deg, var(--cyan), var(--lilac-soft)); }
        .section { display: none; padding: 1.5rem 1rem; max-width: 1400px; margin: 0 auto; animation: fadeIn 0.4s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .section-header { margin-bottom: 1.5rem; text-align: center; }
        .section-title { font-family: 'Orbitron', monospace; font-size: 1.6rem; font-weight: 700; margin-bottom: 0.5rem; background: linear-gradient(135deg, var(--green-soft), var(--lilac-soft)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .section-subtitle { color: var(--text-secondary); font-size: 0.9rem; max-width: 600px; margin: 0 auto; }
        .card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: var(--radius-lg); padding: 1.25rem; margin-bottom: 1.25rem; transition: all var(--transition-med); position: relative; overflow: hidden; }
        .card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, var(--green-soft), var(--lilac-soft)); opacity: 0; transition: opacity var(--transition-med); }
        .card:hover { border-color: var(--green-soft); transform: translateY(-3px); box-shadow: var(--shadow-neon-green); }
        .card:hover::before { opacity: 1; }
        .card-header { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem; cursor: pointer; }
        .card-number { font-family: 'Orbitron', monospace; font-size: 0.7rem; font-weight: 700; width: 28px; height: 28px; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, var(--green-soft), var(--lilac-soft)); color: var(--bg-dark); border-radius: var(--radius-sm); flex-shrink: 0; }
        .card-title { font-family: 'Orbitron', monospace; font-size: 0.95rem; font-weight: 600; color: var(--text-primary); flex: 1; }
        .card-toggle { width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; color: var(--text-secondary); transition: transform var(--transition-med); font-size: 0.7rem; }
        .card.expanded .card-toggle { transform: rotate(180deg); }
        .card-content { display: none; padding-top: 0.75rem; border-top: 1px solid var(--border-color); }
        .card.expanded .card-content { display: block; animation: slideDown 0.3s ease; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .card-description { color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.85rem; }
        .form-group { margin-bottom: 1rem; }
        .form-label { display: block; font-weight: 600; color: var(--text-primary); margin-bottom: 0.4rem; font-size: 0.85rem; }
        .form-input, .form-textarea, .form-select { width: 100%; padding: 0.75rem; background: var(--bg-input); border: 1px solid var(--border-color); border-radius: var(--radius-sm); color: var(--text-primary); font-family: 'Quicksand', sans-serif; font-size: 0.9rem; transition: all var(--transition-fast); }
        .form-input:focus, .form-textarea:focus, .form-select:focus { outline: none; border-color: var(--green-soft); box-shadow: 0 0 0 3px var(--green-subtle); }
        .form-textarea { min-height: 100px; resize: vertical; }
        .grid-2 { display: grid; grid-template-columns: 1fr; gap: 1rem; }
        .grid-3 { display: grid; grid-template-columns: 1fr; gap: 1rem; }
        .grid-4 { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; }
        @media (min-width: 640px) { .grid-2 { grid-template-columns: 1fr 1fr; } .grid-4 { grid-template-columns: repeat(4, 1fr); } }
        @media (min-width: 768px) { .grid-3 { grid-template-columns: repeat(3, 1fr); } }
        .swot-grid { display: grid; grid-template-columns: 1fr; gap: 0.75rem; }
        @media (min-width: 640px) { .swot-grid { grid-template-columns: 1fr 1fr; } }
        .swot-cell { background: var(--bg-input); border-radius: var(--radius-md); padding: 1rem; border: 1px solid var(--border-color); }
        .swot-cell.strengths { border-color: var(--green-soft); }
        .swot-cell.weaknesses { border-color: var(--lilac-soft); }
        .swot-cell.opportunities { border-color: var(--cyan); }
        .swot-cell.threats { border-color: var(--red); }
        .swot-label { font-family: 'Orbitron', monospace; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 0.5rem; }
        .swot-cell.strengths .swot-label { color: var(--green-soft); }
        .swot-cell.weaknesses .swot-label { color: var(--lilac-soft); }
        .swot-cell.opportunities .swot-label { color: var(--cyan); }
        .swot-cell.threats .swot-label { color: var(--red); }
        .power-map-container { background: var(--bg-input); border: 1px solid var(--border-color); border-radius: var(--radius-md); padding: 1rem; margin: 1rem 0; }
        .power-map { position: relative; width: 100%; aspect-ratio: 1.5; max-height: 400px; background: linear-gradient(135deg, rgba(127,255,127,0.03), rgba(200,182,255,0.03)); border-radius: var(--radius-sm); overflow: hidden; }
        .power-map-axis { position: absolute; background: var(--border-color); }
        .power-map-axis.horizontal { left: 10%; right: 10%; top: 50%; height: 1px; }
        .power-map-axis.vertical { top: 10%; bottom: 10%; left: 50%; width: 1px; }
        .power-map-label { position: absolute; font-size: 0.65rem; color: var(--text-muted); font-weight: 600; }
        .power-map-label.top { top: 2%; left: 50%; transform: translateX(-50%); }
        .power-map-label.bottom { bottom: 2%; left: 50%; transform: translateX(-50%); }
        .power-map-label.left { left: 2%; top: 50%; writing-mode: vertical-rl; transform: translateY(-50%) rotate(180deg); }
        .power-map-label.right { right: 2%; top: 50%; writing-mode: vertical-rl; transform: translateY(-50%); }
        .power-map-quadrant { position: absolute; font-size: 0.6rem; color: var(--text-muted); opacity: 0.6; }
        .power-map-quadrant.q1 { top: 15%; right: 15%; color: var(--green-soft); }
        .power-map-quadrant.q2 { top: 15%; left: 15%; color: var(--orange); }
        .power-map-quadrant.q3 { bottom: 15%; left: 15%; }
        .power-map-quadrant.q4 { bottom: 15%; right: 15%; color: var(--lilac-soft); }
        .power-actor { position: absolute; min-width: 60px; padding: 4px 8px; background: var(--bg-card); border: 2px solid var(--green-soft); border-radius: 20px; font-size: 0.65rem; font-weight: 600; color: var(--text-primary); cursor: move; transform: translate(-50%, -50%); transition: box-shadow var(--transition-fast); text-align: center; white-space: nowrap; z-index: 10; user-select: none; }
        .power-actor:hover { box-shadow: var(--shadow-neon-green); }
        .power-actor.ally { border-color: var(--green-soft); }
        .power-actor.neutral { border-color: var(--orange); }
        .power-actor.opponent { border-color: var(--red); }
        .quick-stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.75rem; margin-bottom: 1.5rem; }
        @media (min-width: 640px) { .quick-stats { grid-template-columns: repeat(4, 1fr); } }
        .stat-card { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: var(--radius-md); padding: 1rem; text-align: center; transition: all var(--transition-med); }
        .stat-card:hover { border-color: var(--green-soft); box-shadow: var(--shadow-neon-green); transform: translateY(-3px); }
        .stat-value { font-family: 'Orbitron', monospace; font-size: 1.5rem; font-weight: 700; background: linear-gradient(135deg, var(--green-soft), var(--lilac-soft)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .stat-label { font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem; }
        .progress-container { margin-bottom: 1rem; }
        .progress-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.4rem; }
        .progress-label { font-size: 0.8rem; color: var(--text-secondary); }
        .progress-value { font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: var(--green-soft); }
        .progress-bar { height: 6px; background: var(--bg-input); border-radius: 3px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, var(--green-soft), var(--lilac-soft)); border-radius: 3px; transition: width var(--transition-med); }
        .timeline { position: relative; padding-left: 1.5rem; }
        .timeline::before { content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 2px; background: linear-gradient(to bottom, var(--green-soft), var(--lilac-soft)); }
        .timeline-item { position: relative; padding-bottom: 1rem; }
        .timeline-item::before { content: ''; position: absolute; left: -1.5rem; top: 0.2rem; width: 10px; height: 10px; background: var(--green-soft); border-radius: 50%; transform: translateX(-50%); }
        .timeline-date { font-family: 'JetBrains Mono', monospace; font-size: 0.65rem; color: var(--lilac-soft); }
        .timeline-content { background: var(--bg-input); padding: 0.75rem; border-radius: var(--radius-sm); border: 1px solid var(--border-color); font-size: 0.85rem; margin-top: 0.25rem; }
        .veille-grid { display: grid; grid-template-columns: 1fr; gap: 1rem; }
        @media (min-width: 768px) { .veille-grid { grid-template-columns: 2fr 1fr; } }
        .veille-feed { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: var(--radius-lg); padding: 1rem; max-height: 400px; overflow-y: auto; }
        .veille-item { padding: 0.75rem; border-bottom: 1px solid var(--border-color); transition: background var(--transition-fast); }
        .veille-item:last-child { border-bottom: none; }
        .veille-item:hover { background: var(--bg-input); }
        .veille-item-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.25rem; }
        .veille-item-title { font-weight: 600; font-size: 0.85rem; color: var(--text-primary); }
        .veille-item-date { font-size: 0.65rem; color: var(--text-muted); font-family: 'JetBrains Mono', monospace; }
        .veille-item-content { font-size: 0.8rem; color: var(--text-secondary); }
        .veille-item-tags { margin-top: 0.5rem; display: flex; flex-wrap: wrap; gap: 0.25rem; }
        .veille-tag { font-size: 0.6rem; padding: 2px 6px; background: var(--green-subtle); color: var(--green-soft); border-radius: 10px; }
        .checklist-item { display: flex; align-items: flex-start; gap: 0.6rem; padding: 0.6rem 0; border-bottom: 1px solid var(--border-color); }
        .checklist-item:last-child { border-bottom: none; }
        .checkbox { width: 20px; height: 20px; border: 2px solid var(--border-color); border-radius: 5px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all var(--transition-fast); flex-shrink: 0; margin-top: 2px; }
        .checkbox:hover { border-color: var(--green-soft); }
        .checkbox.checked { background: linear-gradient(135deg, var(--green-soft), var(--green-medium)); border-color: var(--green-soft); }
        .checkbox.checked::after { content: '‚úì'; color: var(--bg-dark); font-weight: 700; font-size: 0.75rem; }
        .checklist-text { flex: 1; color: var(--text-secondary); font-size: 0.85rem; }
        .checklist-item.completed .checklist-text { color: var(--text-muted); text-decoration: line-through; }
        .modal-overlay { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(10px); z-index: 2000; display: none; align-items: center; justify-content: center; padding: 1rem; }
        .modal-overlay.active { display: flex; }
        .modal { background: var(--bg-card); border: 1px solid var(--border-color); border-radius: var(--radius-lg); max-width: 900px; width: 100%; max-height: 90vh; overflow-y: auto; animation: modalIn 0.3s ease; }
        @keyframes modalIn { from { opacity: 0; transform: scale(0.95) translateY(20px); } to { opacity: 1; transform: scale(1) translateY(0); } }
        .modal-header { display: flex; align-items: center; justify-content: space-between; padding: 1.25rem; border-bottom: 1px solid var(--border-color); }
        .modal-title { font-family: 'Orbitron', monospace; font-size: 1.1rem; font-weight: 700; background: linear-gradient(135deg, var(--green-soft), var(--lilac-soft)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .modal-close { background: none; border: none; color: var(--text-secondary); font-size: 1.5rem; cursor: pointer; padding: 0.25rem; line-height: 1; transition: color var(--transition-fast); }
        .modal-close:hover { color: var(--red); }
        .modal-body { padding: 1.5rem; }
        .export-section { margin-bottom: 2rem; }
        .export-section-title { font-family: 'Orbitron', monospace; font-size: 0.85rem; font-weight: 600; color: var(--cyan); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem; }
        .export-section-title::after { content: ''; flex: 1; height: 1px; background: var(--border-color); }
        .export-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 0.75rem; }
        .export-card { background: var(--bg-input); border: 1px solid var(--border-color); border-radius: var(--radius-md); padding: 1rem; text-align: center; cursor: pointer; transition: all var(--transition-med); }
        .export-card:hover { border-color: var(--green-soft); box-shadow: var(--shadow-neon-green); transform: translateY(-3px); }
        .export-card.protocol { border-color: var(--cyan); }
        .export-card.protocol:hover { box-shadow: var(--shadow-neon-cyan); }
        .export-card-icon { font-size: 2rem; margin-bottom: 0.5rem; }
        .export-card-name { font-family: 'Orbitron', monospace; font-size: 0.8rem; font-weight: 700; color: var(--text-primary); margin-bottom: 0.25rem; }
        .export-card-desc { font-size: 0.65rem; color: var(--text-muted); }
        .dropzone { border: 2px dashed var(--border-color); border-radius: var(--radius-lg); padding: 2rem; text-align: center; transition: all var(--transition-med); cursor: pointer; }
        .dropzone:hover, .dropzone.dragover { border-color: var(--green-soft); background: var(--green-subtle); }
        .dropzone-icon { font-size: 2.5rem; margin-bottom: 0.75rem; color: var(--text-muted); }
        .dropzone-text { color: var(--text-secondary); margin-bottom: 0.3rem; }
        .dropzone-hint { font-size: 0.75rem; color: var(--text-muted); }
        .toast-container { position: fixed; bottom: 1rem; right: 1rem; z-index: 3000; display: flex; flex-direction: column; gap: 0.5rem; }
        .toast { background: var(--bg-card); border: 1px solid var(--green-soft); border-radius: var(--radius-sm); padding: 0.75rem 1rem; display: flex; align-items: center; gap: 0.5rem; box-shadow: var(--shadow-neon-green); animation: slideInRight 0.3s ease; min-width: 280px; font-size: 0.85rem; }
        .toast.error { border-color: var(--red); }
        .toast.info { border-color: var(--cyan); }
        @keyframes slideInRight { from { opacity: 0; transform: translateX(100px); } to { opacity: 1; transform: translateX(0); } }
        .badge { display: inline-flex; align-items: center; gap: 0.25rem; padding: 0.15rem 0.5rem; background: linear-gradient(135deg, var(--cyan), var(--lilac-soft)); color: var(--bg-dark); font-size: 0.6rem; font-weight: 700; border-radius: 10px; margin-left: 0.5rem; }
        .preview-panel { background: var(--bg-input); border: 1px solid var(--border-color); border-radius: var(--radius-md); padding: 1rem; max-height: 300px; overflow-y: auto; font-family: 'JetBrains Mono', monospace; font-size: 0.75rem; color: var(--text-secondary); white-space: pre-wrap; word-break: break-all; }
        .protocol-info { background: var(--cyan-subtle); border: 1px solid var(--cyan); border-radius: var(--radius-md); padding: 1rem; margin-top: 1rem; }
        .protocol-info-title { font-family: 'Orbitron', monospace; font-size: 0.8rem; font-weight: 700; color: var(--cyan); margin-bottom: 0.5rem; }
        .protocol-info-text { font-size: 0.8rem; color: var(--text-secondary); }
        .ic-cycle { display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem; margin: 1.5rem 0; }
        .ic-step { flex: 1; min-width: 140px; max-width: 200px; background: var(--bg-input); border: 1px solid var(--border-color); border-radius: var(--radius-md); padding: 1rem; text-align: center; transition: all var(--transition-med); }
        .ic-step:hover { border-color: var(--cyan); box-shadow: var(--shadow-neon-cyan); transform: translateY(-5px); }
        .ic-step-icon { font-size: 2rem; margin-bottom: 0.5rem; }
        .ic-step-title { font-family: 'Orbitron', monospace; font-size: 0.75rem; font-weight: 700; color: var(--cyan); margin-bottom: 0.25rem; }
        .ic-step-desc { font-size: 0.7rem; color: var(--text-muted); }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--green-soft); }
        @media print { .header, .nav-tabs, .btn, .bg-effects, .modal-overlay { display: none !important; } .main-container { padding-top: 0; } .section { display: block !important; page-break-after: always; } body { background: white; color: black; } }
        @media (max-width: 640px) { .header-actions .btn span:not(:first-child) { display: none; } .section-title { font-size: 1.25rem; } .export-grid { grid-template-columns: repeat(2, 1fr); } }
    </style>
</head>
<body>
    <div class="bg-effects"><div class="grid-overlay"></div><div class="bg-gradient bg-gradient-1"></div><div class="bg-gradient bg-gradient-2"></div><div class="bg-gradient bg-gradient-3"></div></div>
    <header class="header"><div class="header-content"><div class="logo"><div class="logo-icon">‚ö°</div><span class="logo-text">Plaidoyer Citoyen</span><span class="logo-version">3.0</span></div><div class="header-actions"><button class="btn btn-ghost" onclick="openModal('import-modal')" title="Importer">üì•</button><button class="btn btn-ghost" onclick="openModal('export-modal')" title="Exporter">üì§</button><button class="btn btn-primary" onclick="saveProject()"><span>üíæ</span><span>Sauver</span></button></div></div></header>
    <nav class="nav-tabs"><div class="nav-tabs-inner"><button class="nav-tab active" data-section="accueil">üè† Accueil</button><button class="nav-tab" data-section="voir">üëÅÔ∏è Voir</button><button class="nav-tab" data-section="juger">‚öñÔ∏è Juger</button><button class="nav-tab" data-section="agir">üöÄ Agir</button><button class="nav-tab highlight" data-section="intelligence">üß† Intelligence</button><button class="nav-tab highlight" data-section="veille">üì° Veille</button><button class="nav-tab" data-section="suivi">üìä Dashboard</button><button class="nav-tab" data-section="export">üì¶ Export <span class="badge">PRO</span></button></div></nav>
    <main class="main-container">
        <section id="accueil" class="section active">
            <div class="section-header" style="padding: 2rem 0;"><h1 class="section-title" style="font-size: 2rem;">Plaidoyer Citoyen 3.0</h1><p class="section-subtitle">Poste de Travail Citoyen ‚Ä¢ Export Multi-Formats ‚Ä¢ Protocoles FHIR & RSS</p></div>
            <div class="quick-stats"><div class="stat-card"><div class="stat-value" id="stat-tools">20+</div><div class="stat-label">Outils</div></div><div class="stat-card"><div class="stat-value" id="stat-progress">0%</div><div class="stat-label">Progression</div></div><div class="stat-card"><div class="stat-value" id="stat-actors">0</div><div class="stat-label">Acteurs</div></div><div class="stat-card"><div class="stat-value" id="stat-veille">0</div><div class="stat-label">Signalements</div></div></div>
            <div style="text-align: center; margin-bottom: 2rem;"><button class="btn btn-primary" onclick="switchSection('voir')" style="margin: 0.25rem;">üöÄ Commencer</button><button class="btn btn-secondary" onclick="switchSection('intelligence')" style="margin: 0.25rem;">üß† Intelligence Civile</button><button class="btn btn-cyan" onclick="switchSection('export')" style="margin: 0.25rem;">üì¶ Export Pro <span class="badge">NEW</span></button></div>
            <div class="grid-3" style="margin-bottom: 2rem;"><div class="card" style="border-color: var(--green-soft);"><h3 style="color: var(--green-soft); font-family: 'Orbitron', monospace; margin-bottom: 0.5rem;">üëÅÔ∏è VOIR</h3><p style="color: var(--text-secondary); font-size: 0.85rem; margin-bottom: 0.5rem;">Observer et comprendre la situation</p><p style="color: var(--text-muted); font-size: 0.75rem;">Domino ‚Ä¢ Fleur du Pouvoir ‚Ä¢ Analyse Genre</p></div><div class="card" style="border-color: var(--lilac-soft);"><h3 style="color: var(--lilac-soft); font-family: 'Orbitron', monospace; margin-bottom: 0.5rem;">‚öñÔ∏è JUGER</h3><p style="color: var(--text-secondary); font-size: 0.85rem; margin-bottom: 0.5rem;">Analyser et √©valuer les enjeux</p><p style="color: var(--text-muted); font-size: 0.75rem;">SWOT ‚Ä¢ Arbre √† probl√®mes ‚Ä¢ 5 Pourquoi</p></div><div class="card" style="border-color: var(--cyan);"><h3 style="color: var(--cyan); font-family: 'Orbitron', monospace; margin-bottom: 0.5rem;">üöÄ AGIR</h3><p style="color: var(--text-secondary); font-size: 0.85rem; margin-bottom: 0.5rem;">Planifier et mettre en ≈ìuvre</p><p style="color: var(--text-muted); font-size: 0.75rem;">SMART ‚Ä¢ Power Map ‚Ä¢ Message Cl√©</p></div></div>
            <div class="card" style="border-color: var(--cyan);"><h3 style="color: var(--cyan); font-family: 'Orbitron', monospace; margin-bottom: 1rem;">üÜï Nouveaut√©s v3.0</h3><div class="grid-2"><div><h4 style="color: var(--green-soft); font-size: 0.9rem; margin-bottom: 0.5rem;">üìÑ Export Multi-Formats</h4><ul style="color: var(--text-secondary); font-size: 0.8rem; list-style: none;"><li>‚Ä¢ PDF professionnel (jsPDF)</li><li>‚Ä¢ Word DOCX (docx.js)</li><li>‚Ä¢ PowerPoint PPTX</li><li>‚Ä¢ JSON / Markdown / HTML</li></ul></div><div><h4 style="color: var(--lilac-soft); font-size: 0.9rem; margin-bottom: 0.5rem;">üîó Protocoles Interop√©rabilit√©</h4><ul style="color: var(--text-secondary); font-size: 0.8rem; list-style: none;"><li>‚Ä¢ FHIR R4 (sant√©/social)</li><li>‚Ä¢ RSS 2.0 / Atom (veille)</li><li>‚Ä¢ JSON-LD (m√©tadonn√©es)</li><li>‚Ä¢ CSV (donn√©es tabulaires)</li></ul></div></div></div>
        </section>
        <section id="voir" class="section">
            <div class="section-header"><h2 class="section-title">üëÅÔ∏è Phase VOIR</h2><p class="section-subtitle">Observer et comprendre la r√©alit√© sociale</p></div>
            <div class="card expanded"><div class="card-header" onclick="toggleCard(this.parentElement)"><div class="card-number">01</div><h3 class="card-title">Le Domino ‚Äî Notre Identit√©</h3><div class="card-toggle">‚ñº</div></div><div class="card-content"><p class="card-description">D√©finir qui nous sommes et pourquoi nous agissons.</p><div class="form-group"><label class="form-label">Pourquoi existons-nous ?</label><textarea class="form-textarea" data-field="domino_pourquoi" placeholder="Notre raison d'√™tre..."></textarea></div><div class="form-group"><label class="form-label">Nos valeurs fondamentales</label><textarea class="form-textarea" data-field="domino_valeurs" placeholder="Les principes qui nous guident..."></textarea></div><div class="form-group"><label class="form-label">Changements recherch√©s</label><textarea class="form-textarea" data-field="domino_changements" placeholder="Ce que nous voulons transformer..."></textarea></div></div></div>
            <div class="card"><div class="card-header" onclick="toggleCard(this.parentElement)"><div class="card-number">02</div><h3 class="card-title">Fleur du Pouvoir ‚Äî Analyse Genre</h3><div class="card-toggle">‚ñº</div></div><div class="card-content"><p class="card-description">Analyser les rapports de pouvoir selon le genre.</p><div class="grid-2"><div class="form-group"><label class="form-label">Pouvoir SUR (domination)</label><textarea class="form-textarea" data-field="fleur_sur" placeholder="Formes de domination observ√©es..."></textarea></div><div class="form-group"><label class="form-label">Pouvoir DE (capacit√©)</label><textarea class="form-textarea" data-field="fleur_de" placeholder="Capacit√©s et comp√©tences..."></textarea></div><div class="form-group"><label class="form-label">Pouvoir AVEC (collectif)</label><textarea class="form-textarea" data-field="fleur_avec" placeholder="Forces collectives..."></textarea></div><div class="form-group"><label class="form-label">Pouvoir INT√âRIEUR</label><textarea class="form-textarea" data-field="fleur_interieur" placeholder="Confiance, estime de soi..."></textarea></div></div></div></div>
            <div class="card"><div class="card-header" onclick="toggleCard(this.parentElement)"><div class="card-number">03</div><h3 class="card-title">Analyse du Contexte</h3><div class="card-toggle">‚ñº</div></div><div class="card-content"><p class="card-description">Cartographier l'environnement politique, √©conomique et social.</p><div class="grid-2"><div class="form-group"><label class="form-label">Contexte politique</label><textarea class="form-textarea" data-field="contexte_politique" placeholder="Situation politique actuelle..."></textarea></div><div class="form-group"><label class="form-label">Contexte √©conomique</label><textarea class="form-textarea" data-field="contexte_economique" placeholder="Situation √©conomique..."></textarea></div><div class="form-group"><label class="form-label">Contexte social</label><textarea class="form-textarea" data-field="contexte_social" placeholder="Dynamiques sociales..."></textarea></div><div class="form-group"><label class="form-label">Opportunit√©s identifi√©es</label><textarea class="form-textarea" data-field="contexte_opportunites" placeholder="Fen√™tres d'opportunit√©..."></textarea></div></div></div></div>
        </section>
        <section id="juger" class="section">
            <div class="section-header"><h2 class="section-title">‚öñÔ∏è Phase JUGER</h2><p class="section-subtitle">Analyser et prioriser les enjeux</p></div>
            <div class="card expanded"><div class="card-header" onclick="toggleCard(this.parentElement)"><div class="card-number">04</div><h3 class="card-title">Analyse SWOT</h3><div class="card-toggle">‚ñº</div></div><div class="card-content"><p class="card-description">Forces, Faiblesses, Opportunit√©s, Menaces.</p><div class="swot-grid"><div class="swot-cell strengths"><div class="swot-label">üí™ Forces</div><textarea class="form-textarea" data-field="swot_forces" placeholder="Nos atouts internes..."></textarea></div><div class="swot-cell weaknesses"><div class="swot-label">‚ö†Ô∏è Faiblesses</div><textarea class="form-textarea" data-field="swot_faiblesses" placeholder="Nos limites internes..."></textarea></div><div class="swot-cell opportunities"><div class="swot-label">üéØ Opportunit√©s</div><textarea class="form-textarea" data-field="swot_opportunites" placeholder="Facteurs externes favorables..."></textarea></div><div class="swot-cell threats"><div class="swot-label">üö® Menaces</div><textarea class="form-textarea" data-field="swot_menaces" placeholder="Risques externes..."></textarea></div></div></div></div>
            <div class="card"><div class="card-header" onclick="toggleCard(this.parentElement)"><div class="card-number">05</div><h3 class="card-title">Arbre √† Probl√®mes</h3><div class="card-toggle">‚ñº</div></div><div class="card-content"><p class="card-description">Identifier causes et cons√©quences du probl√®me central.</p><div class="form-group"><label class="form-label">üå≥ Probl√®me central</label><input type="text" class="form-input" data-field="arbre_probleme" placeholder="Le probl√®me principal..."></div><div class="grid-2"><div class="form-group"><label class="form-label">üîª Causes profondes (racines)</label><textarea class="form-textarea" data-field="arbre_causes" placeholder="Causes structurelles..."></textarea></div><div class="form-group"><label class="form-label">üî∫ Cons√©quences (branches)</label><textarea class="form-textarea" data-field="arbre_consequences" placeholder="Effets observ√©s..."></textarea></div></div></div></div>
            <div class="card"><div class="card-header" onclick="toggleCard(this.parentElement)"><div class="card-number">06</div><h3 class="card-title">Les 5 Pourquoi</h3><div class="card-toggle">‚ñº</div></div><div class="card-content"><p class="card-description">Remonter aux causes racines par questionnement it√©ratif.</p><div class="form-group"><label class="form-label">1. Pourquoi ce probl√®me existe-t-il ?</label><input type="text" class="form-input" data-field="pourquoi_1" placeholder="Premi√®re r√©ponse..."></div><div class="form-group"><label class="form-label">2. Pourquoi ?</label><input type="text" class="form-input" data-field="pourquoi_2" placeholder="Deuxi√®me niveau..."></div><div class="form-group"><label class="form-label">3. Pourquoi ?</label><input type="text" class="form-input" data-field="pourquoi_3" placeholder="Troisi√®me niveau..."></div><div class="form-group"><label class="form-label">4. Pourquoi ?</label><input type="text" class="form-input" data-field="pourquoi_4" placeholder="Quatri√®me niveau..."></div><div class="form-group"><label class="form-label">5. Pourquoi ? (cause racine)</label><input type="text" class="form-input" data-field="pourquoi_5" placeholder="Cause racine identifi√©e..."></div></div></div>
            <div class="card"><div class="card-header" onclick="toggleCard(this.parentElement)"><div class="card-number">07</div><h3 class="card-title">Th√©orie du Changement</h3><div class="card-toggle">‚ñº</div></div><div class="card-content"><p class="card-description">D√©finir la logique d'intervention vers l'impact souhait√©.</p><div class="form-group"><label class="form-label">Vision √† long terme</label><textarea class="form-textarea" data-field="toc_vision" placeholder="Le monde que nous voulons voir..."></textarea></div><div class="form-group"><label class="form-label">Changements interm√©diaires n√©cessaires</label><textarea class="form-textarea" data-field="toc_intermediaires" placeholder="√âtapes vers la vision..."></textarea></div><div class="form-group"><label class="form-label">Hypoth√®ses et conditions</label><textarea class="form-textarea" data-field="toc_hypotheses" placeholder="Ce qui doit √™tre vrai..."></textarea></div></div></div>
        </section>
        <section id="agir" class="section">
            <div class="section-header"><h2 class="section-title">üöÄ Phase AGIR</h2><p class="section-subtitle">Planifier et mettre en ≈ìuvre le plaidoyer</p></div>
            <div class="card expanded"><div class="card-header" onclick="toggleCard(this.parentElement)"><div class="card-number">08</div><h3 class="card-title">Objectifs SMART</h3><div class="card-toggle">‚ñº</div></div><div class="card-content"><p class="card-description">Sp√©cifique, Mesurable, Atteignable, R√©aliste, Temporel.</p><div class="form-group"><label class="form-label">Objectif principal</label><textarea class="form-textarea" data-field="smart_objectif" placeholder="D'ici [date], nous voulons que [cible] fasse [action]..."></textarea></div><div class="grid-2"><div class="form-group"><label class="form-label">Indicateurs de succ√®s</label><textarea class="form-textarea" data-field="smart_indicateurs" placeholder="Comment mesurer le succ√®s..."></textarea></div><div class="form-group"><label class="form-label">√âch√©ance</label><input type="date" class="form-input" data-field="smart_echeance"></div></div></div></div>
            <div class="card"><div class="card-header" onclick="toggleCard(this.parentElement)"><div class="card-number">09</div><h3 class="card-title">Identification des Cibles</h3><div class="card-toggle">‚ñº</div></div><div class="card-content"><p class="card-description">Qui peut r√©ellement changer les choses ?</p><div class="grid-2"><div class="form-group"><label class="form-label">üéØ Cible principale (d√©cideur)</label><input type="text" class="form-input" data-field="cible_principale" placeholder="Qui a le pouvoir de d√©cider..."></div><div class="form-group"><label class="form-label">üéØ Cibles secondaires</label><input type="text" class="form-input" data-field="cible_secondaires" placeholder="Qui peut influencer le d√©cideur..."></div></div><div class="form-group"><label class="form-label">Analyse des motivations</label><textarea class="form-textarea" data-field="cible_motivations" placeholder="Qu'est-ce qui motive nos cibles ?"></textarea></div></div></div>
            <div class="card"><div class="card-header" onclick="toggleCard(this.parentElement)"><div class="card-number">10</div><h3 class="card-title">Power Mapping ‚Äî Carte des Acteurs</h3><div class="card-toggle">‚ñº</div></div><div class="card-content"><p class="card-description">Cartographier les acteurs selon leur pouvoir et position.</p><div class="grid-3" style="margin-bottom: 1rem;"><input type="text" class="form-input" id="actor-name" placeholder="Nom de l'acteur"><select class="form-select" id="actor-type"><option value="ally">üü¢ Alli√©</option><option value="neutral">üü° Neutre</option><option value="opponent">üî¥ Opposant</option></select><button class="btn btn-primary" onclick="addActor()">+ Ajouter</button></div><div class="power-map-container"><div class="power-map" id="power-map"><div class="power-map-axis horizontal"></div><div class="power-map-axis vertical"></div><div class="power-map-label top">POUVOIR √âLEV√â</div><div class="power-map-label bottom">POUVOIR FAIBLE</div><div class="power-map-label left">OPPOS√â</div><div class="power-map-label right">FAVORABLE</div><div class="power-map-quadrant q1">Engager</div><div class="power-map-quadrant q2">Surveiller</div><div class="power-map-quadrant q3">Informer</div><div class="power-map-quadrant q4">Mobiliser</div></div></div></div></div>
            <div class="card"><div class="card-header" onclick="toggleCard(this.parentElement)"><div class="card-number">11</div><h3 class="card-title">Construction du Message</h3><div class="card-toggle">‚ñº</div></div><div class="card-content"><p class="card-description">√âlaborer un message percutant et mobilisateur.</p><div class="grid-2"><div class="form-group"><label class="form-label">üé£ Accroche</label><input type="text" class="form-input" data-field="msg_accroche" placeholder="Phrase d'accroche percutante..."></div><div class="form-group"><label class="form-label">üò§ Le probl√®me</label><textarea class="form-textarea" data-field="msg_probleme" placeholder="Description du probl√®me..."></textarea></div><div class="form-group"><label class="form-label">üí° Pourquoi c'est important</label><textarea class="form-textarea" data-field="msg_importance" placeholder="Enjeux et cons√©quences..."></textarea></div><div class="form-group"><label class="form-label">‚úä Appel √† l'action</label><textarea class="form-textarea" data-field="msg_action" placeholder="Ce que nous demandons concr√®tement..."></textarea></div></div><button class="btn btn-secondary" onclick="generateMessage()" style="margin-top: 1rem;">üîÑ G√©n√©rer le message complet</button><div id="generated-message" style="display: none; margin-top: 1rem;"></div></div></div>
        </section>
        <section id="intelligence" class="section">
            <div class="section-header"><h2 class="section-title">üß† Intelligence Civile</h2><p class="section-subtitle">Collecter, analyser et exploiter l'information strat√©gique</p></div>
            <div class="ic-cycle"><div class="ic-step"><div class="ic-step-icon">üéØ</div><div class="ic-step-title">ORIENTATION</div><div class="ic-step-desc">D√©finir les besoins</div></div><div class="ic-step"><div class="ic-step-icon">üì°</div><div class="ic-step-title">COLLECTE</div><div class="ic-step-desc">Rassembler les donn√©es</div></div><div class="ic-step"><div class="ic-step-icon">üî¨</div><div class="ic-step-title">ANALYSE</div><div class="ic-step-desc">Interpr√©ter et croiser</div></div><div class="ic-step"><div class="ic-step-icon">üìä</div><div class="ic-step-title">DIFFUSION</div><div class="ic-step-desc">Partager les r√©sultats</div></div></div>
            <div class="card expanded"><div class="card-header" onclick="toggleCard(this.parentElement)"><div class="card-number">IC</div><h3 class="card-title">Configuration Intelligence Civile</h3><div class="card-toggle">‚ñº</div></div><div class="card-content"><div class="form-group"><label class="form-label">Th√®mes de veille prioritaires</label><textarea class="form-textarea" data-field="ic_themes" placeholder="Ex: Budget social, L√©gislation environnement, Droits num√©riques..."></textarea></div><div class="form-group"><label class="form-label">Sources d'information cl√©s</label><textarea class="form-textarea" data-field="ic_sources" placeholder="Institutions, m√©dias, experts, terrain..."></textarea></div><div class="form-group"><label class="form-label">Analyse du narratif dominant</label><textarea class="form-textarea" data-field="ic_narratif" placeholder="Quel r√©cit est promu ? Par qui ? Quels angles morts ?"></textarea></div><div class="form-group"><label class="form-label">Contre-narratif √† d√©velopper</label><textarea class="form-textarea" data-field="ic_contre_narratif" placeholder="Notre r√©cit alternatif..."></textarea></div></div></div>
        </section>
        <section id="veille" class="section">
            <div class="section-header"><h2 class="section-title">üì° Veille Citoyenne</h2><p class="section-subtitle">Surveiller, collecter et organiser l'information</p></div>
            <div class="veille-grid"><div><div class="card"><h3 style="color: var(--green-soft); margin-bottom: 1rem;">‚ûï Ajouter un signalement</h3><div class="form-group"><input type="text" class="form-input" id="veille-title" placeholder="Titre du signalement"></div><div class="form-group"><textarea class="form-textarea" id="veille-content" placeholder="Description, source, lien..."></textarea></div><div class="form-group"><select class="form-select" id="veille-category"><option value="politique">üèõÔ∏è Politique</option><option value="social">üë• Social</option><option value="environnement">üåç Environnement</option><option value="economie">üí∞ √âconomie</option><option value="droits">‚öñÔ∏è Droits</option><option value="media">üì∞ M√©dia</option></select></div><button class="btn btn-primary" onclick="addVeille()">üì• Enregistrer</button></div><div class="veille-feed" id="veille-feed"><p style="color: var(--text-muted); text-align: center; padding: 2rem;">Aucun signalement pour l'instant.<br>Commencez votre veille citoyenne !</p></div></div><div><div class="card"><h3 style="color: var(--lilac-soft); margin-bottom: 1rem;">üìä Statistiques</h3><div class="stat-card" style="margin-bottom: 0.5rem;"><div class="stat-value" id="veille-total">0</div><div class="stat-label">Total signalements</div></div><div style="margin-top: 1rem;"><div class="progress-container"><div class="progress-header"><span class="progress-label">üèõÔ∏è Politique</span><span class="progress-value" id="veille-politique">0</span></div><div class="progress-bar"><div class="progress-fill" id="veille-politique-fill" style="width: 0%;"></div></div></div><div class="progress-container"><div class="progress-header"><span class="progress-label">üë• Social</span><span class="progress-value" id="veille-social">0</span></div><div class="progress-bar"><div class="progress-fill" id="veille-social-fill" style="width: 0%;"></div></div></div><div class="progress-container"><div class="progress-header"><span class="progress-label">üåç Environnement</span><span class="progress-value" id="veille-env">0</span></div><div class="progress-bar"><div class="progress-fill" id="veille-env-fill" style="width: 0%;"></div></div></div></div></div><div class="card" style="border-color: var(--cyan);"><h3 style="color: var(--cyan); margin-bottom: 0.5rem;">üì° Export RSS</h3><p style="color: var(--text-secondary); font-size: 0.8rem; margin-bottom: 1rem;">Exportez votre veille en flux RSS pour l'int√©grer √† d'autres outils.</p><button class="btn btn-cyan" onclick="exportRSS()">üì° G√©n√©rer flux RSS</button></div></div></div>
        </section>
        <section id="suivi" class="section">
            <div class="section-header"><h2 class="section-title">üìä Dashboard</h2><p class="section-subtitle">Suivre l'avancement de votre plaidoyer</p></div>
            <div class="quick-stats"><div class="stat-card"><div class="stat-value" id="dash-fields">0</div><div class="stat-label">Champs remplis</div></div><div class="stat-card"><div class="stat-value" id="dash-actors">0</div><div class="stat-label">Acteurs mapp√©s</div></div><div class="stat-card"><div class="stat-value" id="dash-veille">0</div><div class="stat-label">Signalements</div></div><div class="stat-card"><div class="stat-value" id="dash-checks">0</div><div class="stat-label">√âtapes valid√©es</div></div></div>
            <div class="card"><h3 style="color: var(--green-soft); margin-bottom: 1rem;">üìà Progression globale</h3><div class="progress-container"><div class="progress-header"><span class="progress-label">Compl√©tude du projet</span><span class="progress-value" id="global-progress">0%</span></div><div class="progress-bar" style="height: 12px;"><div class="progress-fill" id="global-progress-fill" style="width: 0%;"></div></div></div><div class="grid-4" style="margin-top: 1.5rem;"><div class="progress-container"><div class="progress-header"><span class="progress-label">üëÅÔ∏è Voir</span><span class="progress-value" id="prog-voir">0%</span></div><div class="progress-bar"><div class="progress-fill" id="prog-voir-fill" style="width: 0%;"></div></div></div><div class="progress-container"><div class="progress-header"><span class="progress-label">‚öñÔ∏è Juger</span><span class="progress-value" id="prog-juger">0%</span></div><div class="progress-bar"><div class="progress-fill" id="prog-juger-fill" style="width: 0%;"></div></div></div><div class="progress-container"><div class="progress-header"><span class="progress-label">üöÄ Agir</span><span class="progress-value" id="prog-agir">0%</span></div><div class="progress-bar"><div class="progress-fill" id="prog-agir-fill" style="width: 0%;"></div></div></div><div class="progress-container"><div class="progress-header"><span class="progress-label">üß† IC</span><span class="progress-value" id="prog-ic">0%</span></div><div class="progress-bar"><div class="progress-fill" id="prog-ic-fill" style="width: 0%;"></div></div></div></div></div>
            <div class="card"><h3 style="color: var(--lilac-soft); margin-bottom: 1rem;">‚úÖ Checklist Plaidoyer</h3><div id="checklist-container"><div class="checklist-item" data-check="0"><div class="checkbox" onclick="toggleCheck(this)"></div><div class="checklist-text">D√©finir notre identit√© et valeurs (Domino)</div></div><div class="checklist-item" data-check="1"><div class="checkbox" onclick="toggleCheck(this)"></div><div class="checklist-text">Analyser le contexte (politique, social, √©conomique)</div></div><div class="checklist-item" data-check="2"><div class="checkbox" onclick="toggleCheck(this)"></div><div class="checklist-text">R√©aliser l'analyse SWOT</div></div><div class="checklist-item" data-check="3"><div class="checkbox" onclick="toggleCheck(this)"></div><div class="checklist-text">Identifier le probl√®me central et ses causes</div></div><div class="checklist-item" data-check="4"><div class="checkbox" onclick="toggleCheck(this)"></div><div class="checklist-text">Formuler des objectifs SMART</div></div><div class="checklist-item" data-check="5"><div class="checkbox" onclick="toggleCheck(this)"></div><div class="checklist-text">Identifier et analyser les cibles</div></div><div class="checklist-item" data-check="6"><div class="checkbox" onclick="toggleCheck(this)"></div><div class="checklist-text">R√©aliser le power mapping</div></div><div class="checklist-item" data-check="7"><div class="checkbox" onclick="toggleCheck(this)"></div><div class="checklist-text">Construire le message cl√©</div></div><div class="checklist-item" data-check="8"><div class="checkbox" onclick="toggleCheck(this)"></div><div class="checklist-text">Mettre en place la veille citoyenne</div></div><div class="checklist-item" data-check="9"><div class="checkbox" onclick="toggleCheck(this)"></div><div class="checklist-text">Lancer les premi√®res actions</div></div></div></div>
            <div class="card"><h3 style="color: var(--cyan); margin-bottom: 1rem;">üìù Journal de bord</h3><div class="form-group"><textarea class="form-textarea" id="journal-entry" placeholder="Notez vos avanc√©es, r√©flexions, obstacles..."></textarea></div><button class="btn btn-primary" onclick="addJournalEntry()">üìù Ajouter une entr√©e</button><div class="timeline" id="journal-timeline" style="margin-top: 1.5rem;"></div></div>
        </section>
        <section id="export" class="section">
            <div class="section-header"><h2 class="section-title">üì¶ Export Professionnel</h2><p class="section-subtitle">Exportez votre travail dans tous les formats</p></div>
            <div class="export-section"><div class="export-section-title">üìÑ Formats Documents</div><div class="export-grid"><div class="export-card" onclick="exportPDF()"><div class="export-card-icon">üìï</div><div class="export-card-name">PDF</div><div class="export-card-desc">Document professionnel</div></div><div class="export-card" onclick="exportDOCX()"><div class="export-card-icon">üìò</div><div class="export-card-name">DOCX</div><div class="export-card-desc">Microsoft Word</div></div><div class="export-card" onclick="exportPPTX()"><div class="export-card-icon">üìô</div><div class="export-card-name">PPTX</div><div class="export-card-desc">PowerPoint</div></div><div class="export-card" onclick="exportHTML()"><div class="export-card-icon">üåê</div><div class="export-card-name">HTML</div><div class="export-card-desc">Page web autonome</div></div></div></div>
            <div class="export-section"><div class="export-section-title">üíæ Formats Donn√©es</div><div class="export-grid"><div class="export-card" onclick="exportJSON()"><div class="export-card-icon">üìã</div><div class="export-card-name">JSON</div><div class="export-card-desc">Sauvegarde compl√®te</div></div><div class="export-card" onclick="exportMarkdown()"><div class="export-card-icon">üìù</div><div class="export-card-name">Markdown</div><div class="export-card-desc">Texte format√©</div></div><div class="export-card" onclick="exportCSV()"><div class="export-card-icon">üìä</div><div class="export-card-name">CSV</div><div class="export-card-desc">Tableur Excel</div></div><div class="export-card" onclick="exportTXT()"><div class="export-card-icon">üìÉ</div><div class="export-card-name">TXT</div><div class="export-card-desc">Texte brut</div></div></div></div>
            <div class="export-section"><div class="export-section-title">üîó Protocoles d'Interop√©rabilit√©</div><div class="export-grid"><div class="export-card protocol" onclick="exportFHIR()"><div class="export-card-icon">üè•</div><div class="export-card-name">FHIR R4</div><div class="export-card-desc">Sant√© & Social</div></div><div class="export-card protocol" onclick="exportRSS()"><div class="export-card-icon">üì°</div><div class="export-card-name">RSS 2.0</div><div class="export-card-desc">Flux veille</div></div><div class="export-card protocol" onclick="exportAtom()"><div class="export-card-icon">‚öõÔ∏è</div><div class="export-card-name">Atom</div><div class="export-card-desc">Syndication</div></div><div class="export-card protocol" onclick="exportJSONLD()"><div class="export-card-icon">üîó</div><div class="export-card-name">JSON-LD</div><div class="export-card-desc">Web s√©mantique</div></div></div><div class="protocol-info"><div class="protocol-info-title">‚ÑπÔ∏è √Ä propos des protocoles</div><div class="protocol-info-text"><strong>FHIR R4</strong> : Standard HL7 pour l'interop√©rabilit√© des donn√©es de sant√© et sociales.<br><strong>RSS/Atom</strong> : Formats de syndication pour diffuser votre veille citoyenne.<br><strong>JSON-LD</strong> : Donn√©es li√©es pour le web s√©mantique et l'indexation.</div></div></div>
            <div class="card"><h3 style="color: var(--green-soft); margin-bottom: 1rem;">üëÅÔ∏è Pr√©visualisation</h3><div class="grid-2" style="margin-bottom: 1rem;"><select class="form-select" id="preview-format" onchange="updatePreview()"><option value="json">JSON</option><option value="fhir">FHIR R4</option><option value="rss">RSS 2.0</option><option value="jsonld">JSON-LD</option></select><button class="btn btn-secondary" onclick="copyPreview()">üìã Copier</button></div><div class="preview-panel" id="preview-panel">S√©lectionnez un format pour pr√©visualiser...</div></div>
        </section>
    </main>
    <div class="modal-overlay" id="export-modal"><div class="modal"><div class="modal-header"><h3 class="modal-title">üì§ Export Rapide</h3><button class="modal-close" onclick="closeModal('export-modal')">&times;</button></div><div class="modal-body"><div class="export-grid"><div class="export-card" onclick="exportJSON(); closeModal('export-modal');"><div class="export-card-icon">üìã</div><div class="export-card-name">JSON</div></div><div class="export-card" onclick="exportPDF(); closeModal('export-modal');"><div class="export-card-icon">üìï</div><div class="export-card-name">PDF</div></div><div class="export-card" onclick="exportDOCX(); closeModal('export-modal');"><div class="export-card-icon">üìò</div><div class="export-card-name">DOCX</div></div><div class="export-card" onclick="exportMarkdown(); closeModal('export-modal');"><div class="export-card-icon">üìù</div><div class="export-card-name">MD</div></div></div></div></div></div>
    <div class="modal-overlay" id="import-modal"><div class="modal"><div class="modal-header"><h3 class="modal-title">üì• Importer un Projet</h3><button class="modal-close" onclick="closeModal('import-modal')">&times;</button></div><div class="modal-body"><div class="dropzone" ondragover="event.preventDefault(); this.classList.add('dragover');" ondragleave="this.classList.remove('dragover');" ondrop="handleDrop(event)" onclick="document.getElementById('file-input').click();"><div class="dropzone-icon">üìÅ</div><div class="dropzone-text">Glissez votre fichier ici</div><div class="dropzone-hint">ou cliquez pour s√©lectionner (JSON, FHIR, RSS)</div></div><input type="file" id="file-input" accept=".json,.xml,.rss,.atom" style="display: none;" onchange="importFile(event)"></div></div></div>
    <div class="toast-container" id="toast-container"></div>
    <script>
        let data = { meta: { version: '3.0', created: new Date().toISOString(), updated: new Date().toISOString(), title: 'Nouveau Projet de Plaidoyer' }, fields: {}, actors: [], veille: [], journal: [], checks: {} };
        
        document.addEventListener('DOMContentLoaded', () => { loadProject(); initNavigation(); initFields(); initPowerMap(); updateDashboard(); updatePreview(); });
        
        function initNavigation() { document.querySelectorAll('.nav-tab').forEach(tab => { tab.addEventListener('click', () => switchSection(tab.dataset.section)); }); }
        function switchSection(sectionId) { document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active')); document.querySelectorAll('.section').forEach(s => s.classList.remove('active')); document.querySelector(`[data-section="${sectionId}"]`)?.classList.add('active'); document.getElementById(sectionId)?.classList.add('active'); }
        function initFields() { document.querySelectorAll('[data-field]').forEach(el => { el.addEventListener('input', debounce(() => { data.fields[el.dataset.field] = el.value; saveProject(false); updateDashboard(); }, 500)); }); }
        function toggleCard(card) { card.classList.toggle('expanded'); }
        
        let draggedActor = null;
        function initPowerMap() { const map = document.getElementById('power-map'); map.addEventListener('dragover', e => e.preventDefault()); map.addEventListener('drop', handleActorDrop); }
        function addActor() { const name = document.getElementById('actor-name').value.trim(); const type = document.getElementById('actor-type').value; if (!name) return showToast('Entrez un nom', 'error'); const actor = { id: Date.now(), name, type, x: 50 + (Math.random() - 0.5) * 30, y: 50 + (Math.random() - 0.5) * 30 }; data.actors.push(actor); renderActor(actor); document.getElementById('actor-name').value = ''; saveProject(false); updateDashboard(); }
        function renderActor(actor) { const map = document.getElementById('power-map'); const el = document.createElement('div'); el.className = `power-actor ${actor.type}`; el.textContent = actor.name; el.dataset.id = actor.id; el.style.left = actor.x + '%'; el.style.top = actor.y + '%'; el.draggable = true; el.addEventListener('dragstart', e => { draggedActor = actor; e.dataTransfer.effectAllowed = 'move'; }); el.addEventListener('dblclick', () => { if (confirm(`Supprimer "${actor.name}" ?`)) { data.actors = data.actors.filter(a => a.id !== actor.id); el.remove(); saveProject(false); updateDashboard(); } }); map.appendChild(el); }
        function handleActorDrop(e) { e.preventDefault(); if (!draggedActor) return; const map = document.getElementById('power-map'); const rect = map.getBoundingClientRect(); const x = ((e.clientX - rect.left) / rect.width) * 100; const y = ((e.clientY - rect.top) / rect.height) * 100; draggedActor.x = Math.max(5, Math.min(95, x)); draggedActor.y = Math.max(5, Math.min(95, y)); const el = map.querySelector(`[data-id="${draggedActor.id}"]`); if (el) { el.style.left = draggedActor.x + '%'; el.style.top = draggedActor.y + '%'; } saveProject(false); draggedActor = null; }
        
        function addVeille() { const title = document.getElementById('veille-title').value.trim(); const content = document.getElementById('veille-content').value.trim(); const category = document.getElementById('veille-category').value; if (!title) return showToast('Entrez un titre', 'error'); const item = { id: Date.now(), title, content, category, date: new Date().toISOString() }; data.veille.unshift(item); renderVeilleItem(item); document.getElementById('veille-title').value = ''; document.getElementById('veille-content').value = ''; saveProject(false); updateDashboard(); showToast('Signalement ajout√© !'); }
        function renderVeilleItem(item) { const feed = document.getElementById('veille-feed'); if (feed.querySelector('p')) feed.innerHTML = ''; const icons = { politique: 'üèõÔ∏è', social: 'üë•', environnement: 'üåç', economie: 'üí∞', droits: '‚öñÔ∏è', media: 'üì∞' }; const el = document.createElement('div'); el.className = 'veille-item'; el.innerHTML = `<div class="veille-item-header"><div class="veille-item-title">${icons[item.category] || 'üìå'} ${item.title}</div><div class="veille-item-date">${new Date(item.date).toLocaleDateString('fr-FR')}</div></div><div class="veille-item-content">${item.content || ''}</div><div class="veille-item-tags"><span class="veille-tag">${item.category}</span></div>`; feed.insertBefore(el, feed.firstChild); }
        
        function addJournalEntry() { const text = document.getElementById('journal-entry').value.trim(); if (!text) return showToast('√âcrivez quelque chose', 'error'); const entry = { id: Date.now(), text, date: new Date().toISOString() }; data.journal.unshift(entry); renderJournalEntry(entry); document.getElementById('journal-entry').value = ''; saveProject(false); showToast('Entr√©e ajout√©e !'); }
        function renderJournalEntry(entry) { const timeline = document.getElementById('journal-timeline'); const el = document.createElement('div'); el.className = 'timeline-item'; el.innerHTML = `<div class="timeline-date">${new Date(entry.date).toLocaleString('fr-FR')}</div><div class="timeline-content">${entry.text}</div>`; timeline.insertBefore(el, timeline.firstChild); }
        
        function toggleCheck(checkbox) { checkbox.classList.toggle('checked'); const item = checkbox.closest('.checklist-item'); item.classList.toggle('completed'); const idx = item.dataset.check; data.checks[`c${idx}`] = checkbox.classList.contains('checked'); saveProject(false); updateDashboard(); }
        
        function generateMessage() { const f = data.fields; const msg = `${f.msg_accroche || '[Accroche]'}\n\n${f.msg_probleme || '[Probl√®me]'}\n\nPourquoi c'est important : ${f.msg_importance || '[Enjeux]'}\n\nNous demandons √† ${f.cible_principale || '[Cible]'} de ${f.msg_action || '[Action]'}.`; const el = document.getElementById('generated-message'); el.style.display = 'block'; el.innerHTML = `<div style="background: var(--bg-input); padding: 1rem; border-radius: var(--radius-sm); border: 1px solid var(--green-soft);"><pre style="white-space: pre-wrap; color: var(--text-primary); font-size: 0.85rem; margin: 0;">${msg}</pre><button class="btn btn-ghost" onclick="navigator.clipboard.writeText(this.previousElementSibling.textContent); showToast('Copi√© !');" style="margin-top: 0.5rem;">üìã Copier</button></div>`; }
        
        function updateDashboard() { const filled = Object.values(data.fields).filter(v => v && v.trim()).length; const progress = Math.min(100, Math.round(filled / 30 * 100)); document.getElementById('stat-progress').textContent = progress + '%'; document.getElementById('stat-actors').textContent = data.actors.length; document.getElementById('stat-veille').textContent = data.veille.length; document.getElementById('dash-fields').textContent = filled; document.getElementById('dash-actors').textContent = data.actors.length; document.getElementById('dash-veille').textContent = data.veille.length; document.getElementById('dash-checks').textContent = Object.values(data.checks).filter(v => v).length; document.getElementById('global-progress').textContent = progress + '%'; document.getElementById('global-progress-fill').style.width = progress + '%'; const total = data.veille.length || 1; document.getElementById('veille-total').textContent = data.veille.length; ['politique', 'social', 'environnement'].forEach((cat, i) => { const id = ['politique', 'social', 'env'][i]; const count = data.veille.filter(v => v.category === cat).length; document.getElementById(`veille-${id}`).textContent = count; document.getElementById(`veille-${id}-fill`).style.width = (count / total * 100) + '%'; }); const voirFields = ['domino_pourquoi', 'domino_valeurs', 'domino_changements', 'fleur_sur', 'fleur_de']; const jugerFields = ['swot_forces', 'swot_faiblesses', 'arbre_probleme', 'pourquoi_1', 'toc_vision']; const agirFields = ['smart_objectif', 'cible_principale', 'msg_accroche', 'msg_action']; const icFields = ['ic_themes', 'ic_sources', 'ic_narratif']; const calcProg = fields => Math.round(fields.filter(f => data.fields[f] && data.fields[f].trim()).length / fields.length * 100); ['voir', 'juger', 'agir', 'ic'].forEach((phase, i) => { const fields = [voirFields, jugerFields, agirFields, icFields][i]; const prog = calcProg(fields); document.getElementById(`prog-${phase}`).textContent = prog + '%'; document.getElementById(`prog-${phase}-fill`).style.width = prog + '%'; }); }
        
        function saveProject(notify = true) { data.meta.updated = new Date().toISOString(); localStorage.setItem('plaidoyer_v3', JSON.stringify(data)); if (notify) showToast('Projet sauvegard√© !'); }
        function loadProject() { const saved = localStorage.getItem('plaidoyer_v3'); if (saved) { try { data = JSON.parse(saved); Object.entries(data.fields).forEach(([k, v]) => { const el = document.querySelector(`[data-field="${k}"]`); if (el) el.value = v; }); data.actors.forEach(a => renderActor(a)); data.veille.forEach(v => renderVeilleItem(v)); data.journal.forEach(j => renderJournalEntry(j)); Object.entries(data.checks).forEach(([k, v]) => { if (v) { const idx = k.replace('c', ''); const item = document.querySelector(`.checklist-item[data-check="${idx}"]`); if (item) { item.classList.add('completed'); item.querySelector('.checkbox').classList.add('checked'); } } }); } catch (e) { console.error('Load error:', e); } } }
        
        function getFilename() { return `plaidoyer_${new Date().toISOString().slice(0, 10)}`; }
        function downloadBlob(blob, filename) { const url = URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = filename; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url); }
        
        function exportJSON() { const content = JSON.stringify(data, null, 2); const blob = new Blob([content], { type: 'application/json' }); downloadBlob(blob, getFilename() + '.json'); showToast('Export JSON r√©ussi !'); }
        function exportMarkdown() { let md = `# ${data.meta.title || 'Plaidoyer Citoyen'}\n\n*Export√© le ${new Date().toLocaleDateString('fr-FR')}*\n\n---\n\n`; Object.entries(data.fields).forEach(([k, v]) => { if (v && v.trim()) md += `## ${k.replace(/_/g, ' ').toUpperCase()}\n\n${v}\n\n`; }); if (data.actors.length > 0) { md += `## ACTEURS\n\n`; data.actors.forEach(a => md += `- **${a.name}** (${a.type})\n`); } const blob = new Blob([md], { type: 'text/markdown' }); downloadBlob(blob, getFilename() + '.md'); showToast('Export Markdown r√©ussi !'); }
        function exportHTML() { let html = `<!DOCTYPE html><html lang="fr"><head><meta charset="UTF-8"><title>${data.meta.title || 'Plaidoyer'}</title><style>:root{--green:#7fff7f;--lilac:#c8b6ff;--dark:#0a0a0f;--card:#12121a}*{margin:0;padding:0;box-sizing:border-box}body{font-family:system-ui,sans-serif;background:var(--dark);color:#f0f0f5;line-height:1.6;padding:2rem}.container{max-width:900px;margin:0 auto}h1{background:linear-gradient(135deg,var(--green),var(--lilac));-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:.5rem}h2{color:var(--green);border-bottom:1px solid #333;padding-bottom:.5rem;margin:2rem 0 1rem}.card{background:var(--card);border:1px solid rgba(127,255,127,.2);border-radius:12px;padding:1.5rem;margin-bottom:1rem}.meta{color:#a0a0b0;font-size:.9rem;margin-bottom:2rem}</style></head><body><div class="container"><h1>${data.meta.title || 'Plaidoyer Citoyen'}</h1><p class="meta">Export√© le ${new Date().toLocaleDateString('fr-FR')}</p>`; Object.entries(data.fields).forEach(([k, v]) => { if (v && v.trim()) html += `<div class="card"><h2>${k.replace(/_/g, ' ')}</h2><p>${v}</p></div>`; }); html += `</div></body></html>`; const blob = new Blob([html], { type: 'text/html' }); downloadBlob(blob, getFilename() + '.html'); showToast('Export HTML r√©ussi !'); }
        function exportCSV() { let csv = 'Champ,Valeur\n'; Object.entries(data.fields).forEach(([k, v]) => { if (v && v.trim()) csv += `"${k}","${v.replace(/"/g, '""')}"\n`; }); csv += '\nActeur,Type,X,Y\n'; data.actors.forEach(a => csv += `"${a.name}","${a.type}",${a.x.toFixed(1)},${a.y.toFixed(1)}\n`); csv += '\nVeille,Cat√©gorie,Date,Contenu\n'; data.veille.forEach(v => csv += `"${v.title}","${v.category}","${v.date}","${(v.content || '').replace(/"/g, '""')}"\n`); const blob = new Blob([csv], { type: 'text/csv' }); downloadBlob(blob, getFilename() + '.csv'); showToast('Export CSV r√©ussi !'); }
        function exportTXT() { let txt = `PROJET DE PLAIDOYER CITOYEN\n${'='.repeat(50)}\nExport√© le ${new Date().toLocaleDateString('fr-FR')}\n\n`; Object.entries(data.fields).forEach(([k, v]) => { if (v && v.trim()) txt += `[${k.toUpperCase().replace(/_/g, ' ')}]\n${v}\n\n`; }); const blob = new Blob([txt], { type: 'text/plain' }); downloadBlob(blob, getFilename() + '.txt'); showToast('Export TXT r√©ussi !'); }
        
        function exportPDF() { const { jsPDF } = window.jspdf; const doc = new jsPDF(); let y = 20; const margin = 20; const pageWidth = doc.internal.pageSize.width; doc.setFontSize(22); doc.setTextColor(100, 200, 100); doc.text('Plaidoyer Citoyen', margin, y); y += 10; doc.setFontSize(12); doc.setTextColor(150, 150, 150); doc.text(`Export√© le ${new Date().toLocaleDateString('fr-FR')}`, margin, y); y += 15; doc.setDrawColor(100, 200, 100); doc.line(margin, y, pageWidth - margin, y); y += 10; const sections = { 'VOIR': ['domino_pourquoi', 'domino_valeurs', 'domino_changements'], 'JUGER': ['swot_forces', 'swot_faiblesses', 'arbre_probleme', 'toc_vision'], 'AGIR': ['smart_objectif', 'cible_principale', 'msg_accroche', 'msg_action'], 'INTELLIGENCE CIVILE': ['ic_themes', 'ic_sources', 'ic_narratif'] }; Object.entries(sections).forEach(([title, fields]) => { const hasContent = fields.some(f => data.fields[f] && data.fields[f].trim()); if (!hasContent) return; if (y > 250) { doc.addPage(); y = 20; } doc.setFontSize(14); doc.setTextColor(180, 140, 255); doc.text(title, margin, y); y += 8; fields.forEach(f => { if (data.fields[f] && data.fields[f].trim()) { if (y > 270) { doc.addPage(); y = 20; } doc.setFontSize(10); doc.setTextColor(100, 200, 100); doc.text(f.replace(/_/g, ' ').toUpperCase(), margin, y); y += 5; doc.setTextColor(50, 50, 50); const lines = doc.splitTextToSize(data.fields[f], pageWidth - 2 * margin); doc.text(lines, margin, y); y += lines.length * 5 + 8; } }); }); if (data.actors.length > 0) { if (y > 250) { doc.addPage(); y = 20; } doc.setFontSize(14); doc.setTextColor(180, 140, 255); doc.text('ACTEURS', margin, y); y += 10; doc.autoTable({ startY: y, head: [['Nom', 'Type', 'Position']], body: data.actors.map(a => [a.name, a.type, `${a.x.toFixed(0)}%, ${a.y.toFixed(0)}%`]), theme: 'striped', headStyles: { fillColor: [100, 200, 100] }, margin: { left: margin, right: margin } }); } doc.save(getFilename() + '.pdf'); showToast('Export PDF r√©ussi !'); }
        
        function exportDOCX() { const { Document, Packer, Paragraph, TextRun, HeadingLevel, AlignmentType } = docx; const children = [ new Paragraph({ children: [new TextRun({ text: 'Plaidoyer Citoyen', bold: true, size: 48, color: '7fff7f' })], heading: HeadingLevel.TITLE, alignment: AlignmentType.CENTER }), new Paragraph({ children: [new TextRun({ text: `Export√© le ${new Date().toLocaleDateString('fr-FR')}`, italics: true, color: '888888' })], alignment: AlignmentType.CENTER }), new Paragraph({ text: '' }) ]; const sections = { 'Phase VOIR': ['domino_pourquoi', 'domino_valeurs', 'domino_changements'], 'Phase JUGER': ['swot_forces', 'swot_faiblesses', 'arbre_probleme', 'toc_vision'], 'Phase AGIR': ['smart_objectif', 'cible_principale', 'msg_accroche', 'msg_action'], 'Intelligence Civile': ['ic_themes', 'ic_sources', 'ic_narratif'] }; Object.entries(sections).forEach(([title, fields]) => { const hasContent = fields.some(f => data.fields[f] && data.fields[f].trim()); if (!hasContent) return; children.push(new Paragraph({ children: [new TextRun({ text: title, bold: true, size: 28, color: 'c8b6ff' })], heading: HeadingLevel.HEADING_1, spacing: { before: 400 } })); fields.forEach(f => { if (data.fields[f] && data.fields[f].trim()) { children.push(new Paragraph({ children: [new TextRun({ text: f.replace(/_/g, ' '), bold: true, color: '7fff7f' })], heading: HeadingLevel.HEADING_2 })); children.push(new Paragraph({ text: data.fields[f] })); } }); }); if (data.actors.length > 0) { children.push(new Paragraph({ children: [new TextRun({ text: 'Acteurs', bold: true, size: 28, color: 'c8b6ff' })], heading: HeadingLevel.HEADING_1, spacing: { before: 400 } })); data.actors.forEach(a => { children.push(new Paragraph({ children: [new TextRun({ text: `‚Ä¢ ${a.name}`, bold: true }), new TextRun({ text: ` (${a.type})`, color: '888888' })] })); }); } const doc = new Document({ sections: [{ properties: {}, children }] }); Packer.toBlob(doc).then(blob => { downloadBlob(blob, getFilename() + '.docx'); showToast('Export DOCX r√©ussi !'); }); }
        
        function exportPPTX() { const pptx = new PptxGenJS(); pptx.title = data.meta.title || 'Plaidoyer Citoyen'; let slide = pptx.addSlide(); slide.addText('Plaidoyer Citoyen', { x: 0.5, y: 2, w: 9, h: 1.5, fontSize: 44, bold: true, color: '7FFF7F', align: 'center' }); slide.addText(new Date().toLocaleDateString('fr-FR'), { x: 0.5, y: 3.5, w: 9, h: 0.5, fontSize: 18, color: '888888', align: 'center' }); const sections = { 'üëÅÔ∏è VOIR': ['domino_pourquoi', 'domino_valeurs'], '‚öñÔ∏è JUGER': ['swot_forces', 'arbre_probleme'], 'üöÄ AGIR': ['smart_objectif', 'msg_accroche'], 'üß† IC': ['ic_themes', 'ic_sources'] }; Object.entries(sections).forEach(([title, fields]) => { const hasContent = fields.some(f => data.fields[f] && data.fields[f].trim()); if (!hasContent) return; slide = pptx.addSlide(); slide.addText(title, { x: 0.5, y: 0.3, w: 9, h: 0.8, fontSize: 32, bold: true, color: 'C8B6FF' }); let yPos = 1.3; fields.forEach(f => { if (data.fields[f] && data.fields[f].trim() && yPos < 5) { slide.addText(f.replace(/_/g, ' ').toUpperCase(), { x: 0.5, y: yPos, w: 9, h: 0.4, fontSize: 14, bold: true, color: '7FFF7F' }); yPos += 0.4; const text = data.fields[f].substring(0, 300) + (data.fields[f].length > 300 ? '...' : ''); slide.addText(text, { x: 0.5, y: yPos, w: 9, h: 1, fontSize: 12, color: '333333', valign: 'top' }); yPos += 1.2; } }); }); pptx.writeFile({ fileName: getFilename() + '.pptx' }); showToast('Export PPTX r√©ussi !'); }
        
        function exportFHIR() { const fhir = { resourceType: 'Bundle', id: `plaidoyer-${Date.now()}`, meta: { lastUpdated: new Date().toISOString(), profile: ['http://hl7.org/fhir/StructureDefinition/Bundle'] }, type: 'collection', entry: [] }; const docRef = { fullUrl: `urn:uuid:doc-${Date.now()}`, resource: { resourceType: 'DocumentReference', id: `advocacy-${Date.now()}`, status: 'current', type: { coding: [{ system: 'http://loinc.org', code: '11488-4', display: 'Consultation note' }], text: 'Projet de plaidoyer citoyen' }, subject: { display: 'Initiative citoyenne' }, date: new Date().toISOString(), description: data.meta.title || 'Plaidoyer Citoyen', content: [{ attachment: { contentType: 'application/json', title: 'Donn√©es du plaidoyer', data: btoa(unescape(encodeURIComponent(JSON.stringify(data.fields)))) } }] } }; fhir.entry.push(docRef); if (data.fields.smart_objectif) { fhir.entry.push({ fullUrl: `urn:uuid:goal-${Date.now()}`, resource: { resourceType: 'Goal', id: `goal-${Date.now()}`, lifecycleStatus: 'active', description: { text: data.fields.smart_objectif }, subject: { display: 'Initiative citoyenne' }, target: [{ dueDate: data.fields.smart_echeance || undefined }] } }); } data.actors.forEach(actor => { fhir.entry.push({ fullUrl: `urn:uuid:org-${actor.id}`, resource: { resourceType: 'Organization', id: `actor-${actor.id}`, name: actor.name, type: [{ coding: [{ system: 'http://plaidoyer.local/actor-type', code: actor.type, display: actor.type === 'ally' ? 'Alli√©' : actor.type === 'opponent' ? 'Opposant' : 'Neutre' }] }], extension: [{ url: 'http://plaidoyer.local/power-position', valueString: `x:${actor.x.toFixed(1)},y:${actor.y.toFixed(1)}` }] } }); }); const content = JSON.stringify(fhir, null, 2); const blob = new Blob([content], { type: 'application/fhir+json' }); downloadBlob(blob, getFilename() + '.fhir.json'); showToast('Export FHIR R4 r√©ussi !'); }
        
        function exportRSS() { const pubDate = new Date().toUTCString(); let rss = `<?xml version="1.0" encoding="UTF-8"?>\n<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:dc="http://purl.org/dc/elements/1.1/">\n<channel>\n    <title>Veille Citoyenne ‚Äî ${data.meta.title || 'Plaidoyer Citoyen'}</title>\n    <link>https://plaidoyer-citoyen.local</link>\n    <description>Flux de veille citoyenne g√©n√©r√© par Plaidoyer Citoyen v3.0</description>\n    <language>fr-FR</language>\n    <pubDate>${pubDate}</pubDate>\n    <lastBuildDate>${pubDate}</lastBuildDate>\n    <generator>Plaidoyer Citoyen v3.0</generator>\n`; data.veille.forEach(item => { const itemDate = new Date(item.date).toUTCString(); rss += `    <item>\n        <title><![CDATA[${item.title}]]></title>\n        <description><![CDATA[${item.content || ''}]]></description>\n        <category>${item.category}</category>\n        <pubDate>${itemDate}</pubDate>\n        <guid isPermaLink="false">veille-${item.id}</guid>\n        <dc:creator>Veilleur citoyen</dc:creator>\n    </item>\n`; }); rss += `</channel>\n</rss>`; const blob = new Blob([rss], { type: 'application/rss+xml' }); downloadBlob(blob, getFilename() + '.rss'); showToast('Export RSS 2.0 r√©ussi !'); }
        
        function exportAtom() { const updated = new Date().toISOString(); let atom = `<?xml version="1.0" encoding="UTF-8"?>\n<feed xmlns="http://www.w3.org/2005/Atom">\n    <title>Veille Citoyenne ‚Äî ${data.meta.title || 'Plaidoyer Citoyen'}</title>\n    <link href="https://plaidoyer-citoyen.local" rel="alternate"/>\n    <link href="https://plaidoyer-citoyen.local/feed.atom" rel="self"/>\n    <id>urn:uuid:plaidoyer-${Date.now()}</id>\n    <updated>${updated}</updated>\n    <author><name>Plaidoyer Citoyen</name></author>\n    <generator version="3.0">Plaidoyer Citoyen</generator>\n`; data.veille.forEach(item => { const itemDate = new Date(item.date).toISOString(); atom += `    <entry>\n        <title><![CDATA[${item.title}]]></title>\n        <link href="https://plaidoyer-citoyen.local/veille/${item.id}"/>\n        <id>urn:uuid:veille-${item.id}</id>\n        <updated>${itemDate}</updated>\n        <summary><![CDATA[${item.content || ''}]]></summary>\n        <category term="${item.category}"/>\n    </entry>\n`; }); atom += `</feed>`; const blob = new Blob([atom], { type: 'application/atom+xml' }); downloadBlob(blob, getFilename() + '.atom'); showToast('Export Atom r√©ussi !'); }
        
        function exportJSONLD() { const jsonld = { '@context': { '@vocab': 'https://schema.org/', 'fhir': 'http://hl7.org/fhir/', 'plaidoyer': 'https://plaidoyer-citoyen.local/schema/' }, '@type': 'CreativeWork', '@id': `urn:plaidoyer:${Date.now()}`, 'name': data.meta.title || 'Projet de Plaidoyer Citoyen', 'description': data.fields.domino_pourquoi || 'Un projet de plaidoyer citoyen', 'dateCreated': data.meta.created, 'dateModified': data.meta.updated, 'creator': { '@type': 'Organization', 'name': 'Initiative citoyenne' }, 'about': { '@type': 'Thing', 'name': data.fields.arbre_probleme || 'Enjeu citoyen' }, 'plaidoyer:phase': [ { '@type': 'plaidoyer:Phase', 'name': 'VOIR', 'plaidoyer:identity': data.fields.domino_pourquoi, 'plaidoyer:values': data.fields.domino_valeurs }, { '@type': 'plaidoyer:Phase', 'name': 'JUGER', 'plaidoyer:problem': data.fields.arbre_probleme, 'plaidoyer:vision': data.fields.toc_vision }, { '@type': 'plaidoyer:Phase', 'name': 'AGIR', 'plaidoyer:objective': data.fields.smart_objectif, 'plaidoyer:target': data.fields.cible_principale } ], 'plaidoyer:actors': data.actors.map(a => ({ '@type': 'Organization', 'name': a.name, 'plaidoyer:actorType': a.type, 'plaidoyer:powerPosition': { x: a.x, y: a.y } })), 'plaidoyer:surveillance': data.veille.map(v => ({ '@type': 'NewsArticle', 'headline': v.title, 'articleBody': v.content, 'datePublished': v.date, 'articleSection': v.category })) }; const content = JSON.stringify(jsonld, null, 2); const blob = new Blob([content], { type: 'application/ld+json' }); downloadBlob(blob, getFilename() + '.jsonld'); showToast('Export JSON-LD r√©ussi !'); }
        
        function updatePreview() { const format = document.getElementById('preview-format').value; const panel = document.getElementById('preview-panel'); let content = ''; switch (format) { case 'json': content = JSON.stringify(data, null, 2); break; case 'fhir': content = JSON.stringify({ resourceType: 'Bundle', type: 'collection', entry: [{ resource: { resourceType: 'DocumentReference', description: data.meta.title } }] }, null, 2); break; case 'rss': content = `<?xml version="1.0"?>\n<rss version="2.0">\n<channel>\n  <title>Veille Citoyenne</title>\n  <item>\n    <title>${data.veille[0]?.title || 'Exemple'}</title>\n  </item>\n</channel>\n</rss>`; break; case 'jsonld': content = JSON.stringify({ '@context': 'https://schema.org/', '@type': 'CreativeWork', 'name': data.meta.title }, null, 2); break; } panel.textContent = content.substring(0, 2000) + (content.length > 2000 ? '\n...' : ''); }
        function copyPreview() { const panel = document.getElementById('preview-panel'); navigator.clipboard.writeText(panel.textContent); showToast('Copi√© !'); }
        
        function handleDrop(e) { e.preventDefault(); e.target.classList.remove('dragover'); const file = e.dataTransfer?.files[0]; if (file) processImportFile(file); }
        function importFile(e) { const file = e.target.files[0]; if (file) processImportFile(file); }
        function processImportFile(file) { const reader = new FileReader(); reader.onload = (e) => { try { const content = e.target.result; if (file.name.endsWith('.json')) { const imported = JSON.parse(content); if (imported.resourceType === 'Bundle') { importFHIR(imported); } else if (imported['@context']) { importJSONLD(imported); } else { data = imported; localStorage.setItem('plaidoyer_v3', JSON.stringify(data)); location.reload(); } } else if (file.name.endsWith('.rss') || file.name.endsWith('.xml') || file.name.endsWith('.atom')) { importRSS(content); } closeModal('import-modal'); } catch (err) { console.error(err); showToast('Erreur import', 'error'); } }; reader.readAsText(file); }
        function importFHIR(fhir) { showToast('Import FHIR d√©tect√©', 'info'); fhir.entry?.forEach(entry => { const res = entry.resource; if (res.resourceType === 'DocumentReference' && res.content?.[0]?.attachment?.data) { try { const decoded = decodeURIComponent(escape(atob(res.content[0].attachment.data))); const fields = JSON.parse(decoded); data.fields = { ...data.fields, ...fields }; } catch (e) {} } if (res.resourceType === 'Goal') { data.fields.smart_objectif = res.description?.text || ''; } if (res.resourceType === 'Organization') { const existing = data.actors.find(a => a.name === res.name); if (!existing) { data.actors.push({ id: Date.now() + Math.random(), name: res.name, type: res.type?.[0]?.coding?.[0]?.code || 'neutral', x: 50, y: 50 }); } } }); localStorage.setItem('plaidoyer_v3', JSON.stringify(data)); location.reload(); }
        function importJSONLD(jsonld) { showToast('Import JSON-LD d√©tect√©', 'info'); if (jsonld.name) data.meta.title = jsonld.name; if (jsonld['plaidoyer:phase']) { jsonld['plaidoyer:phase'].forEach(phase => { if (phase['plaidoyer:identity']) data.fields.domino_pourquoi = phase['plaidoyer:identity']; if (phase['plaidoyer:values']) data.fields.domino_valeurs = phase['plaidoyer:values']; if (phase['plaidoyer:objective']) data.fields.smart_objectif = phase['plaidoyer:objective']; }); } localStorage.setItem('plaidoyer_v3', JSON.stringify(data)); location.reload(); }
        function importRSS(content) { showToast('Import RSS/Atom d√©tect√©', 'info'); const parser = new DOMParser(); const xml = parser.parseFromString(content, 'text/xml'); const items = xml.querySelectorAll('item, entry'); items.forEach(item => { const title = item.querySelector('title')?.textContent; const description = item.querySelector('description, summary, content')?.textContent; const date = item.querySelector('pubDate, published, updated')?.textContent; const category = item.querySelector('category')?.textContent || 'media'; if (title) { data.veille.push({ id: Date.now() + Math.random(), title, content: description || '', category: category.toLowerCase(), date: date ? new Date(date).toISOString() : new Date().toISOString() }); } }); localStorage.setItem('plaidoyer_v3', JSON.stringify(data)); location.reload(); }
        
        function openModal(id) { document.getElementById(id).classList.add('active'); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }
        document.querySelectorAll('.modal-overlay').forEach(overlay => { overlay.addEventListener('click', (e) => { if (e.target === overlay) overlay.classList.remove('active'); }); });
        
        function showToast(msg, type = 'success') { const container = document.getElementById('toast-container'); const toast = document.createElement('div'); toast.className = `toast ${type}`; const icons = { success: '‚úÖ', error: '‚ùå', info: '‚ÑπÔ∏è' }; toast.innerHTML = `<span>${icons[type] || '‚úÖ'}</span><span>${msg}</span>`; container.appendChild(toast); setTimeout(() => { toast.style.opacity = '0'; toast.style.transform = 'translateX(100px)'; setTimeout(() => toast.remove(), 300); }, 3000); }
        function debounce(fn, ms) { let timeout; return (...args) => { clearTimeout(timeout); timeout = setTimeout(() => fn(...args), ms); }; }
        
        document.addEventListener('keydown', (e) => { if (e.ctrlKey || e.metaKey) { switch (e.key) { case 's': e.preventDefault(); saveProject(); break; case 'e': e.preventDefault(); openModal('export-modal'); break; case 'i': e.preventDefault(); openModal('import-modal'); break; } } if (e.key === 'Escape') { document.querySelectorAll('.modal-overlay.active').forEach(m => m.classList.remove('active')); } });
        
        setInterval(() => saveProject(false), 30000);
        console.log('üöÄ Plaidoyer Citoyen v3.0 initialis√©');
        console.log('üì¶ Exports: PDF, DOCX, PPTX, HTML, JSON, MD, CSV, TXT');
        console.log('üîó Protocoles: FHIR R4, RSS 2.0, Atom, JSON-LD');
    </script>
</body>
</html>
